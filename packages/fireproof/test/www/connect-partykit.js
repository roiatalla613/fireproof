"use strict";var FireproofConnect=(()=>{var Lr=Object.defineProperty;var Hh=Object.getOwnPropertyDescriptor;var qh=Object.getOwnPropertyNames;var Vh=Object.prototype.hasOwnProperty;var Wh=(e,t,r)=>t in e?Lr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Gh=(e,t)=>{for(var r in t)Lr(e,r,{get:t[r],enumerable:!0})},Kh=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of qh(t))!Vh.call(e,i)&&i!==r&&Lr(e,i,{get:()=>t[i],enumerable:!(n=Hh(t,i))||n.enumerable});return e};var Jh=e=>Kh(Lr({},"__esModule",{value:!0}),e);var j=(e,t,r)=>(Wh(e,typeof t!="symbol"?t+"":t,r),r);var ck={};Gh(ck,{connect:()=>uk});var Qh=Object.create,Gi=Object.defineProperty,Xh=Object.getOwnPropertyDescriptor,Yh=Object.getOwnPropertyNames,Zh=Object.getPrototypeOf,ef=Object.prototype.hasOwnProperty,tf=(e,t,r)=>t in e?Gi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,rf=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),nf=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Yh(t))!ef.call(e,i)&&i!==r&&Gi(e,i,{get:()=>t[i],enumerable:!(n=Xh(t,i))||n.enumerable});return e},sf=(e,t,r)=>(r=e!=null?Qh(Zh(e)):{},nf(t||!e||!e.__esModule?Gi(r,"default",{value:e,enumerable:!0}):r,e)),_e=(e,t,r)=>(tf(e,typeof t!="symbol"?t+"":t,r),r),of=rf((e,t)=>{var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global,n=function(){function s(){this.fetch=!1,this.DOMException=r.DOMException}return s.prototype=r,new s}();(function(s){var o=function(a){var l=typeof s<"u"&&s||typeof self<"u"&&self||typeof l<"u"&&l,u={searchParams:"URLSearchParams"in l,iterable:"Symbol"in l&&"iterator"in Symbol,blob:"FileReader"in l&&"Blob"in l&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in l,arrayBuffer:"ArrayBuffer"in l};function c(E){return E&&DataView.prototype.isPrototypeOf(E)}if(u.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],w=ArrayBuffer.isView||function(E){return E&&f.indexOf(Object.prototype.toString.call(E))>-1};function d(E){if(typeof E!="string"&&(E=String(E)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(E)||E==="")throw new TypeError('Invalid character in header field name: "'+E+'"');return E.toLowerCase()}function y(E){return typeof E!="string"&&(E=String(E)),E}function h(E){var F={next:function(){var z=E.shift();return{done:z===void 0,value:z}}};return u.iterable&&(F[Symbol.iterator]=function(){return F}),F}function p(E){this.map={},E instanceof p?E.forEach(function(F,z){this.append(z,F)},this):Array.isArray(E)?E.forEach(function(F){this.append(F[0],F[1])},this):E&&Object.getOwnPropertyNames(E).forEach(function(F){this.append(F,E[F])},this)}p.prototype.append=function(E,F){E=d(E),F=y(F);var z=this.map[E];this.map[E]=z?z+", "+F:F},p.prototype.delete=function(E){delete this.map[d(E)]},p.prototype.get=function(E){return E=d(E),this.has(E)?this.map[E]:null},p.prototype.has=function(E){return this.map.hasOwnProperty(d(E))},p.prototype.set=function(E,F){this.map[d(E)]=y(F)},p.prototype.forEach=function(E,F){for(var z in this.map)this.map.hasOwnProperty(z)&&E.call(F,this.map[z],z,this)},p.prototype.keys=function(){var E=[];return this.forEach(function(F,z){E.push(z)}),h(E)},p.prototype.values=function(){var E=[];return this.forEach(function(F){E.push(F)}),h(E)},p.prototype.entries=function(){var E=[];return this.forEach(function(F,z){E.push([z,F])}),h(E)},u.iterable&&(p.prototype[Symbol.iterator]=p.prototype.entries);function g(E){if(E.bodyUsed)return Promise.reject(new TypeError("Already read"));E.bodyUsed=!0}function m(E){return new Promise(function(F,z){E.onload=function(){F(E.result)},E.onerror=function(){z(E.error)}})}function b(E){var F=new FileReader,z=m(F);return F.readAsArrayBuffer(E),z}function k(E){var F=new FileReader,z=m(F);return F.readAsText(E),z}function S(E){for(var F=new Uint8Array(E),z=new Array(F.length),Q=0;Q<F.length;Q++)z[Q]=String.fromCharCode(F[Q]);return z.join("")}function B(E){if(E.slice)return E.slice(0);var F=new Uint8Array(E.byteLength);return F.set(new Uint8Array(E)),F.buffer}function N(){return this.bodyUsed=!1,this._initBody=function(E){this.bodyUsed=this.bodyUsed,this._bodyInit=E,E?typeof E=="string"?this._bodyText=E:u.blob&&Blob.prototype.isPrototypeOf(E)?this._bodyBlob=E:u.formData&&FormData.prototype.isPrototypeOf(E)?this._bodyFormData=E:u.searchParams&&URLSearchParams.prototype.isPrototypeOf(E)?this._bodyText=E.toString():u.arrayBuffer&&u.blob&&c(E)?(this._bodyArrayBuffer=B(E.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(E)||w(E))?this._bodyArrayBuffer=B(E):this._bodyText=E=Object.prototype.toString.call(E):this._bodyText="",this.headers.get("content-type")||(typeof E=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):u.searchParams&&URLSearchParams.prototype.isPrototypeOf(E)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u.blob&&(this.blob=function(){var E=g(this);if(E)return E;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var E=g(this);return E||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(b)}),this.text=function(){var E=g(this);if(E)return E;if(this._bodyBlob)return k(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(S(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},u.formData&&(this.formData=function(){return this.text().then(kt)}),this.json=function(){return this.text().then(JSON.parse)},this}var M=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function D(E){var F=E.toUpperCase();return M.indexOf(F)>-1?F:E}function W(E,F){if(!(this instanceof W))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');F=F||{};var z=F.body;if(E instanceof W){if(E.bodyUsed)throw new TypeError("Already read");this.url=E.url,this.credentials=E.credentials,F.headers||(this.headers=new p(E.headers)),this.method=E.method,this.mode=E.mode,this.signal=E.signal,!z&&E._bodyInit!=null&&(z=E._bodyInit,E.bodyUsed=!0)}else this.url=String(E);if(this.credentials=F.credentials||this.credentials||"same-origin",(F.headers||!this.headers)&&(this.headers=new p(F.headers)),this.method=D(F.method||this.method||"GET"),this.mode=F.mode||this.mode||null,this.signal=F.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&z)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(z),(this.method==="GET"||this.method==="HEAD")&&(F.cache==="no-store"||F.cache==="no-cache")){var Q=/([?&])_=[^&]*/;if(Q.test(this.url))this.url=this.url.replace(Q,"$1_="+new Date().getTime());else{var X=/\?/;this.url+=(X.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}W.prototype.clone=function(){return new W(this,{body:this._bodyInit})};function kt(E){var F=new FormData;return E.trim().split("&").forEach(function(z){if(z){var Q=z.split("="),X=Q.shift().replace(/\+/g," "),V=Q.join("=").replace(/\+/g," ");F.append(decodeURIComponent(X),decodeURIComponent(V))}}),F}function Et(E){var F=new p,z=E.replace(/\r?\n[\t ]+/g," ");return z.split("\r").map(function(Q){return Q.indexOf(`
`)===0?Q.substr(1,Q.length):Q}).forEach(function(Q){var X=Q.split(":"),V=X.shift().trim();if(V){var Nr=X.join(":").trim();F.append(V,Nr)}}),F}N.call(W.prototype);function oe(E,F){if(!(this instanceof oe))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');F||(F={}),this.type="default",this.status=F.status===void 0?200:F.status,this.ok=this.status>=200&&this.status<300,this.statusText=F.statusText===void 0?"":""+F.statusText,this.headers=new p(F.headers),this.url=F.url||"",this._initBody(E)}N.call(oe.prototype),oe.prototype.clone=function(){return new oe(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},oe.error=function(){var E=new oe(null,{status:0,statusText:""});return E.type="error",E};var xt=[301,302,303,307,308];oe.redirect=function(E,F){if(xt.indexOf(F)===-1)throw new RangeError("Invalid status code");return new oe(null,{status:F,headers:{location:E}})},a.DOMException=l.DOMException;try{new a.DOMException}catch{a.DOMException=function(E,F){this.message=E,this.name=F;var z=Error(E);this.stack=z.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function U(E,F){return new Promise(function(z,Q){var X=new W(E,F);if(X.signal&&X.signal.aborted)return Q(new a.DOMException("Aborted","AbortError"));var V=new XMLHttpRequest;function Nr(){V.abort()}V.onload=function(){var we={status:V.status,statusText:V.statusText,headers:Et(V.getAllResponseHeaders()||"")};we.url="responseURL"in V?V.responseURL:we.headers.get("X-Request-URL");var ii="response"in V?V.response:V.responseText;setTimeout(function(){z(new oe(ii,we))},0)},V.onerror=function(){setTimeout(function(){Q(new TypeError("Network request failed"))},0)},V.ontimeout=function(){setTimeout(function(){Q(new TypeError("Network request failed"))},0)},V.onabort=function(){setTimeout(function(){Q(new a.DOMException("Aborted","AbortError"))},0)};function Rh(we){try{return we===""&&l.location.href?l.location.href:we}catch{return we}}V.open(X.method,Rh(X.url),!0),X.credentials==="include"?V.withCredentials=!0:X.credentials==="omit"&&(V.withCredentials=!1),"responseType"in V&&(u.blob?V.responseType="blob":u.arrayBuffer&&X.headers.get("Content-Type")&&X.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(V.responseType="arraybuffer")),F&&typeof F.headers=="object"&&!(F.headers instanceof p)?Object.getOwnPropertyNames(F.headers).forEach(function(we){V.setRequestHeader(we,y(F.headers[we]))}):X.headers.forEach(function(we,ii){V.setRequestHeader(ii,we)}),X.signal&&(X.signal.addEventListener("abort",Nr),V.onreadystatechange=function(){V.readyState===4&&X.signal.removeEventListener("abort",Nr)}),V.send(typeof X._bodyInit>"u"?null:X._bodyInit)})}return U.polyfill=!0,l.fetch||(l.fetch=U,l.Headers=p,l.Request=W,l.Response=oe),a.Headers=p,a.Request=W,a.Response=oe,a.fetch=U,a}({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var i=r.fetch?r:n;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,t.exports=e}),af=Object.create,An=Object.defineProperty,lf=Object.getOwnPropertyDescriptor,uf=Object.getOwnPropertyNames,cf=Object.getPrototypeOf,hf=Object.prototype.hasOwnProperty,ff=(e,t,r)=>t in e?An(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,q=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Z=(e,t)=>{for(var r in t)An(e,r,{get:t[r],enumerable:!0})},df=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of uf(t))!hf.call(e,i)&&i!==r&&An(e,i,{get:()=>t[i],enumerable:!(n=lf(t,i))||n.enumerable});return e},J=(e,t,r)=>(r=e!=null?af(cf(e)):{},df(t||!e||!e.__esModule?An(r,"default",{value:e,enumerable:!0}):r,e)),A=(e,t,r)=>(ff(e,typeof t!="symbol"?t+"":t,r),r),Qa=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},ue=(e,t,r)=>(Qa(e,t,"read from private field"),r?r.call(e):t.get(e)),Lt=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Ae=(e,t,r,n)=>(Qa(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Oo=(e,t,r,n)=>({set _(i){Ae(e,t,i,r)},get _(){return ue(e,t,n)}}),pf=q((e,t)=>{t.exports=o;var r=128,n=127,i=~n,s=Math.pow(2,31);function o(a,l,u){if(Number.MAX_SAFE_INTEGER&&a>Number.MAX_SAFE_INTEGER)throw o.bytes=0,new RangeError("Could not encode varint");l=l||[],u=u||0;for(var c=u;a>=s;)l[u++]=a&255|r,a/=128;for(;a&i;)l[u++]=a&255|r,a>>>=7;return l[u]=a|0,o.bytes=u-c+1,l}}),yf=q((e,t)=>{t.exports=i;var r=128,n=127;function i(s,l){var a=0,l=l||0,u=0,c=l,f,w=s.length;do{if(c>=w||u>49)throw i.bytes=0,new RangeError("Could not decode varint");f=s[c++],a+=u<28?(f&n)<<u:(f&n)*Math.pow(2,u),u+=7}while(f>=r);return i.bytes=c-l,a}}),wf=q((e,t)=>{var r=Math.pow(2,7),n=Math.pow(2,14),i=Math.pow(2,21),s=Math.pow(2,28),o=Math.pow(2,35),a=Math.pow(2,42),l=Math.pow(2,49),u=Math.pow(2,56),c=Math.pow(2,63);t.exports=function(f){return f<r?1:f<n?2:f<i?3:f<s?4:f<o?5:f<a?6:f<l?7:f<u?8:f<c?9:10}}),Ki=q((e,t)=>{t.exports={encode:pf(),decode:yf(),encodingLength:wf()}}),gf=q(e=>{e.encode=function(n){if(isNaN(n))return"DaN";if(n===0)return"FE  0M0";if(n===1/0)return"FF";if(n===-1/0)return"DD";var i=n.toExponential().split("e"),s=Number(i[1])+500,o=i[0]+(i[0].indexOf(".")===-1?".":"")+"0".repeat(20),a="E"+r(String(s),3)+"M"+String(o);return n>0?"F"+a:"D"+t(a)},e.decode=function(n){if(n==="DaN")return NaN;if(n==="FF")return 1/0;if(n==="DD")return-1/0;var i=n[0]==="D",s=(i?t(n):n).slice(2).split("M");return+((i?"-":"")+s[1]+"e"+String(Number(s[0])-500))};function t(n){for(var i="",s=0;s<n.length;s++){var o=n[s];isNaN(Number(o))||o===" "?o!=="-"&&(i+=o):i+=String(9-Number(o))}return i}function r(n,i){return" ".repeat(i-n.length).substr(0,i)+n}}),bf=q(e=>{var t={"?":"?@","!":"??",'"':"?%"};function r(s){return/[!"]/.test(s)?s.replace(/[\?!"]/g,function(o){return t[o]}):s}var n={"?@":"?","??":"!","?%":'"'};function i(s){return/\?[%\?@]/.test(s)?s.replace(/\?[%\?@]/g,function(o){return n[o]}):s}e.factory=function(s){return{encode:o,decode:l};function o(u){if(u===null)return"A";if(!Array.isArray(u))throw new Error("can only encode arrays");var c=u.length;if(c==0)return"K!";for(var f=a(u[0]),w=1;w<c;w++)f+='"'+a(u[w]);return"K"+f+"!"}function a(u){return typeof u=="object"?o(u):r(s.encode(u))}function l(u){if(u==="A")return null;if(u==="K!")return[];for(var c=u.split('"'),f=[[]],w,d=0,y=c.length,h=0;h<y;h++){for(var p=c[h],g=p.length,m=0;p[m]=="K";)m++;for(var b=0;p[g-b-1]=="!";)b++;for(var k=p.slice(m,g-b),S=d+m,B=d;B<S;B++)f[B+1]=[],f[B].push(f[B+1]),d=S,w=f[d];k.length!==0&&w.push(s.decode(i(k)));for(var S=d-b,B=S;B<d;B++)f[B+1]=[],d=S,w=f[d]}return f[0][0]}}}),mf=q(e=>{var t=gf(),r=bf(),n=e.flip=function(s){var o=s.toString(),a="";for(var l in o)a+=o[l]=="."?".":9-+o[l];return a};e.number=t,e.string={encode:function(s){return/\x00|\x01/.test(s)?"J"+s.replace(/\x01/g,"").replace(/\x00/g,""):"J"+s},decode:function(s){if(s[0]==="J")return s.substring(1)}},e.encode=function(s){return e[typeof s].encode(s)},e.decode=function(s){if(s==="")return s;if(!i[s[0]])throw new Error("no decoder for:"+JSON.stringify(s));return i[s[0]](s)},e.object=r.factory(e),e.boolean={encode:function(s){return s?"C":"B"},decode:function(s){return s==="C"}},e.undefined={encode:function(s){return"L"},decode:function(){}};var i={A:e.object.decode,B:e.boolean.decode,C:e.boolean.decode,D:e.number.decode,F:e.number.decode,J:e.string.decode,K:e.object.decode,L:e.undefined.decode};e.buffer=!1,e.type="charwise"}),vf=q((e,t)=>{"use strict";t.exports=r;function r(n,i){for(var s=new Array(arguments.length-1),o=0,a=2,l=!0;a<arguments.length;)s[o++]=arguments[a++];return new Promise(function(u,c){s[o]=function(f){if(l)if(l=!1,f)c(f);else{for(var w=new Array(arguments.length-1),d=0;d<w.length;)w[d++]=arguments[d];u.apply(null,w)}};try{n.apply(i||null,s)}catch(f){l&&(l=!1,c(f))}})}}),kf=q(e=>{"use strict";var t=e;t.length=function(o){var a=o.length;if(!a)return 0;for(var l=0;--a%4>1&&o.charAt(a)==="=";)++l;return Math.ceil(o.length*3)/4-l};var r=new Array(64),n=new Array(123);for(i=0;i<64;)n[r[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;var i;t.encode=function(o,a,l){for(var u=null,c=[],f=0,w=0,d;a<l;){var y=o[a++];switch(w){case 0:c[f++]=r[y>>2],d=(y&3)<<4,w=1;break;case 1:c[f++]=r[d|y>>4],d=(y&15)<<2,w=2;break;case 2:c[f++]=r[d|y>>6],c[f++]=r[y&63],w=0;break}f>8191&&((u||(u=[])).push(String.fromCharCode.apply(String,c)),f=0)}return w&&(c[f++]=r[d],c[f++]=61,w===1&&(c[f++]=61)),u?(f&&u.push(String.fromCharCode.apply(String,c.slice(0,f))),u.join("")):String.fromCharCode.apply(String,c.slice(0,f))};var s="invalid encoding";t.decode=function(o,a,l){for(var u=l,c=0,f,w=0;w<o.length;){var d=o.charCodeAt(w++);if(d===61&&c>1)break;if((d=n[d])===void 0)throw Error(s);switch(c){case 0:f=d,c=1;break;case 1:a[l++]=f<<2|(d&48)>>4,f=d,c=2;break;case 2:a[l++]=(f&15)<<4|(d&60)>>2,f=d,c=3;break;case 3:a[l++]=(f&3)<<6|d,c=0;break}}if(c===1)throw Error(s);return l-u},t.test=function(o){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(o)}}),Ef=q((e,t)=>{"use strict";t.exports=r;function r(){this._listeners={}}r.prototype.on=function(n,i,s){return(this._listeners[n]||(this._listeners[n]=[])).push({fn:i,ctx:s||this}),this},r.prototype.off=function(n,i){if(n===void 0)this._listeners={};else if(i===void 0)this._listeners[n]=[];else for(var s=this._listeners[n],o=0;o<s.length;)s[o].fn===i?s.splice(o,1):++o;return this},r.prototype.emit=function(n){var i=this._listeners[n];if(i){for(var s=[],o=1;o<arguments.length;)s.push(arguments[o++]);for(o=0;o<i.length;)i[o].fn.apply(i[o++].ctx,s)}return this}}),xf=q((e,t)=>{"use strict";t.exports=r(r);function r(a){return typeof Float32Array<"u"?function(){var l=new Float32Array([-0]),u=new Uint8Array(l.buffer),c=u[3]===128;function f(h,p,g){l[0]=h,p[g]=u[0],p[g+1]=u[1],p[g+2]=u[2],p[g+3]=u[3]}function w(h,p,g){l[0]=h,p[g]=u[3],p[g+1]=u[2],p[g+2]=u[1],p[g+3]=u[0]}a.writeFloatLE=c?f:w,a.writeFloatBE=c?w:f;function d(h,p){return u[0]=h[p],u[1]=h[p+1],u[2]=h[p+2],u[3]=h[p+3],l[0]}function y(h,p){return u[3]=h[p],u[2]=h[p+1],u[1]=h[p+2],u[0]=h[p+3],l[0]}a.readFloatLE=c?d:y,a.readFloatBE=c?y:d}():function(){function l(c,f,w,d){var y=f<0?1:0;if(y&&(f=-f),f===0)c(1/f>0?0:2147483648,w,d);else if(isNaN(f))c(2143289344,w,d);else if(f>34028234663852886e22)c((y<<31|2139095040)>>>0,w,d);else if(f<11754943508222875e-54)c((y<<31|Math.round(f/1401298464324817e-60))>>>0,w,d);else{var h=Math.floor(Math.log(f)/Math.LN2),p=Math.round(f*Math.pow(2,-h)*8388608)&8388607;c((y<<31|h+127<<23|p)>>>0,w,d)}}a.writeFloatLE=l.bind(null,n),a.writeFloatBE=l.bind(null,i);function u(c,f,w){var d=c(f,w),y=(d>>31)*2+1,h=d>>>23&255,p=d&8388607;return h===255?p?NaN:y*(1/0):h===0?y*1401298464324817e-60*p:y*Math.pow(2,h-150)*(p+8388608)}a.readFloatLE=u.bind(null,s),a.readFloatBE=u.bind(null,o)}(),typeof Float64Array<"u"?function(){var l=new Float64Array([-0]),u=new Uint8Array(l.buffer),c=u[7]===128;function f(h,p,g){l[0]=h,p[g]=u[0],p[g+1]=u[1],p[g+2]=u[2],p[g+3]=u[3],p[g+4]=u[4],p[g+5]=u[5],p[g+6]=u[6],p[g+7]=u[7]}function w(h,p,g){l[0]=h,p[g]=u[7],p[g+1]=u[6],p[g+2]=u[5],p[g+3]=u[4],p[g+4]=u[3],p[g+5]=u[2],p[g+6]=u[1],p[g+7]=u[0]}a.writeDoubleLE=c?f:w,a.writeDoubleBE=c?w:f;function d(h,p){return u[0]=h[p],u[1]=h[p+1],u[2]=h[p+2],u[3]=h[p+3],u[4]=h[p+4],u[5]=h[p+5],u[6]=h[p+6],u[7]=h[p+7],l[0]}function y(h,p){return u[7]=h[p],u[6]=h[p+1],u[5]=h[p+2],u[4]=h[p+3],u[3]=h[p+4],u[2]=h[p+5],u[1]=h[p+6],u[0]=h[p+7],l[0]}a.readDoubleLE=c?d:y,a.readDoubleBE=c?y:d}():function(){function l(c,f,w,d,y,h){var p=d<0?1:0;if(p&&(d=-d),d===0)c(0,y,h+f),c(1/d>0?0:2147483648,y,h+w);else if(isNaN(d))c(0,y,h+f),c(2146959360,y,h+w);else if(d>17976931348623157e292)c(0,y,h+f),c((p<<31|2146435072)>>>0,y,h+w);else{var g;if(d<22250738585072014e-324)g=d/5e-324,c(g>>>0,y,h+f),c((p<<31|g/4294967296)>>>0,y,h+w);else{var m=Math.floor(Math.log(d)/Math.LN2);m===1024&&(m=1023),g=d*Math.pow(2,-m),c(g*4503599627370496>>>0,y,h+f),c((p<<31|m+1023<<20|g*1048576&1048575)>>>0,y,h+w)}}}a.writeDoubleLE=l.bind(null,n,0,4),a.writeDoubleBE=l.bind(null,i,4,0);function u(c,f,w,d,y){var h=c(d,y+f),p=c(d,y+w),g=(p>>31)*2+1,m=p>>>20&2047,b=4294967296*(p&1048575)+h;return m===2047?b?NaN:g*(1/0):m===0?g*5e-324*b:g*Math.pow(2,m-1075)*(b+4503599627370496)}a.readDoubleLE=u.bind(null,s,0,4),a.readDoubleBE=u.bind(null,o,4,0)}(),a}function n(a,l,u){l[u]=a&255,l[u+1]=a>>>8&255,l[u+2]=a>>>16&255,l[u+3]=a>>>24}function i(a,l,u){l[u]=a>>>24,l[u+1]=a>>>16&255,l[u+2]=a>>>8&255,l[u+3]=a&255}function s(a,l){return(a[l]|a[l+1]<<8|a[l+2]<<16|a[l+3]<<24)>>>0}function o(a,l){return(a[l]<<24|a[l+1]<<16|a[l+2]<<8|a[l+3])>>>0}}),Sf=q((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}}),Af=q(e=>{"use strict";var t=e;t.length=function(r){for(var n=0,i=0,s=0;s<r.length;++s)i=r.charCodeAt(s),i<128?n+=1:i<2048?n+=2:(i&64512)===55296&&(r.charCodeAt(s+1)&64512)===56320?(++s,n+=4):n+=3;return n},t.read=function(r,n,i){var s=i-n;if(s<1)return"";for(var o=null,a=[],l=0,u;n<i;)u=r[n++],u<128?a[l++]=u:u>191&&u<224?a[l++]=(u&31)<<6|r[n++]&63:u>239&&u<365?(u=((u&7)<<18|(r[n++]&63)<<12|(r[n++]&63)<<6|r[n++]&63)-65536,a[l++]=55296+(u>>10),a[l++]=56320+(u&1023)):a[l++]=(u&15)<<12|(r[n++]&63)<<6|r[n++]&63,l>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),l=0);return o?(l&&o.push(String.fromCharCode.apply(String,a.slice(0,l))),o.join("")):String.fromCharCode.apply(String,a.slice(0,l))},t.write=function(r,n,i){for(var s=i,o,a,l=0;l<r.length;++l)o=r.charCodeAt(l),o<128?n[i++]=o:o<2048?(n[i++]=o>>6|192,n[i++]=o&63|128):(o&64512)===55296&&((a=r.charCodeAt(l+1))&64512)===56320?(o=65536+((o&1023)<<10)+(a&1023),++l,n[i++]=o>>18|240,n[i++]=o>>12&63|128,n[i++]=o>>6&63|128,n[i++]=o&63|128):(n[i++]=o>>12|224,n[i++]=o>>6&63|128,n[i++]=o&63|128);return i-s}}),_f=q((e,t)=>{"use strict";t.exports=r;function r(n,i,s){var o=s||8192,a=o>>>1,l=null,u=o;return function(c){if(c<1||c>a)return n(c);u+c>o&&(l=n(o),u=0);var f=i.call(l,u,u+=c);return u&7&&(u=(u|7)+1),f}}}),Ff=q((e,t)=>{"use strict";t.exports=n;var r=et();function n(a,l){this.lo=a>>>0,this.hi=l>>>0}var i=n.zero=new n(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var s=n.zeroHash="\0\0\0\0\0\0\0\0";n.fromNumber=function(a){if(a===0)return i;var l=a<0;l&&(a=-a);var u=a>>>0,c=(a-u)/4294967296>>>0;return l&&(c=~c>>>0,u=~u>>>0,++u>4294967295&&(u=0,++c>4294967295&&(c=0))),new n(u,c)},n.from=function(a){if(typeof a=="number")return n.fromNumber(a);if(r.isString(a))if(r.Long)a=r.Long.fromString(a);else return n.fromNumber(parseInt(a,10));return a.low||a.high?new n(a.low>>>0,a.high>>>0):i},n.prototype.toNumber=function(a){if(!a&&this.hi>>>31){var l=~this.lo+1>>>0,u=~this.hi>>>0;return l||(u=u+1>>>0),-(l+u*4294967296)}return this.lo+this.hi*4294967296},n.prototype.toLong=function(a){return r.Long?new r.Long(this.lo|0,this.hi|0,!!a):{low:this.lo|0,high:this.hi|0,unsigned:!!a}};var o=String.prototype.charCodeAt;n.fromHash=function(a){return a===s?i:new n((o.call(a,0)|o.call(a,1)<<8|o.call(a,2)<<16|o.call(a,3)<<24)>>>0,(o.call(a,4)|o.call(a,5)<<8|o.call(a,6)<<16|o.call(a,7)<<24)>>>0)},n.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},n.prototype.zzEncode=function(){var a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0,this.lo=(this.lo<<1^a)>>>0,this},n.prototype.zzDecode=function(){var a=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0,this.hi=(this.hi>>>1^a)>>>0,this},n.prototype.length=function(){var a=this.lo,l=(this.lo>>>28|this.hi<<4)>>>0,u=this.hi>>>24;return u===0?l===0?a<16384?a<128?1:2:a<2097152?3:4:l<16384?l<128?5:6:l<2097152?7:8:u<128?9:10}}),et=q(e=>{"use strict";var t=e;t.asPromise=vf(),t.base64=kf(),t.EventEmitter=Ef(),t.float=xf(),t.inquire=Sf(),t.utf8=Af(),t.pool=_f(),t.LongBits=Ff(),t.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node),t.global=t.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||e,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i},t.isString=function(i){return typeof i=="string"||i instanceof String},t.isObject=function(i){return i&&typeof i=="object"},t.isset=t.isSet=function(i,s){var o=i[s];return o!=null&&i.hasOwnProperty(s)?typeof o!="object"||(Array.isArray(o)?o.length:Object.keys(o).length)>0:!1},t.Buffer=function(){try{var i=t.inquire("buffer").Buffer;return i.prototype.utf8Write?i:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(i){return typeof i=="number"?t.Buffer?t._Buffer_allocUnsafe(i):new t.Array(i):t.Buffer?t._Buffer_from(i):typeof Uint8Array>"u"?i:new Uint8Array(i)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(i){return i?t.LongBits.from(i).toHash():t.LongBits.zeroHash},t.longFromHash=function(i,s){var o=t.LongBits.fromHash(i);return t.Long?t.Long.fromBits(o.lo,o.hi,s):o.toNumber(!!s)};function r(i,s,o){for(var a=Object.keys(s),l=0;l<a.length;++l)(i[a[l]]===void 0||!o)&&(i[a[l]]=s[a[l]]);return i}t.merge=r,t.lcFirst=function(i){return i.charAt(0).toLowerCase()+i.substring(1)};function n(i){function s(o,a){if(!(this instanceof s))return new s(o,a);Object.defineProperty(this,"message",{get:function(){return o}}),Error.captureStackTrace?Error.captureStackTrace(this,s):Object.defineProperty(this,"stack",{value:new Error().stack||""}),a&&r(this,a)}return s.prototype=Object.create(Error.prototype,{constructor:{value:s,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return i},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),s}t.newError=n,t.ProtocolError=n("ProtocolError"),t.oneOfGetter=function(i){for(var s={},o=0;o<i.length;++o)s[i[o]]=1;return function(){for(var a=Object.keys(this),l=a.length-1;l>-1;--l)if(s[a[l]]===1&&this[a[l]]!==void 0&&this[a[l]]!==null)return a[l]}},t.oneOfSetter=function(i){return function(s){for(var o=0;o<i.length;++o)i[o]!==s&&delete this[i[o]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var i=t.Buffer;if(!i){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=i.from!==Uint8Array.from&&i.from||function(s,o){return new i(s,o)},t._Buffer_allocUnsafe=i.allocUnsafe||function(s){return new i(s)}}}),Ji=q((e,t)=>{"use strict";t.exports=c;var r=et(),n,i=r.LongBits,s=r.base64,o=r.utf8;function a(m,b,k){this.fn=m,this.len=b,this.next=void 0,this.val=k}function l(){}function u(m){this.head=m.head,this.tail=m.tail,this.len=m.len,this.next=m.states}function c(){this.len=0,this.head=new a(l,0,0),this.tail=this.head,this.states=null}var f=function(){return r.Buffer?function(){return(c.create=function(){return new n})()}:function(){return new c}};c.create=f(),c.alloc=function(m){return new r.Array(m)},r.Array!==Array&&(c.alloc=r.pool(c.alloc,r.Array.prototype.subarray)),c.prototype._push=function(m,b,k){return this.tail=this.tail.next=new a(m,b,k),this.len+=b,this};function w(m,b,k){b[k]=m&255}function d(m,b,k){for(;m>127;)b[k++]=m&127|128,m>>>=7;b[k]=m}function y(m,b){this.len=m,this.next=void 0,this.val=b}y.prototype=Object.create(a.prototype),y.prototype.fn=d,c.prototype.uint32=function(m){return this.len+=(this.tail=this.tail.next=new y((m=m>>>0)<128?1:m<16384?2:m<2097152?3:m<268435456?4:5,m)).len,this},c.prototype.int32=function(m){return m<0?this._push(h,10,i.fromNumber(m)):this.uint32(m)},c.prototype.sint32=function(m){return this.uint32((m<<1^m>>31)>>>0)};function h(m,b,k){for(;m.hi;)b[k++]=m.lo&127|128,m.lo=(m.lo>>>7|m.hi<<25)>>>0,m.hi>>>=7;for(;m.lo>127;)b[k++]=m.lo&127|128,m.lo=m.lo>>>7;b[k++]=m.lo}c.prototype.uint64=function(m){var b=i.from(m);return this._push(h,b.length(),b)},c.prototype.int64=c.prototype.uint64,c.prototype.sint64=function(m){var b=i.from(m).zzEncode();return this._push(h,b.length(),b)},c.prototype.bool=function(m){return this._push(w,1,m?1:0)};function p(m,b,k){b[k]=m&255,b[k+1]=m>>>8&255,b[k+2]=m>>>16&255,b[k+3]=m>>>24}c.prototype.fixed32=function(m){return this._push(p,4,m>>>0)},c.prototype.sfixed32=c.prototype.fixed32,c.prototype.fixed64=function(m){var b=i.from(m);return this._push(p,4,b.lo)._push(p,4,b.hi)},c.prototype.sfixed64=c.prototype.fixed64,c.prototype.float=function(m){return this._push(r.float.writeFloatLE,4,m)},c.prototype.double=function(m){return this._push(r.float.writeDoubleLE,8,m)};var g=r.Array.prototype.set?function(m,b,k){b.set(m,k)}:function(m,b,k){for(var S=0;S<m.length;++S)b[k+S]=m[S]};c.prototype.bytes=function(m){var b=m.length>>>0;if(!b)return this._push(w,1,0);if(r.isString(m)){var k=c.alloc(b=s.length(m));s.decode(m,k,0),m=k}return this.uint32(b)._push(g,b,m)},c.prototype.string=function(m){var b=o.length(m);return b?this.uint32(b)._push(o.write,b,m):this._push(w,1,0)},c.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new a(l,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new a(l,0,0),this.len=0),this},c.prototype.ldelim=function(){var m=this.head,b=this.tail,k=this.len;return this.reset().uint32(k),k&&(this.tail.next=m.next,this.tail=b,this.len+=k),this},c.prototype.finish=function(){for(var m=this.head.next,b=this.constructor.alloc(this.len),k=0;m;)m.fn(m.val,b,k),k+=m.len,m=m.next;return b},c._configure=function(m){n=m,c.create=f(),n._configure()}}),Xa=q((e,t)=>{"use strict";t.exports=i;var r=Ji();(i.prototype=Object.create(r.prototype)).constructor=i;var n=et();function i(){r.call(this)}i._configure=function(){i.alloc=n._Buffer_allocUnsafe,i.writeBytesBuffer=n.Buffer&&n.Buffer.prototype instanceof Uint8Array&&n.Buffer.prototype.set.name==="set"?function(o,a,l){a.set(o,l)}:function(o,a,l){if(o.copy)o.copy(a,l,0,o.length);else for(var u=0;u<o.length;)a[l++]=o[u++]}},i.prototype.bytes=function(o){n.isString(o)&&(o=n._Buffer_from(o,"base64"));var a=o.length>>>0;return this.uint32(a),a&&this._push(i.writeBytesBuffer,a,o),this};function s(o,a,l){o.length<40?n.utf8.write(o,a,l):a.utf8Write?a.utf8Write(o,l):a.write(o,l)}i.prototype.string=function(o){var a=n.Buffer.byteLength(o);return this.uint32(a),a&&this._push(s,a,o),this},i._configure()}),Qi=q((e,t)=>{"use strict";t.exports=a;var r=et(),n,i=r.LongBits,s=r.utf8;function o(d,y){return RangeError("index out of range: "+d.pos+" + "+(y||1)+" > "+d.len)}function a(d){this.buf=d,this.pos=0,this.len=d.length}var l=typeof Uint8Array<"u"?function(d){if(d instanceof Uint8Array||Array.isArray(d))return new a(d);throw Error("illegal buffer")}:function(d){if(Array.isArray(d))return new a(d);throw Error("illegal buffer")},u=function(){return r.Buffer?function(d){return(a.create=function(y){return r.Buffer.isBuffer(y)?new n(y):l(y)})(d)}:l};a.create=u(),a.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,a.prototype.uint32=function(){var d=4294967295;return function(){if(d=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(d=(d|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(d=(d|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(d=(d|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(d=(d|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return d;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return d}}(),a.prototype.int32=function(){return this.uint32()|0},a.prototype.sint32=function(){var d=this.uint32();return d>>>1^-(d&1)|0};function c(){var d=new i(0,0),y=0;if(this.len-this.pos>4){for(;y<4;++y)if(d.lo=(d.lo|(this.buf[this.pos]&127)<<y*7)>>>0,this.buf[this.pos++]<128)return d;if(d.lo=(d.lo|(this.buf[this.pos]&127)<<28)>>>0,d.hi=(d.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return d;y=0}else{for(;y<3;++y){if(this.pos>=this.len)throw o(this);if(d.lo=(d.lo|(this.buf[this.pos]&127)<<y*7)>>>0,this.buf[this.pos++]<128)return d}return d.lo=(d.lo|(this.buf[this.pos++]&127)<<y*7)>>>0,d}if(this.len-this.pos>4){for(;y<5;++y)if(d.hi=(d.hi|(this.buf[this.pos]&127)<<y*7+3)>>>0,this.buf[this.pos++]<128)return d}else for(;y<5;++y){if(this.pos>=this.len)throw o(this);if(d.hi=(d.hi|(this.buf[this.pos]&127)<<y*7+3)>>>0,this.buf[this.pos++]<128)return d}throw Error("invalid varint encoding")}a.prototype.bool=function(){return this.uint32()!==0};function f(d,y){return(d[y-4]|d[y-3]<<8|d[y-2]<<16|d[y-1]<<24)>>>0}a.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return f(this.buf,this.pos+=4)},a.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return f(this.buf,this.pos+=4)|0};function w(){if(this.pos+8>this.len)throw o(this,8);return new i(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}a.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var d=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,d},a.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var d=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,d},a.prototype.bytes=function(){var d=this.uint32(),y=this.pos,h=this.pos+d;if(h>this.len)throw o(this,d);return this.pos+=d,Array.isArray(this.buf)?this.buf.slice(y,h):y===h?new this.buf.constructor(0):this._slice.call(this.buf,y,h)},a.prototype.string=function(){var d=this.bytes();return s.read(d,0,d.length)},a.prototype.skip=function(d){if(typeof d=="number"){if(this.pos+d>this.len)throw o(this,d);this.pos+=d}else do if(this.pos>=this.len)throw o(this);while(this.buf[this.pos++]&128);return this},a.prototype.skipType=function(d){switch(d){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(d=this.uint32()&7)!==4;)this.skipType(d);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+d+" at offset "+this.pos)}return this},a._configure=function(d){n=d,a.create=u(),n._configure();var y=r.Long?"toLong":"toNumber";r.merge(a.prototype,{int64:function(){return c.call(this)[y](!1)},uint64:function(){return c.call(this)[y](!0)},sint64:function(){return c.call(this).zzDecode()[y](!1)},fixed64:function(){return w.call(this)[y](!0)},sfixed64:function(){return w.call(this)[y](!1)}})}}),Ya=q((e,t)=>{"use strict";t.exports=i;var r=Qi();(i.prototype=Object.create(r.prototype)).constructor=i;var n=et();function i(s){r.call(this,s)}i._configure=function(){n.Buffer&&(i.prototype._slice=n.Buffer.prototype.slice)},i.prototype.string=function(){var s=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+s,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+s,this.len))},i._configure()}),Bf=q((e,t)=>{"use strict";t.exports=n;var r=et();(n.prototype=Object.create(r.EventEmitter.prototype)).constructor=n;function n(i,s,o){if(typeof i!="function")throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=i,this.requestDelimited=!!s,this.responseDelimited=!!o}n.prototype.rpcCall=function i(s,o,a,l,u){if(!l)throw TypeError("request must be specified");var c=this;if(!u)return r.asPromise(i,c,s,o,a,l);if(!c.rpcImpl){setTimeout(function(){u(Error("already ended"))},0);return}try{return c.rpcImpl(s,o[c.requestDelimited?"encodeDelimited":"encode"](l).finish(),function(f,w){if(f)return c.emit("error",f,s),u(f);if(w===null){c.end(!0);return}if(!(w instanceof a))try{w=a[c.responseDelimited?"decodeDelimited":"decode"](w)}catch(d){return c.emit("error",d,s),u(d)}return c.emit("data",w,s),u(null,w)})}catch(f){c.emit("error",f,s),setTimeout(function(){u(f)},0);return}},n.prototype.end=function(i){return this.rpcImpl&&(i||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}}),Tf=q(e=>{"use strict";var t=e;t.Service=Bf()}),Cf=q((e,t)=>{"use strict";t.exports={}}),Df=q(e=>{"use strict";var t=e;t.build="minimal",t.Writer=Ji(),t.BufferWriter=Xa(),t.Reader=Qi(),t.BufferReader=Ya(),t.util=et(),t.rpc=Tf(),t.roots=Cf(),t.configure=r;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}r()}),Nf=q((e,t)=>{"use strict";t.exports=Df()}),Lf=q((e,t)=>{(function(r,n){"use strict";var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function s(h){if(!Array.isArray(h)&&!ArrayBuffer.isView(h))return!1;for(var p=0;p<h.length;p++)if(!Number.isInteger(h[p])||h[p]<0||h[p]>255)return!1;return!0}function o(h,p){return(h&65535)*p+(((h>>>16)*p&65535)<<16)}function a(h,p){return h<<p|h>>>32-p}function l(h){return h^=h>>>16,h=o(h,2246822507),h^=h>>>13,h=o(h,3266489909),h^=h>>>16,h}function u(h,p){h=[h[0]>>>16,h[0]&65535,h[1]>>>16,h[1]&65535],p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535];var g=[0,0,0,0];return g[3]+=h[3]+p[3],g[2]+=g[3]>>>16,g[3]&=65535,g[2]+=h[2]+p[2],g[1]+=g[2]>>>16,g[2]&=65535,g[1]+=h[1]+p[1],g[0]+=g[1]>>>16,g[1]&=65535,g[0]+=h[0]+p[0],g[0]&=65535,[g[0]<<16|g[1],g[2]<<16|g[3]]}function c(h,p){h=[h[0]>>>16,h[0]&65535,h[1]>>>16,h[1]&65535],p=[p[0]>>>16,p[0]&65535,p[1]>>>16,p[1]&65535];var g=[0,0,0,0];return g[3]+=h[3]*p[3],g[2]+=g[3]>>>16,g[3]&=65535,g[2]+=h[2]*p[3],g[1]+=g[2]>>>16,g[2]&=65535,g[2]+=h[3]*p[2],g[1]+=g[2]>>>16,g[2]&=65535,g[1]+=h[1]*p[3],g[0]+=g[1]>>>16,g[1]&=65535,g[1]+=h[2]*p[2],g[0]+=g[1]>>>16,g[1]&=65535,g[1]+=h[3]*p[1],g[0]+=g[1]>>>16,g[1]&=65535,g[0]+=h[0]*p[3]+h[1]*p[2]+h[2]*p[1]+h[3]*p[0],g[0]&=65535,[g[0]<<16|g[1],g[2]<<16|g[3]]}function f(h,p){return p%=64,p===32?[h[1],h[0]]:p<32?[h[0]<<p|h[1]>>>32-p,h[1]<<p|h[0]>>>32-p]:(p-=32,[h[1]<<p|h[0]>>>32-p,h[0]<<p|h[1]>>>32-p])}function w(h,p){return p%=64,p===0?h:p<32?[h[0]<<p|h[1]>>>32-p,h[1]<<p]:[h[1]<<p-32,0]}function d(h,p){return[h[0]^p[0],h[1]^p[1]]}function y(h){return h=d(h,[0,h[0]>>>1]),h=c(h,[4283543511,3981806797]),h=d(h,[0,h[0]>>>1]),h=c(h,[3301882366,444984403]),h=d(h,[0,h[0]>>>1]),h}i.x86.hash32=function(h,p){if(i.inputValidation&&!s(h))return n;p=p||0;for(var g=h.length%4,m=h.length-g,b=p,k=0,S=3432918353,B=461845907,N=0;N<m;N=N+4)k=h[N]|h[N+1]<<8|h[N+2]<<16|h[N+3]<<24,k=o(k,S),k=a(k,15),k=o(k,B),b^=k,b=a(b,13),b=o(b,5)+3864292196;switch(k=0,g){case 3:k^=h[N+2]<<16;case 2:k^=h[N+1]<<8;case 1:k^=h[N],k=o(k,S),k=a(k,15),k=o(k,B),b^=k}return b^=h.length,b=l(b),b>>>0},i.x86.hash128=function(h,p){if(i.inputValidation&&!s(h))return n;p=p||0;for(var g=h.length%16,m=h.length-g,b=p,k=p,S=p,B=p,N=0,M=0,D=0,W=0,kt=597399067,Et=2869860233,oe=951274213,xt=2716044179,U=0;U<m;U=U+16)N=h[U]|h[U+1]<<8|h[U+2]<<16|h[U+3]<<24,M=h[U+4]|h[U+5]<<8|h[U+6]<<16|h[U+7]<<24,D=h[U+8]|h[U+9]<<8|h[U+10]<<16|h[U+11]<<24,W=h[U+12]|h[U+13]<<8|h[U+14]<<16|h[U+15]<<24,N=o(N,kt),N=a(N,15),N=o(N,Et),b^=N,b=a(b,19),b+=k,b=o(b,5)+1444728091,M=o(M,Et),M=a(M,16),M=o(M,oe),k^=M,k=a(k,17),k+=S,k=o(k,5)+197830471,D=o(D,oe),D=a(D,17),D=o(D,xt),S^=D,S=a(S,15),S+=B,S=o(S,5)+2530024501,W=o(W,xt),W=a(W,18),W=o(W,kt),B^=W,B=a(B,13),B+=b,B=o(B,5)+850148119;switch(N=0,M=0,D=0,W=0,g){case 15:W^=h[U+14]<<16;case 14:W^=h[U+13]<<8;case 13:W^=h[U+12],W=o(W,xt),W=a(W,18),W=o(W,kt),B^=W;case 12:D^=h[U+11]<<24;case 11:D^=h[U+10]<<16;case 10:D^=h[U+9]<<8;case 9:D^=h[U+8],D=o(D,oe),D=a(D,17),D=o(D,xt),S^=D;case 8:M^=h[U+7]<<24;case 7:M^=h[U+6]<<16;case 6:M^=h[U+5]<<8;case 5:M^=h[U+4],M=o(M,Et),M=a(M,16),M=o(M,oe),k^=M;case 4:N^=h[U+3]<<24;case 3:N^=h[U+2]<<16;case 2:N^=h[U+1]<<8;case 1:N^=h[U],N=o(N,kt),N=a(N,15),N=o(N,Et),b^=N}return b^=h.length,k^=h.length,S^=h.length,B^=h.length,b+=k,b+=S,b+=B,k+=b,S+=b,B+=b,b=l(b),k=l(k),S=l(S),B=l(B),b+=k,b+=S,b+=B,k+=b,S+=b,B+=b,("00000000"+(b>>>0).toString(16)).slice(-8)+("00000000"+(k>>>0).toString(16)).slice(-8)+("00000000"+(S>>>0).toString(16)).slice(-8)+("00000000"+(B>>>0).toString(16)).slice(-8)},i.x64.hash128=function(h,p){if(i.inputValidation&&!s(h))return n;p=p||0;for(var g=h.length%16,m=h.length-g,b=[0,p],k=[0,p],S=[0,0],B=[0,0],N=[2277735313,289559509],M=[1291169091,658871167],D=0;D<m;D=D+16)S=[h[D+4]|h[D+5]<<8|h[D+6]<<16|h[D+7]<<24,h[D]|h[D+1]<<8|h[D+2]<<16|h[D+3]<<24],B=[h[D+12]|h[D+13]<<8|h[D+14]<<16|h[D+15]<<24,h[D+8]|h[D+9]<<8|h[D+10]<<16|h[D+11]<<24],S=c(S,N),S=f(S,31),S=c(S,M),b=d(b,S),b=f(b,27),b=u(b,k),b=u(c(b,[0,5]),[0,1390208809]),B=c(B,M),B=f(B,33),B=c(B,N),k=d(k,B),k=f(k,31),k=u(k,b),k=u(c(k,[0,5]),[0,944331445]);switch(S=[0,0],B=[0,0],g){case 15:B=d(B,w([0,h[D+14]],48));case 14:B=d(B,w([0,h[D+13]],40));case 13:B=d(B,w([0,h[D+12]],32));case 12:B=d(B,w([0,h[D+11]],24));case 11:B=d(B,w([0,h[D+10]],16));case 10:B=d(B,w([0,h[D+9]],8));case 9:B=d(B,[0,h[D+8]]),B=c(B,M),B=f(B,33),B=c(B,N),k=d(k,B);case 8:S=d(S,w([0,h[D+7]],56));case 7:S=d(S,w([0,h[D+6]],48));case 6:S=d(S,w([0,h[D+5]],40));case 5:S=d(S,w([0,h[D+4]],32));case 4:S=d(S,w([0,h[D+3]],24));case 3:S=d(S,w([0,h[D+2]],16));case 2:S=d(S,w([0,h[D+1]],8));case 1:S=d(S,[0,h[D]]),S=c(S,N),S=f(S,31),S=c(S,M),b=d(b,S)}return b=d(b,[0,h.length]),k=d(k,[0,h.length]),b=u(b,k),k=u(k,b),b=y(b),k=y(k),b=u(b,k),k=u(k,b),("00000000"+(b[0]>>>0).toString(16)).slice(-8)+("00000000"+(b[1]>>>0).toString(16)).slice(-8)+("00000000"+(k[0]>>>0).toString(16)).slice(-8)+("00000000"+(k[1]>>>0).toString(16)).slice(-8)},typeof e<"u"?(typeof t<"u"&&t.exports&&(e=t.exports=i),e.murmurHash3=i):typeof define=="function"&&define.amd?define([],function(){return i}):(i._murmurHash3=r.murmurHash3,i.noConflict=function(){return r.murmurHash3=i._murmurHash3,i._murmurHash3=n,i.noConflict=n,i},r.murmurHash3=i)})(e)}),Za=q((e,t)=>{t.exports=Lf()}),Ue=q((e,t)=>{"use strict";function r(i,s){for(let o in s)Object.defineProperty(i,o,{value:s[o],enumerable:!0,configurable:!0});return i}function n(i,s,o){if(!i||typeof i=="string")throw new TypeError("Please pass an Error to err-code");o||(o={}),typeof s=="object"&&(o=s,s=""),s&&(o.code=s);try{return r(i,o)}catch{o.message=i.message,o.stack=i.stack;let a=function(){};return a.prototype=Object.create(Object.getPrototypeOf(i)),r(new a,o)}}t.exports=n}),If=q((e,t)=>{"use strict";t.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(o,a){let l=this._internalPositionFor(o,!1);if(a===void 0)l!==-1&&(this._unsetInternalPos(l),this._unsetBit(o),this._changedLength=!0,this._changedData=!0);else{let u=!1;l===-1?(l=this._data.length,this._setBit(o),this._changedData=!0):u=!0,this._setInternalPos(l,o,a,u),this._changedLength=!0}}unset(o){this.set(o,void 0)}get(o){this._sortData();let a=this._internalPositionFor(o,!0);if(a!==-1)return this._data[a][1]}push(o){return this.set(this.length,o),this.length}get length(){if(this._sortData(),this._changedLength){let o=this._data[this._data.length-1];this._length=o?o[0]+1:0,this._changedLength=!1}return this._length}forEach(o){let a=0;for(;a<this.length;)o(this.get(a),a,this),a++}map(o){let a=0,l=new Array(this.length);for(;a<this.length;)l[a]=o(this.get(a),a,this),a++;return l}reduce(o,a){let l=0,u=a;for(;l<this.length;){let c=this.get(l);u=o(u,c,l),l++}return u}find(o){let a=0,l,u;for(;a<this.length&&!l;)u=this.get(a),l=o(u),a++;return l?u:void 0}_internalPositionFor(o,a){let l=this._bytePosFor(o,a);if(l>=this._bitArrays.length)return-1;let u=this._bitArrays[l],c=o-l*7;if(!((u&1<<c)>0))return-1;let f=this._bitArrays.slice(0,l).reduce(r,0),w=~(4294967295<<c+1),d=n(u&w);return f+d-1}_bytePosFor(o,a){let l=Math.floor(o/7),u=l+1;for(;!a&&this._bitArrays.length<u;)this._bitArrays.push(0);return l}_setBit(o){let a=this._bytePosFor(o,!1);this._bitArrays[a]|=1<<o-a*7}_unsetBit(o){let a=this._bytePosFor(o,!1);this._bitArrays[a]&=~(1<<o-a*7)}_setInternalPos(o,a,l,u){let c=this._data,f=[a,l];if(u)this._sortData(),c[o]=f;else{if(c.length)if(c[c.length-1][0]>=a)c.push(f);else if(c[0][0]<=a)c.unshift(f);else{let w=Math.round(c.length/2);this._data=c.slice(0,w).concat(f).concat(c.slice(w))}else this._data.push(f);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(o){this._data.splice(o,1)}_sortData(){this._changedData&&this._data.sort(i),this._changedData=!1}bitField(){let o=[],a=8,l=0,u=0,c,f=this._bitArrays.slice();for(;f.length||l;){l===0&&(c=f.shift(),l=7);let d=Math.min(l,a),y=~(255<<d),h=c&y;u|=h<<8-a,c=c>>>d,l-=d,a-=d,(!a||!l&&!f.length)&&(o.push(u),u=0,a=8)}for(var w=o.length-1;w>0&&o[w]===0;w--)o.pop();return o}compactArray(){return this._sortData(),this._data.map(s)}};function r(o,a){return o+n(a)}function n(o){let a=o;return a=a-(a>>1&1431655765),a=(a&858993459)+(a>>2&858993459),(a+(a>>4)&252645135)*16843009>>24}function i(o,a){return o[0]-a[0]}function s(o){return o[1]}}),Of=q((e,t)=>{"use strict";var r=Object.prototype.hasOwnProperty,n="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(n=!1));function s(u,c,f){this.fn=u,this.context=c,this.once=f||!1}function o(u,c,f,w,d){if(typeof f!="function")throw new TypeError("The listener must be a function");var y=new s(f,w||u,d),h=n?n+c:c;return u._events[h]?u._events[h].fn?u._events[h]=[u._events[h],y]:u._events[h].push(y):(u._events[h]=y,u._eventsCount++),u}function a(u,c){--u._eventsCount===0?u._events=new i:delete u._events[c]}function l(){this._events=new i,this._eventsCount=0}l.prototype.eventNames=function(){var u=[],c,f;if(this._eventsCount===0)return u;for(f in c=this._events)r.call(c,f)&&u.push(n?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},l.prototype.listeners=function(u){var c=n?n+u:u,f=this._events[c];if(!f)return[];if(f.fn)return[f.fn];for(var w=0,d=f.length,y=new Array(d);w<d;w++)y[w]=f[w].fn;return y},l.prototype.listenerCount=function(u){var c=n?n+u:u,f=this._events[c];return f?f.fn?1:f.length:0},l.prototype.emit=function(u,c,f,w,d,y){var h=n?n+u:u;if(!this._events[h])return!1;var p=this._events[h],g=arguments.length,m,b;if(p.fn){switch(p.once&&this.removeListener(u,p.fn,void 0,!0),g){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,c),!0;case 3:return p.fn.call(p.context,c,f),!0;case 4:return p.fn.call(p.context,c,f,w),!0;case 5:return p.fn.call(p.context,c,f,w,d),!0;case 6:return p.fn.call(p.context,c,f,w,d,y),!0}for(b=1,m=new Array(g-1);b<g;b++)m[b-1]=arguments[b];p.fn.apply(p.context,m)}else{var k=p.length,S;for(b=0;b<k;b++)switch(p[b].once&&this.removeListener(u,p[b].fn,void 0,!0),g){case 1:p[b].fn.call(p[b].context);break;case 2:p[b].fn.call(p[b].context,c);break;case 3:p[b].fn.call(p[b].context,c,f);break;case 4:p[b].fn.call(p[b].context,c,f,w);break;default:if(!m)for(S=1,m=new Array(g-1);S<g;S++)m[S-1]=arguments[S];p[b].fn.apply(p[b].context,m)}}return!0},l.prototype.on=function(u,c,f){return o(this,u,c,f,!1)},l.prototype.once=function(u,c,f){return o(this,u,c,f,!0)},l.prototype.removeListener=function(u,c,f,w){var d=n?n+u:u;if(!this._events[d])return this;if(!c)return a(this,d),this;var y=this._events[d];if(y.fn)y.fn===c&&(!w||y.once)&&(!f||y.context===f)&&a(this,d);else{for(var h=0,p=[],g=y.length;h<g;h++)(y[h].fn!==c||w&&!y[h].once||f&&y[h].context!==f)&&p.push(y[h]);p.length?this._events[d]=p.length===1?p[0]:p:a(this,d)}return this},l.prototype.removeAllListeners=function(u){var c;return u?(c=n?n+u:u,this._events[c]&&a(this,c)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=n,l.EventEmitter=l,typeof t<"u"&&(t.exports=l)}),Ir="0123456789abcdef",Po=class Yt{constructor(t){this.bytes=t}static ofInner(t){if(t.length!==16)throw new TypeError("not 128-bit length");return new Yt(t)}static fromFieldsV7(t,r,n,i){if(!Number.isInteger(t)||!Number.isInteger(r)||!Number.isInteger(n)||!Number.isInteger(i)||t<0||r<0||n<0||i<0||t>0xffffffffffff||r>4095||n>1073741823||i>4294967295)throw new RangeError("invalid field value");let s=new Uint8Array(16);return s[0]=t/2**40,s[1]=t/2**32,s[2]=t/2**24,s[3]=t/2**16,s[4]=t/2**8,s[5]=t,s[6]=112|r>>>8,s[7]=r,s[8]=128|n>>>24,s[9]=n>>>16,s[10]=n>>>8,s[11]=n,s[12]=i>>>24,s[13]=i>>>16,s[14]=i>>>8,s[15]=i,new Yt(s)}static parse(t){var r,n,i,s;let o;switch(t.length){case 32:o=(r=/^[0-9a-f]{32}$/i.exec(t))===null||r===void 0?void 0:r[0];break;case 36:o=(n=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(t))===null||n===void 0?void 0:n.slice(1,6).join("");break;case 38:o=(i=/^\{([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\}$/i.exec(t))===null||i===void 0?void 0:i.slice(1,6).join("");break;case 45:o=(s=/^urn:uuid:([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(t))===null||s===void 0?void 0:s.slice(1,6).join("");break;default:break}if(o){let a=new Uint8Array(16);for(let l=0;l<16;l+=4){let u=parseInt(o.substring(2*l,2*l+8),16);a[l+0]=u>>>24,a[l+1]=u>>>16,a[l+2]=u>>>8,a[l+3]=u}return new Yt(a)}else throw new SyntaxError("could not parse UUID string")}toString(){let t="";for(let r=0;r<this.bytes.length;r++)t+=Ir.charAt(this.bytes[r]>>>4),t+=Ir.charAt(this.bytes[r]&15),(r===3||r===5||r===7||r===9)&&(t+="-");return t}toHex(){let t="";for(let r=0;r<this.bytes.length;r++)t+=Ir.charAt(this.bytes[r]>>>4),t+=Ir.charAt(this.bytes[r]&15);return t}toJSON(){return this.toString()}getVariant(){let t=this.bytes[8]>>>4;if(t<0)throw new Error("unreachable");if(t<=7)return this.bytes.every(r=>r===0)?"NIL":"VAR_0";if(t<=11)return"VAR_10";if(t<=13)return"VAR_110";if(t<=15)return this.bytes.every(r=>r===255)?"MAX":"VAR_RESERVED";throw new Error("unreachable")}getVersion(){return this.getVariant()==="VAR_10"?this.bytes[6]>>>4:void 0}clone(){return new Yt(this.bytes.slice(0))}equals(t){return this.compareTo(t)===0}compareTo(t){for(let r=0;r<16;r++){let n=this.bytes[r]-t.bytes[r];if(n!==0)return Math.sign(n)}return 0}},Pf=class{constructor(e){this.timestamp=0,this.counter=0,this.random=e??Mf()}generate(){return this.generateOrResetCore(Date.now(),1e4)}generateOrAbort(){return this.generateOrAbortCore(Date.now(),1e4)}generateOrResetCore(e,t){let r=this.generateOrAbortCore(e,t);return r===void 0&&(this.timestamp=0,r=this.generateOrAbortCore(e,t)),r}generateOrAbortCore(e,t){if(!Number.isInteger(e)||e<1||e>0xffffffffffff)throw new RangeError("`unixTsMs` must be a 48-bit positive integer");if(t<0||t>0xffffffffffff)throw new RangeError("`rollbackAllowance` out of reasonable range");if(e>this.timestamp)this.timestamp=e,this.resetCounter();else if(e+t>=this.timestamp)this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter());else return;return Po.fromFieldsV7(this.timestamp,Math.trunc(this.counter/2**30),this.counter&2**30-1,this.random.nextUint32())}resetCounter(){this.counter=this.random.nextUint32()*1024+(this.random.nextUint32()&1023)}generateV4(){let e=new Uint8Array(Uint32Array.of(this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32()).buffer);return e[6]=64|e[6]>>>4,e[8]=128|e[8]>>>2,Po.ofInner(e)}},Mf=()=>{if(typeof crypto<"u"&&typeof crypto.getRandomValues<"u")return new Uf;if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");return{nextUint32:()=>Math.trunc(Math.random()*65536)*65536+Math.trunc(Math.random()*65536)}},Uf=class{constructor(){this.buffer=new Uint32Array(8),this.cursor=65535}nextUint32(){return this.cursor>=this.buffer.length&&(crypto.getRandomValues(this.buffer),this.cursor=0),this.buffer[this.cursor++]}},Mo,zf=()=>jf().toString(),jf=()=>(Mo||(Mo=new Pf)).generate();function $f(e,t=1/0,r=!1){let n=[],i=!1;async function s(){if(i||n.length===0)return;i=!0;let o=n.splice(0,t),a=o.map(l=>l.task);if(r){let l=a.map(async(u,c)=>{try{let f=await e([u]);o[c].resolve(f)}catch(f){o[c].reject(f)}});await Promise.all(l)}else try{let l=await e(a);o.forEach(u=>u.resolve(l))}catch(l){o.forEach(u=>u.reject(l))}i=!1,s()}return{push(o){return new Promise((a,l)=>{n.push({task:o,resolve:a,reject:l}),s()})}}}var Rf=el,Uo=128,Hf=127,qf=~Hf,Vf=Math.pow(2,31);function el(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Vf;)t[r++]=e&255|Uo,e/=128;for(;e&qf;)t[r++]=e&255|Uo,e>>>=7;return t[r]=e|0,el.bytes=r-n+1,t}var Wf=mi,Gf=128,zo=127;function mi(e,n){var r=0,n=n||0,i=0,s=n,o,a=e.length;do{if(s>=a)throw mi.bytes=0,new RangeError("Could not decode varint");o=e[s++],r+=i<28?(o&zo)<<i:(o&zo)*Math.pow(2,i),i+=7}while(o>=Gf);return mi.bytes=s-n,r}var Kf=Math.pow(2,7),Jf=Math.pow(2,14),Qf=Math.pow(2,21),Xf=Math.pow(2,28),Yf=Math.pow(2,35),Zf=Math.pow(2,42),ed=Math.pow(2,49),td=Math.pow(2,56),rd=Math.pow(2,63),nd=function(e){return e<Kf?1:e<Jf?2:e<Qf?3:e<Xf?4:e<Yf?5:e<Zf?6:e<ed?7:e<td?8:e<rd?9:10},id={encode:Rf,decode:Wf,encodingLength:nd},sd=id,Zr=sd,vi=(e,t=0)=>[Zr.decode(e,t),Zr.decode.bytes],en=(e,t,r=0)=>(Zr.encode(e,t,r),t),tn=e=>Zr.encodingLength(e),fk=new Uint8Array(0),od=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},_n=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},ad=e=>new TextEncoder().encode(e),ld=e=>new TextDecoder().decode(e),rn=(e,t)=>{let r=t.byteLength,n=tn(e),i=n+tn(r),s=new Uint8Array(i+r);return en(e,s,0),en(r,s,n),s.set(t,i),new Xi(e,r,t,s)},ki=e=>{let t=_n(e),[r,n]=vi(t),[i,s]=vi(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Xi(r,i,o,t)},ud=(e,t)=>{if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&od(e.bytes,r.bytes)}},Xi=class{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}},tl={};Z(tl,{base58btc:()=>Oe,base58flickr:()=>vd});function cd(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,l=e.charAt(0),u=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function f(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var h=0,p=0,g=0,m=y.length;g!==m&&y[g]===0;)g++,h++;for(var b=(m-g)*c+1>>>0,k=new Uint8Array(b);g!==m;){for(var S=y[g],B=0,N=b-1;(S!==0||B<p)&&N!==-1;N--,B++)S+=256*k[N]>>>0,k[N]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");p=B,g++}for(var M=b-p;M!==b&&k[M]===0;)M++;for(var D=l.repeat(h);M<b;++M)D+=e.charAt(k[M]);return D}function w(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var h=0;if(y[h]!==" "){for(var p=0,g=0;y[h]===l;)p++,h++;for(var m=(y.length-h)*u+1>>>0,b=new Uint8Array(m);y[h];){var k=r[y.charCodeAt(h)];if(k===255)return;for(var S=0,B=m-1;(k!==0||S<g)&&B!==-1;B--,S++)k+=a*b[B]>>>0,b[B]=k%256>>>0,k=k/256>>>0;if(k!==0)throw new Error("Non-zero carry");g=S,h++}if(y[h]!==" "){for(var N=m-g;N!==m&&b[N]===0;)N++;for(var M=new Uint8Array(p+(m-N)),D=p;N!==m;)M[D++]=b[N++];return M}}}function d(y){var h=w(y);if(h)return h;throw new Error(`Non-${t} character`)}return{encode:f,decodeUnsafe:w,decode:d}}var hd=cd,fd=hd,dd=fd,pd=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},yd=class{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return rl(this,e)}},wd=class{constructor(e){this.decoders=e}or(e){return rl(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},rl=(e,t)=>new wd({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}}),gd=class{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new pd(e,t,r),this.decoder=new yd(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Fn=({name:e,prefix:t,encode:r,decode:n})=>new gd(e,t,r,n),gr=({prefix:e,name:t,alphabet:r})=>{let{encode:n,decode:i}=dd(r,t);return Fn({prefix:e,name:t,encode:n,decode:s=>_n(i(s))})},bd=(e,t,r,n)=>{let i={};for(let c=0;c<t.length;++c)i[t[c]]=c;let s=e.length;for(;e[s-1]==="=";)--s;let o=new Uint8Array(s*r/8|0),a=0,l=0,u=0;for(let c=0;c<s;++c){let f=i[e[c]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<r|f,a+=r,a>=8&&(a-=8,o[u++]=255&l>>a)}if(a>=r||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return o},md=(e,t,r)=>{let n=t[t.length-1]==="=",i=(1<<r)-1,s="",o=0,a=0;for(let l=0;l<e.length;++l)for(a=a<<8|e[l],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},se=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Fn({prefix:t,name:e,encode(i){return md(i,n,r)},decode(i){return bd(i,n,r,e)}}),Oe=gr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),vd=gr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),nl={};Z(nl,{base32:()=>rr,base32hex:()=>Sd,base32hexpad:()=>_d,base32hexpadupper:()=>Fd,base32hexupper:()=>Ad,base32pad:()=>Ed,base32padupper:()=>xd,base32upper:()=>kd,base32z:()=>Bd});var rr=se({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),kd=se({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ed=se({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xd=se({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Sd=se({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ad=se({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),_d=se({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Fd=se({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Bd=se({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),jo=(e,t)=>{let{bytes:r,version:n}=e;switch(n){case 0:return Cd(r,Ei(e),t||Oe.encoder);default:return Dd(r,Ei(e),t||rr.encoder)}},$o=new WeakMap,Ei=e=>{let t=$o.get(e);if(t==null){let r=new Map;return $o.set(e,r),r}return t},ie=class ae{constructor(t,r,n,i){this.code=r,this.version=t,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Qt)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Nd)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ae.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=rn(t,r);return ae.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return ae.equals(this,t)}static equals(t,r){let n=r;return n&&t.code===n.code&&t.version===n.version&&ud(t.multihash,n.multihash)}toString(t){return jo(this,t)}toJSON(){return{"/":jo(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof ae)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:i,multihash:s,bytes:o}=r;return new ae(n,i,s,o||Ro(n,i,s.bytes))}else if(r[Ld]===!0){let{version:n,multihash:i,code:s}=r,o=ki(i);return ae.create(n,s,o)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Qt)throw new Error(`Version 0 CID must use dag-pb (code: ${Qt}) block encoding`);return new ae(t,r,n,n.bytes)}case 1:{let i=Ro(t,r,n.bytes);return new ae(t,r,n,i)}default:throw new Error("Invalid version")}}static createV0(t){return ae.create(0,Qt,t)}static createV1(t,r){return ae.create(1,t,r)}static decode(t){let[r,n]=ae.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=ae.inspectBytes(t),n=r.size-r.multihashSize,i=_n(t.subarray(n,n+r.multihashSize));if(i.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=i.subarray(r.multihashSize-r.digestSize),o=new Xi(r.multihashCode,r.digestSize,s,i);return[r.version===0?ae.createV0(o):ae.createV1(r.codec,o),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[f,w]=vi(t.subarray(r));return r+=w,f},i=n(),s=Qt;if(i===18?(i=0,r=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let o=r,a=n(),l=n(),u=r+l,c=u-o;return{version:i,codec:s,multihashCode:a,digestSize:l,multihashSize:c,size:u}}static parse(t,r){let[n,i]=Td(t,r),s=ae.decode(i);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Ei(s).set(n,t),s}},Td=(e,t)=>{switch(e[0]){case"Q":{let r=t||Oe;return[Oe.prefix,r.decode(`${Oe.prefix}${e}`)]}case Oe.prefix:{let r=t||Oe;return[Oe.prefix,r.decode(e)]}case rr.prefix:{let r=t||rr;return[rr.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}},Cd=(e,t,r)=>{let{prefix:n}=r;if(n!==Oe.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(i==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return i},Dd=(e,t,r)=>{let{prefix:n}=r,i=t.get(n);if(i==null){let s=r.encode(e);return t.set(n,s),s}else return i},Qt=112,Nd=18,Ro=(e,t,r)=>{let n=tn(e),i=n+tn(t),s=new Uint8Array(i+r.byteLength);return en(e,s,0),en(t,s,n),s.set(r,i),s},Ld=Symbol.for("@ipld/js-cid/CID"),Id=(e,t)=>ie.parse(e,t),Ne,ot=class{constructor(e){Lt(this,Ne,new Map),e&&Ae(this,Ne,new Map(e.map(t=>[t.cid.toString(),t.bytes])))}async get(e){let t=ue(this,Ne).get(e.toString());if(t)return{cid:e,bytes:t}}async put(e,t){ue(this,Ne).set(e.toString(),t)}putSync(e,t){ue(this,Ne).set(e.toString(),t)}async delete(e){ue(this,Ne).delete(e.toString())}deleteSync(e){ue(this,Ne).delete(e.toString())}*entries(){for(let[e,t]of ue(this,Ne))yield{cid:Id(e),bytes:t}}};Ne=new WeakMap;var Hr,Bn=class{constructor(...e){Lt(this,Hr,void 0),Ae(this,Hr,e)}async get(e){for(let t of ue(this,Hr)){let r=await t.get(e);if(r)return r}}};Hr=new WeakMap;var Od=class{constructor(e){A(this,"value"),A(this,"next"),this.value=e}},Le,_t,Ft,Pd=class{constructor(){Lt(this,Le,void 0),Lt(this,_t,void 0),Lt(this,Ft,void 0),this.clear()}enqueue(e){let t=new Od(e);ue(this,Le)?(ue(this,_t).next=t,Ae(this,_t,t)):(Ae(this,Le,t),Ae(this,_t,t)),Oo(this,Ft)._++}dequeue(){let e=ue(this,Le);if(e)return Ae(this,Le,ue(this,Le).next),Oo(this,Ft)._--,e.value}clear(){Ae(this,Le,void 0),Ae(this,_t,void 0),Ae(this,Ft,0)}get size(){return ue(this,Ft)}*[Symbol.iterator](){let e=ue(this,Le);for(;e;)yield e.value,e=e.next}};Le=new WeakMap,_t=new WeakMap,Ft=new WeakMap;function il(e){if(!((Number.isInteger(e)||e===Number.POSITIVE_INFINITY)&&e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");let t=new Pd,r=0,n=()=>{r--,t.size>0&&t.dequeue()()},i=async(a,l,u)=>{r++;let c=(async()=>a(...u))();l(c);try{await c}catch{}n()},s=(a,l,u)=>{t.enqueue(i.bind(void 0,a,l,u)),(async()=>(await Promise.resolve(),r<e&&t.size>0&&t.dequeue()()))()},o=(a,...l)=>new Promise(u=>{s(a,u,l)});return Object.defineProperties(o,{activeCount:{get:()=>r},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),o}var ce={};Z(ce,{code:()=>Fl,decode:()=>cs,encode:()=>Bl,name:()=>Ry});var Md=["string","number","bigint","symbol"],Ud=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function zd(e){if(e===null)return"null";if(e===void 0)return"undefined";if(e===!0||e===!1)return"boolean";let t=typeof e;return Md.includes(t)?t:t==="function"?"Function":Array.isArray(e)?"Array":jd(e)?"Buffer":$d(e)||"Object"}function jd(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function $d(e){let t=Object.prototype.toString.call(e).slice(8,-1);if(Ud.includes(t))return t}var v=class{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};v.uint=new v(0,"uint",!0);v.negint=new v(1,"negint",!0);v.bytes=new v(2,"bytes",!0);v.string=new v(3,"string",!0);v.array=new v(4,"array",!1);v.map=new v(5,"map",!1);v.tag=new v(6,"tag",!1);v.float=new v(7,"float",!0);v.false=new v(7,"false",!0);v.true=new v(7,"true",!0);v.null=new v(7,"null",!0);v.undefined=new v(7,"undefined",!0);v.break=new v(7,"break",!0);var _=class{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}},zt=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",Rd=new TextDecoder,Hd=new TextEncoder;function nn(e){return zt&&globalThis.Buffer.isBuffer(e)}function Yi(e){return e instanceof Uint8Array?nn(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}var qd=zt?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):qo(e,t,r):(e,t,r)=>r-t>64?Rd.decode(e.subarray(t,r)):qo(e,t,r),sl=zt?e=>e.length>64?globalThis.Buffer.from(e):Ho(e):e=>e.length>64?Hd.encode(e):Ho(e),Ce=e=>Uint8Array.from(e),Zi=zt?(e,t,r)=>nn(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),Vd=zt?(e,t)=>(e=e.map(r=>r instanceof Uint8Array?r:globalThis.Buffer.from(r)),Yi(globalThis.Buffer.concat(e,t))):(e,t)=>{let r=new Uint8Array(t),n=0;for(let i of e)n+i.length>r.length&&(i=i.subarray(0,r.length-n)),r.set(i,n),n+=i.length;return r},Wd=zt?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function Gd(e,t){if(nn(e)&&nn(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function Ho(e,t=1/0){let r,n=e.length,i=null,s=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return s}function qo(e,t,r){let n=[];for(;t<r;){let i=e[t],s=null,o=i>239?4:i>223?3:i>191?2:1;if(t+o<=r){let a,l,u,c;switch(o){case 1:i<128&&(s=i);break;case 2:a=e[t+1],(a&192)===128&&(c=(i&31)<<6|a&63,c>127&&(s=c));break;case 3:a=e[t+1],l=e[t+2],(a&192)===128&&(l&192)===128&&(c=(i&15)<<12|(a&63)<<6|l&63,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:a=e[t+1],l=e[t+2],u=e[t+3],(a&192)===128&&(l&192)===128&&(u&192)===128&&(c=(i&15)<<18|(a&63)<<12|(l&63)<<6|u&63,c>65535&&c<1114112&&(s=c))}}s===null?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),t+=o}return ol(n)}var Vo=4096;function ol(e){let t=e.length;if(t<=Vo)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=Vo));return r}var Kd=256,al=class{constructor(e=Kd){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){let r=t.length-(this.maxCursor-this.cursor)-1;r<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,r),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=Wd(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=Zi(r,0,this.cursor)}else t=Vd(this.chunks,this.cursor);return e&&this.reset(),t}},O="CBOR decode error:",it="CBOR encode error:",br=[];br[23]=1;br[24]=2;br[25]=3;br[26]=5;br[27]=9;function jt(e,t,r){if(e.length-t<r)throw new Error(`${O} not enough data for type`)}var re=[24,256,65536,4294967296,BigInt("18446744073709551616")];function at(e,t,r){jt(e,t,1);let n=e[t];if(r.strict===!0&&n<re[0])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);return n}function lt(e,t,r){jt(e,t,2);let n=e[t]<<8|e[t+1];if(r.strict===!0&&n<re[1])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);return n}function ut(e,t,r){jt(e,t,4);let n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(r.strict===!0&&n<re[2])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);return n}function ct(e,t,r){jt(e,t,8);let n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=e[t+4]*16777216+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(r.strict===!0&&s<re[3])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(r.allowBigInt===!0)return s;throw new Error(`${O} integers outside of the safe integer range are not supported`)}function Jd(e,t,r,n){return new _(v.uint,at(e,t+1,n),2)}function Qd(e,t,r,n){return new _(v.uint,lt(e,t+1,n),3)}function Xd(e,t,r,n){return new _(v.uint,ut(e,t+1,n),5)}function Yd(e,t,r,n){return new _(v.uint,ct(e,t+1,n),9)}function ht(e,t){return me(e,0,t.value)}function me(e,t,r){if(r<re[0]){let n=Number(r);e.push([t|n])}else if(r<re[1]){let n=Number(r);e.push([t|24,n])}else if(r<re[2]){let n=Number(r);e.push([t|25,n>>>8,n&255])}else if(r<re[3]){let n=Number(r);e.push([t|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(r);if(n<re[4]){let i=[t|27,0,0,0,0,0,0,0],s=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=s&255,s=s>>8,i[7]=s&255,s=s>>8,i[6]=s&255,s=s>>8,i[5]=s&255,i[4]=o&255,o=o>>8,i[3]=o&255,o=o>>8,i[2]=o&255,o=o>>8,i[1]=o&255,e.push(i)}else throw new Error(`${O} encountered BigInt larger than allowable range`)}}ht.encodedSize=function(e){return me.encodedSize(e.value)};me.encodedSize=function(e){return e<re[0]?1:e<re[1]?2:e<re[2]?3:e<re[3]?5:9};ht.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function Zd(e,t,r,n){return new _(v.negint,-1-at(e,t+1,n),2)}function ep(e,t,r,n){return new _(v.negint,-1-lt(e,t+1,n),3)}function tp(e,t,r,n){return new _(v.negint,-1-ut(e,t+1,n),5)}var es=BigInt(-1),ll=BigInt(1);function rp(e,t,r,n){let i=ct(e,t+1,n);if(typeof i!="bigint"){let s=-1-i;if(s>=Number.MIN_SAFE_INTEGER)return new _(v.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${O} integers outside of the safe integer range are not supported`);return new _(v.negint,es-BigInt(i),9)}function ts(e,t){let r=t.value,n=typeof r=="bigint"?r*es-ll:r*-1-1;me(e,t.type.majorEncoded,n)}ts.encodedSize=function(e){let t=e.value,r=typeof t=="bigint"?t*es-ll:t*-1-1;return r<re[0]?1:r<re[1]?2:r<re[2]?3:r<re[3]?5:9};ts.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function mr(e,t,r,n){jt(e,t,r+n);let i=Zi(e,t+r,t+r+n);return new _(v.bytes,i,r+n)}function np(e,t,r,n){return mr(e,t,1,r)}function ip(e,t,r,n){return mr(e,t,2,at(e,t+1,n))}function sp(e,t,r,n){return mr(e,t,3,lt(e,t+1,n))}function op(e,t,r,n){return mr(e,t,5,ut(e,t+1,n))}function ap(e,t,r,n){let i=ct(e,t+1,n);if(typeof i=="bigint")throw new Error(`${O} 64-bit integer bytes lengths not supported`);return mr(e,t,9,i)}function sn(e){return e.encodedBytes===void 0&&(e.encodedBytes=e.type===v.string?sl(e.value):e.value),e.encodedBytes}function Tn(e,t){let r=sn(t);me(e,t.type.majorEncoded,r.length),e.push(r)}Tn.encodedSize=function(e){let t=sn(e);return me.encodedSize(t.length)+t.length};Tn.compareTokens=function(e,t){return lp(sn(e),sn(t))};function lp(e,t){return e.length<t.length?-1:e.length>t.length?1:Gd(e,t)}function vr(e,t,r,n,i){let s=r+n;jt(e,t,s);let o=new _(v.string,qd(e,t+r,t+s),s);return i.retainStringBytes===!0&&(o.byteValue=Zi(e,t+r,t+s)),o}function up(e,t,r,n){return vr(e,t,1,r,n)}function cp(e,t,r,n){return vr(e,t,2,at(e,t+1,n),n)}function hp(e,t,r,n){return vr(e,t,3,lt(e,t+1,n),n)}function fp(e,t,r,n){return vr(e,t,5,ut(e,t+1,n),n)}function dp(e,t,r,n){let i=ct(e,t+1,n);if(typeof i=="bigint")throw new Error(`${O} 64-bit integer string lengths not supported`);return vr(e,t,9,i,n)}var pp=Tn;function $t(e,t,r,n){return new _(v.array,n,r)}function yp(e,t,r,n){return $t(e,t,1,r)}function wp(e,t,r,n){return $t(e,t,2,at(e,t+1,n))}function gp(e,t,r,n){return $t(e,t,3,lt(e,t+1,n))}function bp(e,t,r,n){return $t(e,t,5,ut(e,t+1,n))}function mp(e,t,r,n){let i=ct(e,t+1,n);if(typeof i=="bigint")throw new Error(`${O} 64-bit integer array lengths not supported`);return $t(e,t,9,i)}function vp(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${O} indefinite length items not allowed`);return $t(e,t,1,1/0)}function rs(e,t){me(e,v.array.majorEncoded,t.value)}rs.compareTokens=ht.compareTokens;rs.encodedSize=function(e){return me.encodedSize(e.value)};function Rt(e,t,r,n){return new _(v.map,n,r)}function kp(e,t,r,n){return Rt(e,t,1,r)}function Ep(e,t,r,n){return Rt(e,t,2,at(e,t+1,n))}function xp(e,t,r,n){return Rt(e,t,3,lt(e,t+1,n))}function Sp(e,t,r,n){return Rt(e,t,5,ut(e,t+1,n))}function Ap(e,t,r,n){let i=ct(e,t+1,n);if(typeof i=="bigint")throw new Error(`${O} 64-bit integer map lengths not supported`);return Rt(e,t,9,i)}function _p(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${O} indefinite length items not allowed`);return Rt(e,t,1,1/0)}function ns(e,t){me(e,v.map.majorEncoded,t.value)}ns.compareTokens=ht.compareTokens;ns.encodedSize=function(e){return me.encodedSize(e.value)};function Fp(e,t,r,n){return new _(v.tag,r,1)}function Bp(e,t,r,n){return new _(v.tag,at(e,t+1,n),2)}function Tp(e,t,r,n){return new _(v.tag,lt(e,t+1,n),3)}function Cp(e,t,r,n){return new _(v.tag,ut(e,t+1,n),5)}function Dp(e,t,r,n){return new _(v.tag,ct(e,t+1,n),9)}function is(e,t){me(e,v.tag.majorEncoded,t.value)}is.compareTokens=ht.compareTokens;is.encodedSize=function(e){return me.encodedSize(e.value)};var Np=20,Lp=21,Ip=22,Op=23;function Pp(e,t,r,n){if(n.allowUndefined===!1)throw new Error(`${O} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new _(v.null,null,1):new _(v.undefined,void 0,1)}function Mp(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${O} indefinite length items not allowed`);return new _(v.break,void 0,1)}function ss(e,t,r){if(r){if(r.allowNaN===!1&&Number.isNaN(e))throw new Error(`${O} NaN values are not supported`);if(r.allowInfinity===!1&&(e===1/0||e===-1/0))throw new Error(`${O} Infinity values are not supported`)}return new _(v.float,e,t)}function Up(e,t,r,n){return ss(as(e,t+1),3,n)}function zp(e,t,r,n){return ss(ls(e,t+1),5,n)}function jp(e,t,r,n){return ss(fl(e,t+1),9,n)}function os(e,t,r){let n=t.value;if(n===!1)e.push([v.float.majorEncoded|Np]);else if(n===!0)e.push([v.float.majorEncoded|Lp]);else if(n===null)e.push([v.float.majorEncoded|Ip]);else if(n===void 0)e.push([v.float.majorEncoded|Op]);else{let i,s=!1;(!r||r.float64!==!0)&&(cl(n),i=as(xe,1),n===i||Number.isNaN(n)?(xe[0]=249,e.push(xe.slice(0,3)),s=!0):(hl(n),i=ls(xe,1),n===i&&(xe[0]=250,e.push(xe.slice(0,5)),s=!0))),s||($p(n),i=fl(xe,1),xe[0]=251,e.push(xe.slice(0,9)))}}os.encodedSize=function(e,t){let r=e.value;if(r===!1||r===!0||r===null||r===void 0)return 1;if(!t||t.float64!==!0){cl(r);let n=as(xe,1);if(r===n||Number.isNaN(r))return 3;if(hl(r),n=ls(xe,1),r===n)return 5}return 9};var ul=new ArrayBuffer(9),ge=new DataView(ul,1),xe=new Uint8Array(ul,0);function cl(e){if(e===1/0)ge.setUint16(0,31744,!1);else if(e===-1/0)ge.setUint16(0,64512,!1);else if(Number.isNaN(e))ge.setUint16(0,32256,!1);else{ge.setFloat32(0,e);let t=ge.getUint32(0),r=(t&2139095040)>>23,n=t&8388607;if(r===255)ge.setUint16(0,31744,!1);else if(r===0)ge.setUint16(0,(e&2147483648)>>16|n>>13,!1);else{let i=r-127;i<-24?ge.setUint16(0,0):i<-14?ge.setUint16(0,(t&2147483648)>>16|1<<24+i,!1):ge.setUint16(0,(t&2147483648)>>16|i+15<<10|n>>13,!1)}}}function as(e,t){if(e.length-t<2)throw new Error(`${O} not enough data for float16`);let r=(e[t]<<8)+e[t+1];if(r===31744)return 1/0;if(r===64512)return-1/0;if(r===32256)return NaN;let n=r>>10&31,i=r&1023,s;return n===0?s=i*2**-24:n!==31?s=(i+1024)*2**(n-25):s=i===0?1/0:NaN,r&32768?-s:s}function hl(e){ge.setFloat32(0,e,!1)}function ls(e,t){if(e.length-t<4)throw new Error(`${O} not enough data for float32`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function $p(e){ge.setFloat64(0,e,!1)}function fl(e,t){if(e.length-t<8)throw new Error(`${O} not enough data for float64`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}os.compareTokens=ht.compareTokens;function R(e,t,r){throw new Error(`${O} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function Cn(e){return()=>{throw new Error(`${O} ${e}`)}}var T=[];for(let e=0;e<=23;e++)T[e]=R;T[24]=Jd;T[25]=Qd;T[26]=Xd;T[27]=Yd;T[28]=R;T[29]=R;T[30]=R;T[31]=R;for(let e=32;e<=55;e++)T[e]=R;T[56]=Zd;T[57]=ep;T[58]=tp;T[59]=rp;T[60]=R;T[61]=R;T[62]=R;T[63]=R;for(let e=64;e<=87;e++)T[e]=np;T[88]=ip;T[89]=sp;T[90]=op;T[91]=ap;T[92]=R;T[93]=R;T[94]=R;T[95]=Cn("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)T[e]=up;T[120]=cp;T[121]=hp;T[122]=fp;T[123]=dp;T[124]=R;T[125]=R;T[126]=R;T[127]=Cn("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)T[e]=yp;T[152]=wp;T[153]=gp;T[154]=bp;T[155]=mp;T[156]=R;T[157]=R;T[158]=R;T[159]=vp;for(let e=160;e<=183;e++)T[e]=kp;T[184]=Ep;T[185]=xp;T[186]=Sp;T[187]=Ap;T[188]=R;T[189]=R;T[190]=R;T[191]=_p;for(let e=192;e<=215;e++)T[e]=Fp;T[216]=Bp;T[217]=Tp;T[218]=Cp;T[219]=Dp;T[220]=R;T[221]=R;T[222]=R;T[223]=R;for(let e=224;e<=243;e++)T[e]=Cn("simple values are not supported");T[244]=R;T[245]=R;T[246]=R;T[247]=Pp;T[248]=Cn("simple values are not supported");T[249]=Up;T[250]=zp;T[251]=jp;T[252]=R;T[253]=R;T[254]=R;T[255]=Mp;var Be=[];for(let e=0;e<24;e++)Be[e]=new _(v.uint,e,1);for(let e=-1;e>=-24;e--)Be[31-e]=new _(v.negint,e,1);Be[64]=new _(v.bytes,new Uint8Array(0),1);Be[96]=new _(v.string,"",1);Be[128]=new _(v.array,0,1);Be[160]=new _(v.map,0,1);Be[244]=new _(v.false,!1,1);Be[245]=new _(v.true,!0,1);Be[246]=new _(v.null,null,1);function Rp(e){switch(e.type){case v.false:return Ce([244]);case v.true:return Ce([245]);case v.null:return Ce([246]);case v.bytes:return e.value.length?void 0:Ce([64]);case v.string:return e.value===""?Ce([96]):void 0;case v.array:return e.value===0?Ce([128]):void 0;case v.map:return e.value===0?Ce([160]):void 0;case v.uint:return e.value<24?Ce([Number(e.value)]):void 0;case v.negint:if(e.value>=-24)return Ce([31-Number(e.value)])}}var Hp={float64:!1,mapSorter:Wp,quickEncodeToken:Rp};function qp(){let e=[];return e[v.uint.major]=ht,e[v.negint.major]=ts,e[v.bytes.major]=Tn,e[v.string.major]=pp,e[v.array.major]=rs,e[v.map.major]=ns,e[v.tag.major]=is,e[v.float.major]=os,e}var dl=qp(),si=new al,Wo=class pl{constructor(t,r){this.obj=t,this.parent=r}includes(t){let r=this;do if(r.obj===t)return!0;while(r=r.parent);return!1}static createCheck(t,r){if(t&&t.includes(r))throw new Error(`${it} object contains circular references`);return new pl(r,t)}},je={null:new _(v.null,null),undefined:new _(v.undefined,void 0),true:new _(v.true,!0),false:new _(v.false,!1),emptyArray:new _(v.array,0),emptyMap:new _(v.map,0)},Je={number(e,t,r,n){return!Number.isInteger(e)||!Number.isSafeInteger(e)?new _(v.float,e):e>=0?new _(v.uint,e):new _(v.negint,e)},bigint(e,t,r,n){return e>=BigInt(0)?new _(v.uint,e):new _(v.negint,e)},Uint8Array(e,t,r,n){return new _(v.bytes,e)},string(e,t,r,n){return new _(v.string,e)},boolean(e,t,r,n){return e?je.true:je.false},null(e,t,r,n){return je.null},undefined(e,t,r,n){return je.undefined},ArrayBuffer(e,t,r,n){return new _(v.bytes,new Uint8Array(e))},DataView(e,t,r,n){return new _(v.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))},Array(e,t,r,n){if(!e.length)return r.addBreakTokens===!0?[je.emptyArray,new _(v.break)]:je.emptyArray;n=Wo.createCheck(n,e);let i=[],s=0;for(let o of e)i[s++]=qr(o,r,n);return r.addBreakTokens?[new _(v.array,e.length),i,new _(v.break)]:[new _(v.array,e.length),i]},Object(e,t,r,n){let i=t!=="Object",s=i?e.keys():Object.keys(e),o=i?e.size:s.length;if(!o)return r.addBreakTokens===!0?[je.emptyMap,new _(v.break)]:je.emptyMap;n=Wo.createCheck(n,e);let a=[],l=0;for(let u of s)a[l++]=[qr(u,r,n),qr(i?e.get(u):e[u],r,n)];return Vp(a,r),r.addBreakTokens?[new _(v.map,o),a,new _(v.break)]:[new _(v.map,o),a]}};Je.Map=Je.Object;Je.Buffer=Je.Uint8Array;for(let e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Je[`${e}Array`]=Je.DataView;function qr(e,t={},r){let n=zd(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||Je[n];if(typeof i=="function"){let o=i(e,n,t,r);if(o!=null)return o}let s=Je[n];if(!s)throw new Error(`${it} unsupported type: ${n}`);return s(e,n,t,r)}function Vp(e,t){t.mapSorter&&e.sort(t.mapSorter)}function Wp(e,t){let r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);let i=r.type.major,s=dl[i].compareTokens(r,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function yl(e,t,r,n){if(Array.isArray(t))for(let i of t)yl(e,i,r,n);else r[t.type.major](e,t,n)}function wl(e,t,r){let n=qr(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){let i=r.quickEncodeToken(n);if(i)return i;let s=t[n.type.major];if(s.encodedSize){let o=s.encodedSize(n,r),a=new al(o);if(s(a,n,r),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return Yi(a.chunks[0])}}return si.reset(),yl(si,n,t,r),si.toBytes(!0)}function Gp(e,t){return t=Object.assign({},Hp,t),wl(e,dl,t)}var Kp={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},Jp=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){let e=this.data[this.pos],t=Be[e];if(t===void 0){let r=T[e];if(!r)throw new Error(`${O} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let n=e&31;t=r(this.data,this.pos,n,this.options)}return this.pos+=t.encodedLength,t}},ur=Symbol.for("DONE"),Dn=Symbol.for("BREAK");function Qp(e,t,r){let n=[];for(let i=0;i<e.value;i++){let s=cr(t,r);if(s===Dn){if(e.value===1/0)break;throw new Error(`${O} got unexpected break to lengthed array`)}if(s===ur)throw new Error(`${O} found array but not enough entries (got ${i}, expected ${e.value})`);n[i]=s}return n}function Xp(e,t,r){let n=r.useMaps===!0,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<e.value;o++){let a=cr(t,r);if(a===Dn){if(e.value===1/0)break;throw new Error(`${O} got unexpected break to lengthed map`)}if(a===ur)throw new Error(`${O} found map but not enough entries (got ${o} [no key], expected ${e.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${O} non-string keys not supported (got ${typeof a})`);if(r.rejectDuplicateMapKeys===!0&&(n&&s.has(a)||!n&&a in i))throw new Error(`${O} found repeat map key "${a}"`);let l=cr(t,r);if(l===ur)throw new Error(`${O} found map but not enough entries (got ${o} [no value], expected ${e.value})`);n?s.set(a,l):i[a]=l}return n?s:i}function cr(e,t){if(e.done())return ur;let r=e.next();if(r.type===v.break)return Dn;if(r.type.terminal)return r.value;if(r.type===v.array)return Qp(r,e,t);if(r.type===v.map)return Xp(r,e,t);if(r.type===v.tag){if(t.tags&&typeof t.tags[r.value]=="function"){let n=cr(e,t);return t.tags[r.value](n)}throw new Error(`${O} tag not supported (${r.value})`)}throw new Error("unsupported")}function gl(e,t){if(!(e instanceof Uint8Array))throw new Error(`${O} data to decode must be a Uint8Array`);t=Object.assign({},Kp,t);let r=t.tokenizer||new Jp(e,t),n=cr(r,t);if(n===ur)throw new Error(`${O} did not find any content to decode`);if(n===Dn)throw new Error(`${O} got unexpected break`);if(!r.done())throw new Error(`${O} too many terminals, data makes no sense`);return n}var Yp=bl,Go=128,Zp=127,ey=~Zp,ty=Math.pow(2,31);function bl(e,t,r){t=t||[],r=r||0;for(var n=r;e>=ty;)t[r++]=e&255|Go,e/=128;for(;e&ey;)t[r++]=e&255|Go,e>>>=7;return t[r]=e|0,bl.bytes=r-n+1,t}var ry=xi,ny=128,Ko=127;function xi(e,n){var r=0,n=n||0,i=0,s=n,o,a=e.length;do{if(s>=a)throw xi.bytes=0,new RangeError("Could not decode varint");o=e[s++],r+=i<28?(o&Ko)<<i:(o&Ko)*Math.pow(2,i),i+=7}while(o>=ny);return xi.bytes=s-n,r}var iy=Math.pow(2,7),sy=Math.pow(2,14),oy=Math.pow(2,21),ay=Math.pow(2,28),ly=Math.pow(2,35),uy=Math.pow(2,42),cy=Math.pow(2,49),hy=Math.pow(2,56),fy=Math.pow(2,63),dy=function(e){return e<iy?1:e<sy?2:e<oy?3:e<ay?4:e<ly?5:e<uy?6:e<cy?7:e<hy?8:e<fy?9:10},py={encode:Yp,decode:ry,encodingLength:dy},yy=py,on=yy,Si=(e,t=0)=>[on.decode(e,t),on.decode.bytes],an=(e,t,r=0)=>(on.encode(e,t,r),t),ln=e=>on.encodingLength(e),Nn={};Z(Nn,{coerce:()=>ft,empty:()=>ml,equals:()=>vl,fromHex:()=>gy,fromString:()=>my,isBinary:()=>by,toHex:()=>wy,toString:()=>vy});var ml=new Uint8Array(0),wy=e=>e.reduce((t,r)=>t+r.toString(16).padStart(2,"0"),""),gy=e=>{let t=e.match(/../g);return t?new Uint8Array(t.map(r=>parseInt(r,16))):ml},vl=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},ft=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},by=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),my=e=>new TextEncoder().encode(e),vy=e=>new TextDecoder().decode(e),un=(e,t)=>{let r=t.byteLength,n=ln(e),i=n+ln(r),s=new Uint8Array(i+r);return an(e,s,0),an(r,s,n),s.set(t,i),new us(e,r,t,s)},kl=e=>{let t=ft(e),[r,n]=Si(t),[i,s]=Si(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new us(r,i,o,t)},ky=(e,t)=>{if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&vl(e.bytes,r.bytes)}},us=class{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}};function Ey(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,l=e.charAt(0),u=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function f(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var h=0,p=0,g=0,m=y.length;g!==m&&y[g]===0;)g++,h++;for(var b=(m-g)*c+1>>>0,k=new Uint8Array(b);g!==m;){for(var S=y[g],B=0,N=b-1;(S!==0||B<p)&&N!==-1;N--,B++)S+=256*k[N]>>>0,k[N]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");p=B,g++}for(var M=b-p;M!==b&&k[M]===0;)M++;for(var D=l.repeat(h);M<b;++M)D+=e.charAt(k[M]);return D}function w(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var h=0;if(y[h]!==" "){for(var p=0,g=0;y[h]===l;)p++,h++;for(var m=(y.length-h)*u+1>>>0,b=new Uint8Array(m);y[h];){var k=r[y.charCodeAt(h)];if(k===255)return;for(var S=0,B=m-1;(k!==0||S<g)&&B!==-1;B--,S++)k+=a*b[B]>>>0,b[B]=k%256>>>0,k=k/256>>>0;if(k!==0)throw new Error("Non-zero carry");g=S,h++}if(y[h]!==" "){for(var N=m-g;N!==m&&b[N]===0;)N++;for(var M=new Uint8Array(p+(m-N)),D=p;N!==m;)M[D++]=b[N++];return M}}}function d(y){var h=w(y);if(h)return h;throw new Error(`Non-${t} character`)}return{encode:f,decodeUnsafe:w,decode:d}}var xy=Ey,Sy=xy,Ay=Sy,_y=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Fy=class{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return El(this,e)}},By=class{constructor(e){this.decoders=e}or(e){return El(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},El=(e,t)=>new By({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}}),Ty=class{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new _y(e,t,r),this.decoder=new Fy(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},xl=({name:e,prefix:t,encode:r,decode:n})=>new Ty(e,t,r,n),Sl=({prefix:e,name:t,alphabet:r})=>{let{encode:n,decode:i}=Ay(r,t);return xl({prefix:e,name:t,encode:n,decode:s=>ft(i(s))})},Cy=(e,t,r,n)=>{let i={};for(let c=0;c<t.length;++c)i[t[c]]=c;let s=e.length;for(;e[s-1]==="=";)--s;let o=new Uint8Array(s*r/8|0),a=0,l=0,u=0;for(let c=0;c<s;++c){let f=i[e[c]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<r|f,a+=r,a>=8&&(a-=8,o[u++]=255&l>>a)}if(a>=r||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return o},Dy=(e,t,r)=>{let n=t[t.length-1]==="=",i=(1<<r)-1,s="",o=0,a=0;for(let l=0;l<e.length;++l)for(a=a<<8|e[l],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},ye=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>xl({prefix:t,name:e,encode(i){return Dy(i,n,r)},decode(i){return Cy(i,n,r,e)}}),qe=Sl({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),dk=Sl({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Vr=ye({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),pk=ye({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),yk=ye({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),wk=ye({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),gk=ye({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),bk=ye({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),mk=ye({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),vk=ye({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),kk=ye({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Jo=(e,t)=>{let{bytes:r,version:n}=e;switch(n){case 0:return Ly(r,Ai(e),t||qe.encoder);default:return Iy(r,Ai(e),t||Vr.encoder)}},Qo=new WeakMap,Ai=e=>{let t=Qo.get(e);if(t==null){let r=new Map;return Qo.set(e,r),r}return t},ee=class le{constructor(t,r,n,i){this.code=r,this.version=t,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Xt)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Oy)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return le.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=un(t,r);return le.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return le.equals(this,t)}static equals(t,r){let n=r;return n&&t.code===n.code&&t.version===n.version&&ky(t.multihash,n.multihash)}toString(t){return Jo(this,t)}toJSON(){return{"/":Jo(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof le)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:i,multihash:s,bytes:o}=r;return new le(n,i,s,o||Xo(n,i,s.bytes))}else if(r[Py]===!0){let{version:n,multihash:i,code:s}=r,o=kl(i);return le.create(n,s,o)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Xt)throw new Error(`Version 0 CID must use dag-pb (code: ${Xt}) block encoding`);return new le(t,r,n,n.bytes)}case 1:{let i=Xo(t,r,n.bytes);return new le(t,r,n,i)}default:throw new Error("Invalid version")}}static createV0(t){return le.create(0,Xt,t)}static createV1(t,r){return le.create(1,t,r)}static decode(t){let[r,n]=le.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=le.inspectBytes(t),n=r.size-r.multihashSize,i=ft(t.subarray(n,n+r.multihashSize));if(i.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=i.subarray(r.multihashSize-r.digestSize),o=new us(r.multihashCode,r.digestSize,s,i);return[r.version===0?le.createV0(o):le.createV1(r.codec,o),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[f,w]=Si(t.subarray(r));return r+=w,f},i=n(),s=Xt;if(i===18?(i=0,r=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let o=r,a=n(),l=n(),u=r+l,c=u-o;return{version:i,codec:s,multihashCode:a,digestSize:l,multihashSize:c,size:u}}static parse(t,r){let[n,i]=Ny(t,r),s=le.decode(i);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Ai(s).set(n,t),s}},Ny=(e,t)=>{switch(e[0]){case"Q":{let r=t||qe;return[qe.prefix,r.decode(`${qe.prefix}${e}`)]}case qe.prefix:{let r=t||qe;return[qe.prefix,r.decode(e)]}case Vr.prefix:{let r=t||Vr;return[Vr.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}},Ly=(e,t,r)=>{let{prefix:n}=r;if(n!==qe.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(i==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return i},Iy=(e,t,r)=>{let{prefix:n}=r,i=t.get(n);if(i==null){let s=r.encode(e);return t.set(n,s),s}else return i},Xt=112,Oy=18,Xo=(e,t,r)=>{let n=ln(e),i=n+ln(t),s=new Uint8Array(i+r.byteLength);return an(e,s,0),an(t,s,n),s.set(r,i),s},Py=Symbol.for("@ipld/js-cid/CID"),Al=42;function My(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=ee.asCID(e);if(!t)return null;let r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new _(v.tag,Al),new _(v.bytes,r)]}function Uy(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function zy(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var jy={float64:!0,typeEncoders:{Object:My,undefined:Uy,number:zy}};function $y(e){if(e[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return ee.decode(e.subarray(1))}var _l={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};_l.tags[Al]=$y;var Ry="dag-cbor",Fl=113,Bl=e=>Gp(e,jy),cs=e=>gl(e,_l),Ge={Null:e=>e===null,Int:e=>Number.isInteger(e),Float:e=>typeof e=="number"&&Number.isFinite(e),String:e=>typeof e=="string",Bool:e=>typeof e=="boolean",Bytes:e=>e instanceof Uint8Array,Link:e=>!Ge.Null(e)&&typeof e=="object"&&e.asCID===e,List:e=>Array.isArray(e),Map:e=>!Ge.Null(e)&&typeof e=="object"&&e.asCID!==e&&!Ge.List(e)&&!Ge.Bytes(e)},Bt={Int:Ge.Int,"CarHeader > version":e=>Bt.Int(e),"CarHeader > roots (anon) > valueType (anon)":Ge.Link,"CarHeader > roots (anon)":e=>Ge.List(e)&&Array.prototype.every.call(e,Bt["CarHeader > roots (anon) > valueType (anon)"]),"CarHeader > roots":e=>Bt["CarHeader > roots (anon)"](e),CarHeader:e=>{let t=e&&Object.keys(e);return Ge.Map(e)&&["version"].every(r=>t.includes(r))&&Object.entries(e).every(([r,n])=>Bt["CarHeader > "+r]&&Bt["CarHeader > "+r](n))}},Hy=Bt.CarHeader,nt=J(Ki(),1),oi={SHA2_256:18,LENGTH:32,DAG_PB:112},qy=16+8+8+8;function cn(e,t){if(!e.length)throw new Error("Unexpected end of data");let r=nt.default.decode(e);return t.seek(nt.default.decode.bytes),r}function Vy(e){let t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=0;return{version:2,characteristics:[t.getBigUint64(r,!0),t.getBigUint64(r+=8,!0)],dataOffset:Number(t.getBigUint64(r+=8,!0)),dataSize:Number(t.getBigUint64(r+=8,!0)),indexOffset:Number(t.getBigUint64(r+=8,!0))}}function Wy(e){nt.default.decode(e);let t=nt.default.decode.bytes,r=nt.default.decode(e.subarray(nt.default.decode.bytes)),n=nt.default.decode.bytes;return t+n+r}async function Tl(e,t){let r=cn(await e.upTo(8),e);if(r===0)throw new Error("Invalid CAR header (zero length)");let n=await e.exactly(r,!0),i=cs(n);if(!Hy(i))throw new Error("Invalid CAR header format");if(i.version!==1&&i.version!==2||t!==void 0&&i.version!==t)throw new Error(`Invalid CAR version: ${i.version}${t!==void 0?` (expected ${t})`:""}`);let s=Array.isArray(i.roots);if(i.version===1&&!s||i.version===2&&s)throw new Error("Invalid CAR header format");if(i.version===1)return i;let o=Vy(await e.exactly(qy,!0));e.seek(o.dataOffset-e.pos);let a=await Tl(e,1);return Object.assign(a,o)}async function Gy(e){let t=await e.exactly(2,!1);if(t[0]===oi.SHA2_256&&t[1]===oi.LENGTH){let o=await e.exactly(34,!0),a=ki(o);return ie.create(0,oi.DAG_PB,a)}let r=cn(await e.upTo(8),e);if(r!==1)throw new Error(`Unexpected CID version (${r})`);let n=cn(await e.upTo(8),e),i=await e.exactly(Wy(await e.upTo(8)),!0),s=ki(i);return ie.create(r,n,s)}async function Cl(e){let t=e.pos,r=cn(await e.upTo(8),e);if(r===0)throw new Error("Invalid CAR section (zero length)");r+=e.pos-t;let n=await Gy(e),i=r-Number(e.pos-t);return{cid:n,length:r,blockLength:i}}async function Ky(e){let{cid:t,blockLength:r}=await Cl(e);return{bytes:await e.exactly(r,!0),cid:t}}async function Jy(e){let t=e.pos,{cid:r,length:n,blockLength:i}=await Cl(e),s={cid:r,length:n,blockLength:i,offset:t,blockOffset:e.pos};return e.seek(s.blockLength),s}function hs(e){let t=(async()=>{let r=await Tl(e);if(r.version===2){let n=e.pos-r.dataOffset;e=Xy(e,r.dataSize-n)}return r})();return{header:()=>t,async*blocks(){for(await t;(await e.upTo(8)).length>0;)yield await Ky(e)},async*blocksIndex(){for(await t;(await e.upTo(8)).length>0;)yield await Jy(e)}}}function fs(e){let t=0;return{async upTo(r){return e.subarray(t,t+Math.min(r,e.length-t))},async exactly(r,n=!1){if(r>e.length-t)throw new Error("Unexpected end of data");let i=e.subarray(t,t+r);return n&&(t+=r),i},seek(r){t+=r},get pos(){return t}}}function Qy(e){let t=0,r=0,n=0,i=new Uint8Array(0),s=async o=>{r=i.length-n;let a=[i.subarray(n)];for(;r<o;){let u=await e();if(u==null)break;r<0?u.length>r&&a.push(u.subarray(-r)):a.push(u),r+=u.length}i=new Uint8Array(a.reduce((u,c)=>u+c.length,0));let l=0;for(let u of a)i.set(u,l),l+=u.length;n=0};return{async upTo(o){return i.length-n<o&&await s(o),i.subarray(n,n+Math.min(i.length-n,o))},async exactly(o,a=!1){if(i.length-n<o&&await s(o),i.length-n<o)throw new Error("Unexpected end of data");let l=i.subarray(n,n+o);return a&&(t+=o,n+=o),l},seek(o){t+=o,n+=o},get pos(){return t}}}function ds(e){let t=e[Symbol.asyncIterator]();async function r(){let n=await t.next();return n.done?null:n.value}return Qy(r)}function Xy(e,t){let r=0;return{async upTo(n){let i=await e.upTo(n);return i.length+r>t&&(i=i.subarray(0,t-r)),i},async exactly(n,i=!1){let s=await e.exactly(n,i);if(s.length+r>t)throw new Error("Unexpected end of data");return i&&(r+=n),s},seek(n){r+=n,e.seek(n)},get pos(){return e.pos}}}var Dl=class{constructor(e,t){this._header=e,this._blocks=t,this._keys=t.map(r=>r.cid.toString())}get version(){return this._header.version}async getRoots(){return this._header.roots}async has(e){return this._keys.indexOf(e.toString())>-1}async get(e){let t=this._keys.indexOf(e.toString());return t>-1?this._blocks[t]:void 0}async*blocks(){for(let e of this._blocks)yield e}async*cids(){for(let e of this._blocks)yield e.cid}static async fromBytes(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return Yo(fs(e))}static async fromIterable(e){if(!e||typeof e[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return Yo(ds(e))}};async function Yo(e){let t=hs(e),r=await t.header(),n=[];for await(let i of t.blocks())n.push(i);return new Dl(r,n)}var Yy=class{constructor(e,t,r){this._version=e,this._roots=t,this._iterator=r}get version(){return this._version}async getRoots(){return this._roots}[Symbol.asyncIterator](){return this._iterator}static async fromBytes(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return Zo(fs(e))}static async fromIterable(e){if(!e||typeof e[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return Zo(ds(e))}};async function Zo(e){let t=hs(e),{version:r,roots:n}=await t.header();return new Yy(r,n,t.blocksIndex())}var Nl=class{constructor(e,t,r){this._version=e,this._roots=t,this._iterable=r,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}},Ek=class _i extends Nl{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(t){let{version:r,roots:n,iterator:i}=await Ll(t);return new _i(r,n,i)}static async fromIterable(t){let{version:r,roots:n,iterator:i}=await Il(t);return new _i(r,n,i)}},xk=class Fi extends Nl{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");this._decoded=!0;let t=this._iterable[Symbol.asyncIterator]();return{async next(){let r=await t.next();return r.done?r:{done:!1,value:r.value.cid}}}}static async fromBytes(t){let{version:r,roots:n,iterator:i}=await Ll(t);return new Fi(r,n,i)}static async fromIterable(t){let{version:r,roots:n,iterator:i}=await Il(t);return new Fi(r,n,i)}};async function Ll(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return Ol(fs(e))}async function Il(e){if(!e||typeof e[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return Ol(ds(e))}async function Ol(e){let t=hs(e),{version:r,roots:n}=await t.header();return{version:r,roots:n,iterator:t.blocks()}}var Sk=J(Ki(),1),Ak=class{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}},Ln=J(Ki(),1),Zy=["string","number","bigint","symbol"],ew=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function tw(e){if(e===null)return"null";if(e===void 0)return"undefined";if(e===!0||e===!1)return"boolean";let t=typeof e;return Zy.includes(t)?t:t==="function"?"Function":Array.isArray(e)?"Array":rw(e)?"Buffer":nw(e)||"Object"}function rw(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function nw(e){let t=Object.prototype.toString.call(e).slice(8,-1);if(ew.includes(t))return t}var x=class{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};x.uint=new x(0,"uint",!0);x.negint=new x(1,"negint",!0);x.bytes=new x(2,"bytes",!0);x.string=new x(3,"string",!0);x.array=new x(4,"array",!1);x.map=new x(5,"map",!1);x.tag=new x(6,"tag",!1);x.float=new x(7,"float",!0);x.false=new x(7,"false",!0);x.true=new x(7,"true",!0);x.null=new x(7,"null",!0);x.undefined=new x(7,"undefined",!0);x.break=new x(7,"break",!0);var I=class{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}},Ht=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",iw=new TextDecoder,sw=new TextEncoder;function hn(e){return Ht&&globalThis.Buffer.isBuffer(e)}function ow(e){return e instanceof Uint8Array?hn(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}var aw=Ht?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):ta(e,t,r):(e,t,r)=>r-t>64?iw.decode(e.subarray(t,r)):ta(e,t,r),lw=Ht?e=>e.length>64?globalThis.Buffer.from(e):ea(e):e=>e.length>64?sw.encode(e):ea(e),De=e=>Uint8Array.from(e),ps=Ht?(e,t,r)=>hn(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),uw=Ht?(e,t)=>(e=e.map(r=>r instanceof Uint8Array?r:globalThis.Buffer.from(r)),ow(globalThis.Buffer.concat(e,t))):(e,t)=>{let r=new Uint8Array(t),n=0;for(let i of e)n+i.length>r.length&&(i=i.subarray(0,r.length-n)),r.set(i,n),n+=i.length;return r},cw=Ht?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function hw(e,t){if(hn(e)&&hn(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function ea(e,t=1/0){let r,n=e.length,i=null,s=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return s}function ta(e,t,r){let n=[];for(;t<r;){let i=e[t],s=null,o=i>239?4:i>223?3:i>191?2:1;if(t+o<=r){let a,l,u,c;switch(o){case 1:i<128&&(s=i);break;case 2:a=e[t+1],(a&192)===128&&(c=(i&31)<<6|a&63,c>127&&(s=c));break;case 3:a=e[t+1],l=e[t+2],(a&192)===128&&(l&192)===128&&(c=(i&15)<<12|(a&63)<<6|l&63,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:a=e[t+1],l=e[t+2],u=e[t+3],(a&192)===128&&(l&192)===128&&(u&192)===128&&(c=(i&15)<<18|(a&63)<<12|(l&63)<<6|u&63,c>65535&&c<1114112&&(s=c))}}s===null?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),t+=o}return fw(n)}var ra=4096;function fw(e){let t=e.length;if(t<=ra)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=ra));return r}var dw=256,pw=class{constructor(e=dw){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){let r=t.length-(this.maxCursor-this.cursor)-1;r<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,r),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=cw(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=ps(r,0,this.cursor)}else t=uw(this.chunks,this.cursor);return e&&this.reset(),t}},K="CBOR decode error:",Pl="CBOR encode error:",kr=[];kr[23]=1;kr[24]=2;kr[25]=3;kr[26]=5;kr[27]=9;function qt(e,t,r){if(e.length-t<r)throw new Error(`${K} not enough data for type`)}var ne=[24,256,65536,4294967296,BigInt("18446744073709551616")];function dt(e,t,r){qt(e,t,1);let n=e[t];if(r.strict===!0&&n<ne[0])throw new Error(`${K} integer encoded in more bytes than necessary (strict decode)`);return n}function pt(e,t,r){qt(e,t,2);let n=e[t]<<8|e[t+1];if(r.strict===!0&&n<ne[1])throw new Error(`${K} integer encoded in more bytes than necessary (strict decode)`);return n}function yt(e,t,r){qt(e,t,4);let n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(r.strict===!0&&n<ne[2])throw new Error(`${K} integer encoded in more bytes than necessary (strict decode)`);return n}function wt(e,t,r){qt(e,t,8);let n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=e[t+4]*16777216+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(r.strict===!0&&s<ne[3])throw new Error(`${K} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(r.allowBigInt===!0)return s;throw new Error(`${K} integers outside of the safe integer range are not supported`)}function yw(e,t,r,n){return new I(x.uint,dt(e,t+1,n),2)}function ww(e,t,r,n){return new I(x.uint,pt(e,t+1,n),3)}function gw(e,t,r,n){return new I(x.uint,yt(e,t+1,n),5)}function bw(e,t,r,n){return new I(x.uint,wt(e,t+1,n),9)}function gt(e,t){return ve(e,0,t.value)}function ve(e,t,r){if(r<ne[0]){let n=Number(r);e.push([t|n])}else if(r<ne[1]){let n=Number(r);e.push([t|24,n])}else if(r<ne[2]){let n=Number(r);e.push([t|25,n>>>8,n&255])}else if(r<ne[3]){let n=Number(r);e.push([t|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(r);if(n<ne[4]){let i=[t|27,0,0,0,0,0,0,0],s=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=s&255,s=s>>8,i[7]=s&255,s=s>>8,i[6]=s&255,s=s>>8,i[5]=s&255,i[4]=o&255,o=o>>8,i[3]=o&255,o=o>>8,i[2]=o&255,o=o>>8,i[1]=o&255,e.push(i)}else throw new Error(`${K} encountered BigInt larger than allowable range`)}}gt.encodedSize=function(e){return ve.encodedSize(e.value)};ve.encodedSize=function(e){return e<ne[0]?1:e<ne[1]?2:e<ne[2]?3:e<ne[3]?5:9};gt.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function mw(e,t,r,n){return new I(x.negint,-1-dt(e,t+1,n),2)}function vw(e,t,r,n){return new I(x.negint,-1-pt(e,t+1,n),3)}function kw(e,t,r,n){return new I(x.negint,-1-yt(e,t+1,n),5)}var ys=BigInt(-1),Ml=BigInt(1);function Ew(e,t,r,n){let i=wt(e,t+1,n);if(typeof i!="bigint"){let s=-1-i;if(s>=Number.MIN_SAFE_INTEGER)return new I(x.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${K} integers outside of the safe integer range are not supported`);return new I(x.negint,ys-BigInt(i),9)}function ws(e,t){let r=t.value,n=typeof r=="bigint"?r*ys-Ml:r*-1-1;ve(e,t.type.majorEncoded,n)}ws.encodedSize=function(e){let t=e.value,r=typeof t=="bigint"?t*ys-Ml:t*-1-1;return r<ne[0]?1:r<ne[1]?2:r<ne[2]?3:r<ne[3]?5:9};ws.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function Er(e,t,r,n){qt(e,t,r+n);let i=ps(e,t+r,t+r+n);return new I(x.bytes,i,r+n)}function xw(e,t,r,n){return Er(e,t,1,r)}function Sw(e,t,r,n){return Er(e,t,2,dt(e,t+1,n))}function Aw(e,t,r,n){return Er(e,t,3,pt(e,t+1,n))}function _w(e,t,r,n){return Er(e,t,5,yt(e,t+1,n))}function Fw(e,t,r,n){let i=wt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${K} 64-bit integer bytes lengths not supported`);return Er(e,t,9,i)}function fn(e){return e.encodedBytes===void 0&&(e.encodedBytes=e.type===x.string?lw(e.value):e.value),e.encodedBytes}function In(e,t){let r=fn(t);ve(e,t.type.majorEncoded,r.length),e.push(r)}In.encodedSize=function(e){let t=fn(e);return ve.encodedSize(t.length)+t.length};In.compareTokens=function(e,t){return Bw(fn(e),fn(t))};function Bw(e,t){return e.length<t.length?-1:e.length>t.length?1:hw(e,t)}function xr(e,t,r,n,i){let s=r+n;qt(e,t,s);let o=new I(x.string,aw(e,t+r,t+s),s);return i.retainStringBytes===!0&&(o.byteValue=ps(e,t+r,t+s)),o}function Tw(e,t,r,n){return xr(e,t,1,r,n)}function Cw(e,t,r,n){return xr(e,t,2,dt(e,t+1,n),n)}function Dw(e,t,r,n){return xr(e,t,3,pt(e,t+1,n),n)}function Nw(e,t,r,n){return xr(e,t,5,yt(e,t+1,n),n)}function Lw(e,t,r,n){let i=wt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${K} 64-bit integer string lengths not supported`);return xr(e,t,9,i,n)}var Iw=In;function Vt(e,t,r,n){return new I(x.array,n,r)}function Ow(e,t,r,n){return Vt(e,t,1,r)}function Pw(e,t,r,n){return Vt(e,t,2,dt(e,t+1,n))}function Mw(e,t,r,n){return Vt(e,t,3,pt(e,t+1,n))}function Uw(e,t,r,n){return Vt(e,t,5,yt(e,t+1,n))}function zw(e,t,r,n){let i=wt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${K} 64-bit integer array lengths not supported`);return Vt(e,t,9,i)}function jw(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${K} indefinite length items not allowed`);return Vt(e,t,1,1/0)}function gs(e,t){ve(e,x.array.majorEncoded,t.value)}gs.compareTokens=gt.compareTokens;gs.encodedSize=function(e){return ve.encodedSize(e.value)};function Wt(e,t,r,n){return new I(x.map,n,r)}function $w(e,t,r,n){return Wt(e,t,1,r)}function Rw(e,t,r,n){return Wt(e,t,2,dt(e,t+1,n))}function Hw(e,t,r,n){return Wt(e,t,3,pt(e,t+1,n))}function qw(e,t,r,n){return Wt(e,t,5,yt(e,t+1,n))}function Vw(e,t,r,n){let i=wt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${K} 64-bit integer map lengths not supported`);return Wt(e,t,9,i)}function Ww(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${K} indefinite length items not allowed`);return Wt(e,t,1,1/0)}function bs(e,t){ve(e,x.map.majorEncoded,t.value)}bs.compareTokens=gt.compareTokens;bs.encodedSize=function(e){return ve.encodedSize(e.value)};function Gw(e,t,r,n){return new I(x.tag,r,1)}function Kw(e,t,r,n){return new I(x.tag,dt(e,t+1,n),2)}function Jw(e,t,r,n){return new I(x.tag,pt(e,t+1,n),3)}function Qw(e,t,r,n){return new I(x.tag,yt(e,t+1,n),5)}function Xw(e,t,r,n){return new I(x.tag,wt(e,t+1,n),9)}function ms(e,t){ve(e,x.tag.majorEncoded,t.value)}ms.compareTokens=gt.compareTokens;ms.encodedSize=function(e){return ve.encodedSize(e.value)};var Yw=20,Zw=21,eg=22,tg=23;function rg(e,t,r,n){if(n.allowUndefined===!1)throw new Error(`${K} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new I(x.null,null,1):new I(x.undefined,void 0,1)}function ng(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${K} indefinite length items not allowed`);return new I(x.break,void 0,1)}function vs(e,t,r){if(r){if(r.allowNaN===!1&&Number.isNaN(e))throw new Error(`${K} NaN values are not supported`);if(r.allowInfinity===!1&&(e===1/0||e===-1/0))throw new Error(`${K} Infinity values are not supported`)}return new I(x.float,e,t)}function ig(e,t,r,n){return vs(Es(e,t+1),3,n)}function sg(e,t,r,n){return vs(xs(e,t+1),5,n)}function og(e,t,r,n){return vs($l(e,t+1),9,n)}function ks(e,t,r){let n=t.value;if(n===!1)e.push([x.float.majorEncoded|Yw]);else if(n===!0)e.push([x.float.majorEncoded|Zw]);else if(n===null)e.push([x.float.majorEncoded|eg]);else if(n===void 0)e.push([x.float.majorEncoded|tg]);else{let i,s=!1;(!r||r.float64!==!0)&&(zl(n),i=Es(Se,1),n===i||Number.isNaN(n)?(Se[0]=249,e.push(Se.slice(0,3)),s=!0):(jl(n),i=xs(Se,1),n===i&&(Se[0]=250,e.push(Se.slice(0,5)),s=!0))),s||(ag(n),i=$l(Se,1),Se[0]=251,e.push(Se.slice(0,9)))}}ks.encodedSize=function(e,t){let r=e.value;if(r===!1||r===!0||r===null||r===void 0)return 1;if(!t||t.float64!==!0){zl(r);let n=Es(Se,1);if(r===n||Number.isNaN(r))return 3;if(jl(r),n=xs(Se,1),r===n)return 5}return 9};var Ul=new ArrayBuffer(9),be=new DataView(Ul,1),Se=new Uint8Array(Ul,0);function zl(e){if(e===1/0)be.setUint16(0,31744,!1);else if(e===-1/0)be.setUint16(0,64512,!1);else if(Number.isNaN(e))be.setUint16(0,32256,!1);else{be.setFloat32(0,e);let t=be.getUint32(0),r=(t&2139095040)>>23,n=t&8388607;if(r===255)be.setUint16(0,31744,!1);else if(r===0)be.setUint16(0,(e&2147483648)>>16|n>>13,!1);else{let i=r-127;i<-24?be.setUint16(0,0):i<-14?be.setUint16(0,(t&2147483648)>>16|1<<24+i,!1):be.setUint16(0,(t&2147483648)>>16|i+15<<10|n>>13,!1)}}}function Es(e,t){if(e.length-t<2)throw new Error(`${K} not enough data for float16`);let r=(e[t]<<8)+e[t+1];if(r===31744)return 1/0;if(r===64512)return-1/0;if(r===32256)return NaN;let n=r>>10&31,i=r&1023,s;return n===0?s=i*2**-24:n!==31?s=(i+1024)*2**(n-25):s=i===0?1/0:NaN,r&32768?-s:s}function jl(e){be.setFloat32(0,e,!1)}function xs(e,t){if(e.length-t<4)throw new Error(`${K} not enough data for float32`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function ag(e){be.setFloat64(0,e,!1)}function $l(e,t){if(e.length-t<8)throw new Error(`${K} not enough data for float64`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}ks.compareTokens=gt.compareTokens;function H(e,t,r){throw new Error(`${K} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function On(e){return()=>{throw new Error(`${K} ${e}`)}}var C=[];for(let e=0;e<=23;e++)C[e]=H;C[24]=yw;C[25]=ww;C[26]=gw;C[27]=bw;C[28]=H;C[29]=H;C[30]=H;C[31]=H;for(let e=32;e<=55;e++)C[e]=H;C[56]=mw;C[57]=vw;C[58]=kw;C[59]=Ew;C[60]=H;C[61]=H;C[62]=H;C[63]=H;for(let e=64;e<=87;e++)C[e]=xw;C[88]=Sw;C[89]=Aw;C[90]=_w;C[91]=Fw;C[92]=H;C[93]=H;C[94]=H;C[95]=On("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)C[e]=Tw;C[120]=Cw;C[121]=Dw;C[122]=Nw;C[123]=Lw;C[124]=H;C[125]=H;C[126]=H;C[127]=On("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)C[e]=Ow;C[152]=Pw;C[153]=Mw;C[154]=Uw;C[155]=zw;C[156]=H;C[157]=H;C[158]=H;C[159]=jw;for(let e=160;e<=183;e++)C[e]=$w;C[184]=Rw;C[185]=Hw;C[186]=qw;C[187]=Vw;C[188]=H;C[189]=H;C[190]=H;C[191]=Ww;for(let e=192;e<=215;e++)C[e]=Gw;C[216]=Kw;C[217]=Jw;C[218]=Qw;C[219]=Xw;C[220]=H;C[221]=H;C[222]=H;C[223]=H;for(let e=224;e<=243;e++)C[e]=On("simple values are not supported");C[244]=H;C[245]=H;C[246]=H;C[247]=rg;C[248]=On("simple values are not supported");C[249]=ig;C[250]=sg;C[251]=og;C[252]=H;C[253]=H;C[254]=H;C[255]=ng;var ze=[];for(let e=0;e<24;e++)ze[e]=new I(x.uint,e,1);for(let e=-1;e>=-24;e--)ze[31-e]=new I(x.negint,e,1);ze[64]=new I(x.bytes,new Uint8Array(0),1);ze[96]=new I(x.string,"",1);ze[128]=new I(x.array,0,1);ze[160]=new I(x.map,0,1);ze[244]=new I(x.false,!1,1);ze[245]=new I(x.true,!0,1);ze[246]=new I(x.null,null,1);function lg(e){switch(e.type){case x.false:return De([244]);case x.true:return De([245]);case x.null:return De([246]);case x.bytes:return e.value.length?void 0:De([64]);case x.string:return e.value===""?De([96]):void 0;case x.array:return e.value===0?De([128]):void 0;case x.map:return e.value===0?De([160]):void 0;case x.uint:return e.value<24?De([Number(e.value)]):void 0;case x.negint:if(e.value>=-24)return De([31-Number(e.value)])}}function Rl(){let e=[];return e[x.uint.major]=gt,e[x.negint.major]=ws,e[x.bytes.major]=In,e[x.string.major]=Iw,e[x.array.major]=gs,e[x.map.major]=bs,e[x.tag.major]=ms,e[x.float.major]=ks,e}var _k=Rl(),Fk=new pw,na=class Hl{constructor(t,r){this.obj=t,this.parent=r}includes(t){let r=this;do if(r.obj===t)return!0;while(r=r.parent);return!1}static createCheck(t,r){if(t&&t.includes(r))throw new Error(`${Pl} object contains circular references`);return new Hl(r,t)}},$e={null:new I(x.null,null),undefined:new I(x.undefined,void 0),true:new I(x.true,!0),false:new I(x.false,!1),emptyArray:new I(x.array,0),emptyMap:new I(x.map,0)},Qe={number(e,t,r,n){return!Number.isInteger(e)||!Number.isSafeInteger(e)?new I(x.float,e):e>=0?new I(x.uint,e):new I(x.negint,e)},bigint(e,t,r,n){return e>=BigInt(0)?new I(x.uint,e):new I(x.negint,e)},Uint8Array(e,t,r,n){return new I(x.bytes,e)},string(e,t,r,n){return new I(x.string,e)},boolean(e,t,r,n){return e?$e.true:$e.false},null(e,t,r,n){return $e.null},undefined(e,t,r,n){return $e.undefined},ArrayBuffer(e,t,r,n){return new I(x.bytes,new Uint8Array(e))},DataView(e,t,r,n){return new I(x.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))},Array(e,t,r,n){if(!e.length)return r.addBreakTokens===!0?[$e.emptyArray,new I(x.break)]:$e.emptyArray;n=na.createCheck(n,e);let i=[],s=0;for(let o of e)i[s++]=ai(o,r,n);return r.addBreakTokens?[new I(x.array,e.length),i,new I(x.break)]:[new I(x.array,e.length),i]},Object(e,t,r,n){let i=t!=="Object",s=i?e.keys():Object.keys(e),o=i?e.size:s.length;if(!o)return r.addBreakTokens===!0?[$e.emptyMap,new I(x.break)]:$e.emptyMap;n=na.createCheck(n,e);let a=[],l=0;for(let u of s)a[l++]=[ai(u,r,n),ai(i?e.get(u):e[u],r,n)];return ug(a,r),r.addBreakTokens?[new I(x.map,o),a,new I(x.break)]:[new I(x.map,o),a]}};Qe.Map=Qe.Object;Qe.Buffer=Qe.Uint8Array;for(let e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Qe[`${e}Array`]=Qe.DataView;function ai(e,t={},r){let n=tw(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||Qe[n];if(typeof i=="function"){let o=i(e,n,t,r);if(o!=null)return o}let s=Qe[n];if(!s)throw new Error(`${Pl} unsupported type: ${n}`);return s(e,n,t,r)}function ug(e,t){t.mapSorter&&e.sort(t.mapSorter)}var Bk=Symbol.for("DONE"),Tk=Symbol.for("BREAK"),cg=Rl(),hg={float64:!1,quickEncodeToken:lg};function ql(e,t=cg,r=hg){if(Array.isArray(e)){let n=0;for(let i of e)n+=ql(i,t,r);return n}else{let n=t[e.type.major];if(n.encodedSize===void 0||typeof n.encodedSize!="function")throw new Error(`Encoder for ${e.type.name} does not have an encodedSize()`);return n.encodedSize(e,r)}}var fg=class{constructor(e,t){this.bytes=e,this.byteOffset=t,this.roots=[],this.headerSize=t}addRoot(e,t){return dg(this,e,t),this}write(e){return yg(this,e),this}close(e){return wg(this,e)}},dg=(e,t,r={})=>{let{resize:n=!1}=r,{bytes:i,headerSize:s,byteOffset:o,roots:a}=e;e.roots.push(t);let l=Ss(e);if(l>s)if(l-s+o<i.byteLength)if(n)Vl(e,l);else throw a.pop(),new RangeError(`Header of size ${s} has no capacity for new root ${t}.
  However there is a space in the buffer and you could call addRoot(root, { resize: root }) to resize header to make a space for this root.`);else throw a.pop(),new RangeError(`Buffer has no capacity for a new root ${t}`)},pg=({cid:e,bytes:t})=>{let r=e.bytes.byteLength+t.byteLength;return Ln.default.encodingLength(r)+r},yg=(e,{cid:t,bytes:r})=>{let n=t.bytes.byteLength+r.byteLength,i=Ln.default.encode(n);if(e.byteOffset+i.length+n>e.bytes.byteLength)throw new RangeError("Buffer has no capacity for this block");li(e,i),li(e,t.bytes),li(e,r)},wg=(e,t={})=>{let{resize:r=!1}=t,{roots:n,bytes:i,byteOffset:s,headerSize:o}=e,a=Bl({version:1,roots:n}),l=Ln.default.encode(a.length),u=l.length+a.byteLength;if(o-u===0)return ia(e,l,a),i.subarray(0,s);if(r)return Vl(e,u),ia(e,l,a),i.subarray(0,e.byteOffset);throw new RangeError(`Header size was overestimated.
You can use close({ resize: true }) to resize header`)},Vl=(e,t)=>{let{bytes:r,headerSize:n}=e;r.set(r.subarray(n,e.byteOffset),t),e.byteOffset+=t-n,e.headerSize=t},li=(e,t)=>{e.bytes.set(t,e.byteOffset),e.byteOffset+=t.length},ia=({bytes:e},t,r)=>{e.set(t),e.set(r,t.length)},gg=[new I(x.map,2),new I(x.string,"version"),new I(x.uint,1),new I(x.string,"roots")],bg=new I(x.tag,42),mg=e=>{let t=[...gg];t.push(new I(x.array,e.length));for(let n of e)t.push(bg),t.push(new I(x.bytes,{length:n+1}));let r=ql(t);return Ln.default.encodingLength(r)+r},Ss=({roots:e})=>mg(e.map(t=>t.bytes.byteLength)),vg=(e,t={})=>{let{roots:r=[],byteOffset:n=0,byteLength:i=e.byteLength,headerSize:s=Ss({roots:r})}=t,o=new Uint8Array(e,n,i),a=new fg(o,s);for(let l of r)a.addRoot(l);return a},Sr=({name:e,code:t,encode:r})=>new kg(e,t,r),kg=class{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?un(this.code,t):t.then(r=>un(this.code,r))}else throw Error("Unknown type, must be binary type")}};function Or({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*Eg(e,t){if(t!=null&&typeof t=="object")if(Array.isArray(t))for(let[r,n]of t.entries()){let i=[...e,r],s=ee.asCID(n);s?yield[i.join("/"),s]:typeof n=="object"&&(yield*Bi(n,i))}else{let r=ee.asCID(t);r?yield[e.join("/"),r]:yield*Bi(t,e)}}function*Bi(e,t){if(e==null||e instanceof Uint8Array)return;let r=ee.asCID(e);r&&(yield[t.join("/"),r]);for(let[n,i]of Object.entries(e)){let s=[...t,n];yield*Eg(s,i)}}function*xg(e,t){if(Array.isArray(t))for(let[r,n]of t.entries()){let i=[...e,r];yield i.join("/"),typeof n=="object"&&!ee.asCID(n)&&(yield*Ti(n,i))}else yield*Ti(t,e)}function*Ti(e,t){if(!(e==null||typeof e!="object"))for(let[r,n]of Object.entries(e)){let i=[...t,r];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!ee.asCID(n)&&(yield*xg(i,n))}}function Sg(e,t){let r=e;for(let[n,i]of t.entries()){if(r=r[i],r==null)throw new Error(`Object has no property at ${t.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);let s=ee.asCID(r);if(s)return{value:s,remaining:t.slice(n+1).join("/")}}return{value:r}}var As=class{constructor({cid:e,bytes:t,value:r}){if(!e||!t||typeof r>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:Or(),bytes:Or(),value:Or(),asBlock:Or()})}links(){return Bi(this.value,[])}tree(){return Ti(this.value,[])}get(e="/"){return Sg(this.value,e.split("/").filter(Boolean))}};async function Pt({value:e,codec:t,hasher:r}){if(typeof e>"u")throw new Error('Missing required argument "value"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");let n=t.encode(e),i=await r.digest(n),s=ee.create(1,t.code,i);return new As({value:e,bytes:n,cid:s})}async function nr({bytes:e,codec:t,hasher:r}){if(!e)throw new Error('Missing required argument "bytes"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");let n=t.decode(e),i=await r.digest(e),s=ee.create(1,t.code,i);return new As({value:n,bytes:e,cid:s})}function Ag({bytes:e,cid:t,value:r,codec:n}){let i=r!==void 0?r:n&&n.decode(e);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new As({cid:t,bytes:e,value:i})}async function Wl({bytes:e,cid:t,hasher:r,codec:n}){if(!e)throw new Error('Missing required argument "bytes"');if(!r)throw new Error('Missing required argument "hasher"');let i=n.decode(e),s=await r.digest(e);if(!Nn.equals(t.multihash.bytes,s.bytes))throw new Error("CID hash does not match bytes");return Ag({bytes:e,cid:t,value:i,codec:n})}var Gl=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Te=Sr({name:"sha2-256",code:18,encode:Gl("SHA-256")}),Ck=Sr({name:"sha2-512",code:19,encode:Gl("SHA-512")}),dn={};Z(dn,{code:()=>_s,decode:()=>Bg,encode:()=>Fg,name:()=>_g});var _g="raw",_s=85,Fg=e=>ft(e),Bg=e=>ft(e);async function Kl(e,t){let r=0,n=Ss({roots:e});r+=n;for(let{cid:o,bytes:a}of t.entries())r+=pg({cid:o,bytes:a});let i=new Uint8Array(r),s=vg(i,{headerSize:n});for(let o of e)s.addRoot(o);for(let{cid:o,bytes:a}of t.entries())s.write({cid:o,bytes:a});return s.close(),await Pt({value:s.bytes,hasher:Te,codec:dn})}async function Tg(e){return await Pt({value:{fp:e},hasher:Te,codec:ce})}async function Cg(e){let t=await e.getRoots(),r=await e.get(t[0]);if(!r)throw new Error("missing header block");let{value:n}=await nr({bytes:r.bytes,hasher:Te,codec:ce});if(n&&n.fp===void 0)throw new Error("missing fp");let{fp:i}=n;return i}var Ct={};Z(Ct,{code:()=>Og,crypto:()=>Pg,decode:()=>Ig,decrypt:()=>Fs,encode:()=>Lg,encrypt:()=>Bs,name:()=>Mg});function Ci(){try{return window.crypto&&window.crypto.subtle?window.crypto:new Crypto}catch{return null}}var Pn=Ci();function Jl(e){let t=new Uint8Array(e);return e>0&&Pn.getRandomValues(t),t}var Dg=e=>{e=+e;let t=new Uint8Array(4);return t[3]=e>>>24,t[2]=e>>>16,t[1]=e>>>8,t[0]=e&255,t},Ng=e=>{let t=e.byteLength-4;return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216},Ql=e=>{let t=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),r=t.reduce((s,o)=>s+o.length,0),n=new Uint8Array(r),i=0;for(let s of t)n.set(s,i),i+=s.length;return n},Lg=({iv:e,bytes:t})=>Ql([e,t]),Ig=e=>{let t=e.subarray(0,12);return e=e.slice(12),{iv:t,bytes:e}},Og=3145728+1337;async function Xl(e){return await Pn.subtle.importKey("raw",e,"AES-GCM",!1,["encrypt","decrypt"])}var Fs=async({key:e,value:t})=>{let{bytes:r,iv:n}=t,i=await Xl(e),s=await Pn.subtle.decrypt({name:"AES-GCM",iv:n,tagLength:128},i,r);r=new Uint8Array(s);let o=Ng(r.subarray(0,4)),a=ee.decode(r.subarray(4,4+o));return r=r.subarray(4+o),{cid:a,bytes:r}},Bs=async({key:e,cid:t,bytes:r})=>{let n=Dg(t.bytes.byteLength),i=Jl(12),s=Ql([n,t.bytes,r]);try{let o=await Xl(e),a=await Pn.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:128},o,s);r=new Uint8Array(a)}catch(o){throw console.log("ee",o),o}return{value:{bytes:r,iv:i}}},Pg=e=>({encrypt:t=>Bs({key:e,...t}),decrypt:t=>Fs({key:e,...t})}),Mg="jchris@encrypted-block:aes-gcm",Ts=e=>{let t=e.byteLength-4;return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216},Cs=e=>{let t=Math.floor(4294967295/e);return async r=>{let n=await r.identity();if(typeof n!="number")throw new Error("Identity must be a number");return n<=t}},Ar=(e,t)=>e===t?0:e>t?1:-1,Ug=(e,t)=>{for(let r=0;r<e.byteLength;r++){if(t.byteLength===r)return 1;let n=e[r],i=t[r];if(n!==i)return n>i?1:-1}return t.byteLength>e.byteLength?-1:0},Pr=class{constructor(){this._cids=new Set}add(e){if(!e.address)throw new Error("Cannot add node without address");if(e.address.then){let t=e.address.then(r=>this._cids.add(r.toString()));this._cids.add(t),t.then(()=>this._cids.delete(t))}else this._cids.add(e.address.toString())}async all(){return await Promise.all([...this._cids]),this._cids}},Ds=class{constructor({key:e,address:t},r={}){this.key=e,this.address=t,this.codec=r.codec,this.hasher=r.hasher}get isEntry(){return!0}},pn=class{constructor({entries:e,closed:t}){if(typeof t!="boolean")throw new Error('Missing required argument "closed"');this.entries=e,this.closed=t,this.startKey=e[0].key}find(e,t){let{entries:r}=this;for(let n=r.length-1;n>-1;n--){let i=r[n];if(t(e,i.key)>-1)return[n,i]}return null}findMany(e,t,r=!1,n=!1){let{entries:i}=this,s=new Map;r?e=[...e]:e=e.sort(t);for(let o=i.length-1;o>-1&&e.length;o--){let a=i[o],l=[];for(;e.length;){let u=e[e.length-1];u=u.key?u.key:u;let c=t(u,a.key);if(n)if(c===0)l.push(e.pop());else if(c>0)e.pop();else break;else if(c>-1)l.push(e.pop());else break}l.length&&s.set(o,[a,l])}return s}findRange(e,t,r){let{entries:n}=this,i,s=0;for(let o=n.length-1;o>-1;o--){let a=n[o];if(r(t,a.key)>0){i=o;break}}for(let o=0;o<n.length;o++){let a=n[o],l=r(e,a.key);if(l===0){s=o;break}else if(l<0)break;s=o}return{first:s,last:i,entries:n.slice(s,i+1)}}},sa=e=>typeof e=="string"?e:JSON.stringify(e);function zg(e,t){return e.sort(({key:r},{key:n})=>t.compare(r,n))}async function jg(e,t,r){let n=[];for(let i of t){let{key:s,del:o}=i;if(r(s,e)<0)o||n.push(i);else break}return n}async function $g(e,t,{chunker:r,compare:n}){return await Mt.from({entries:e.map(i=>new t.LeafEntryClass(i,t)).sort((i,s)=>n(i.key,s.key)),chunker:r,NodeClass:t.LeafClass,distance:0,opts:t})}async function Rg(e,t,r,n){return await Promise.all(t.map(async i=>{let s=await i.encode();return r.blocks.push({block:s,node:i}),e.cache.set(i),new n.BranchEntryClass({key:i.key,address:await i.address},n)}))}async function Hg(e,t,r,n){let i=t.root;t.blocks.push({block:await i.encode(),node:i}),e.cache.set(i);let s=n.opts,o=i.distance,a=i.entryList.startKey,l=await jg(a,r,e.compare);if(l.length){let u=await $g(l,s,e),c=await Rg(e,u,t,s),f=[new s.BranchEntryClass({key:i.entryList.startKey,address:await i.address},s),...c].sort(({key:y},{key:h})=>s.compare(y,h)),w=await Mt.from({...n,entries:f,chunker:e.chunker,NodeClass:s.BranchClass,distance:o+1}),d=[...w];for(;w.length>1;){let y=await Promise.all(w.map(async h=>new s.BranchEntryClass({key:h.key,address:await h.address},s)));w=await Mt.from({...n,entries:y.sort(({key:h},{key:p})=>s.compare(h,p)),chunker:e.chunker,NodeClass:s.BranchClass,distance:o+1}),d=[...d,...w]}await Promise.all(d.map(async y=>{let h=await y.encode();e.cache.set(y),t.blocks.push({block:h,node:y})})),t.root=w[0],t.nodes=[...t.nodes,...d]}}var Mt=class Re{constructor({entryList:t,chunker:r,distance:n,getNode:i,compare:s,cache:o}){this.entryList=t,this.chunker=r,this.distance=n,this.getNode=i,this.compare=s,this.cache=o}get closed(){return this.entryList.closed}get key(){return this.entryList.startKey}async getEntry(t,r=new Pr){return{result:await this._getEntry(t,r),cids:r}}async _getEntry(t,r){r.add(this);let n=this;for(;!n.isLeaf;){let o=n.entryList.find(t,this.compare);if(o===null)throw new Error("Not found");let[,a]=o;n=await this.getNode(await a.address),r.add(n)}let i=n.entryList.find(t,this.compare);if(i===null||i[1].key.toString()!==t.toString())throw new Error("Not found");let[,s]=i;return s}async getAllEntries(t=new Pr){return{result:await this._getAllEntries(t),cids:t}}_getAllEntries(t){if(t.add(this),this.isLeaf)return this.entryList.entries;{let{entries:r}=this.entryList,n=async i=>this.getNode(await i.address).then(s=>s._getAllEntries(t)).catch(async s=>{throw s});return Promise.all(r.map(n)).then(i=>i.flat())}}async*vis(t=new Set){let r=async s=>s.isLeaf?`Leaf [${s.entryList.entries.map(o=>`[${o.key},${JSON.stringify(o.value).replace(/"/g,"'")}]`).join(", ")}]`:`Branch [${s.entryList.entries.map(o=>`[${o.key}]`).join(", ")}]`,n=s=>s.toString().slice(0,4)+s.toString().slice(-4),i=async function*(s,o,a){let l=await s.address;if(!a.has(l)){a.add(l);let u=await r(s);yield`  node [shape=ellipse fontname="Courier"]; ${n(l)} [label="${u}"];`,yield`  ${n(o)} -> ${n(l)};`;for(let c of s.entryList.entries)if(c.address){let f=await c.address;try{let w=await s.getNode(f);yield*await i(w,l,a)}catch(w){yield`  ${n(l)} -> ${n(f)};`,yield`  node [shape=ellipse fontname="Courier"]; ${n(f)} [label="Error: ${w.message}"];`}}}};yield"digraph tree {",yield'  node [shape=ellipse fontname="Courier"]; rootnode;';for await(let s of i(this,"rootnode",t))yield s;yield"}"}async getEntries(t,r=!1,n=new Pr){return{result:await this._getEntries(t,r,n),cids:n}}async _getEntries(t,r,n){n.add(this),r||(t=t.sort(this.compare));let i=this.entryList.findMany(t,this.compare,!0,this.isLeaf);if(this.isLeaf)return[...i.values()].map(([o])=>o);let s=[];for(let[o,a]of[...i.values()].reverse()){let l=this.getNode(await o.address);s.push(l.then(u=>u._getEntries(a.reverse(),!0,n)))}return s=await Promise.all(s),s.flat()}async getRangeEntries(t,r,n=new Pr){return{result:await this._getRangeEntries(t,r,n),cids:n}}_getRangeEntries(t,r,n){n.add(this);let{entries:i}=this.entryList.findRange(t,r,this.compare);if(this.isLeaf)return i.filter(l=>{let u=this.compare(t,l.key),c=this.compare(r,l.key);return u<=0&&c>=0});if(!i.length)return[];let s=async l=>this.getNode(await l.address).then(u=>u._getRangeEntries(t,r,n)),o=[s(i.shift())];if(!i.length)return o[0];let a=s(i.pop());for(;i.length;){let l=async u=>this.getNode(await u.address).then(async c=>c._getAllEntries(n));o.push(l(i.shift()))}return o.push(a),Promise.all(o).then(l=>l.flat())}async transaction(t,r={}){r={codec:this.codec,hasher:this.hasher,getNode:this.getNode,compare:this.compare,cache:this.cache,...r};let n={chunker:this.chunker,opts:r},i=this.entryList.findMany(t,r.compare,!0,this.isLeaf);return this.isLeaf?await this.transactionLeaf(t,r,n,i):await this.transactionBranch(t,r,n,i)}async transactionLeaf(t,r,n,i){let{LeafClass:s,LeafEntryClass:o}=r,{entries:a,previous:l}=this.processLeafEntries(t,i,o,r),u={...n,entries:a,NodeClass:s,distance:0},c=await Re.from(u);return{nodes:c,previous:l,blocks:await Promise.all(c.map(async f=>{let w=await f.encode();return this.cache.set(f),{block:w,node:f}})),distance:0}}processLeafEntries(t,r,n,i){let s=[],o=[],a={},l=new Map;for(let{key:f,del:w,value:d}of t){let y=sa(f);w?typeof a[y]>"u"&&l.set(y,null):(a[y]={key:f,value:d},l.delete(y))}o=[...this.entryList.entries];for(let[f,[w]]of r){s.push(w);let d=sa(w.key);l.has(d)?l.set(d,f):(o[f]=new n(a[d],i),delete a[d])}let u=0;for(let[,f]of l)f!==null&&o.splice(f-u++,1);let c=Object.values(a).map(f=>new n(f,i));return o=o.concat(c).sort(({key:f},{key:w})=>i.compare(f,w)),{entries:o,previous:s}}async transactionBranch(t,r,n,i){let{BranchClass:s,BranchEntryClass:o}=r,a=0;for(let[y,[h,p]]of i){let g=this.getNode(await h.address).then(m=>m.transaction(p.reverse(),{...r,sorted:!0})).then(m=>({entry:h,keys:p,distance:a,...m}));i.set(y,g)}let l=[...this.entryList.entries],u={previous:[],blocks:[],nodes:[]};for(let[y,h]of i){let{nodes:p,previous:g,blocks:m,distance:b}=await h;a=b,l[y]=p,g.length&&(u.previous=u.previous.concat(g)),m.length&&(u.blocks=u.blocks.concat(m)),p.length&&(u.nodes=u.nodes.concat(p))}l=l.flat();let c=await this.handlePrepend(l,r,n,u,a);a++;let f=async y=>{if(y.isEntry)return y;let h=await y.encode();return u.blocks.push({block:h,node:y}),this.cache.set(y),new o(y,r)};l=await Promise.all(c.map(f));let w={...n,entries:l,NodeClass:s,distance:a},d=await Re.from(w);return await Promise.all(d.map(async y=>{let h=await y.encode();u.blocks.push({block:h,node:y}),this.cache.set(y)})),u.nodes=d,{...u,distance:a}}async handlePrepend(t,r,n,i,s){let{BranchClass:o,LeafClass:a}=r,l=[],u=null;for(let c of t)if(u){let f=await this.mergeFirstLeftEntries(c,u,n,i,s);u=null;let w=f[0].address?o:a,d={...n,entries:f.sort(({key:h},{key:p})=>r.compare(h,p)),NodeClass:w,distance:s},y=await Re.from(d);y[y.length-1].closed||(u=y.pop()),y.length&&(l=l.concat(y))}else!c.isEntry&&!c.closed?u=c:l.push(c);return u&&l.push(u),l}async getNodeFirstFromBlocks(t,r){for(let{block:n,node:i}of t)if(await n.cid===r)return i;return await this.getNode(r)}async mergeFirstLeftEntries(t,r,n,i,s){let o=n.opts,{LeafClass:a,BranchClass:l,BranchEntryClass:u}=o;if(t.isEntry){let d=await t.address;t=await this.getNodeFirstFromBlocks(i.blocks,d)}let c=t.entryList.entries;if(!c.length)throw new Error("unreachable no entries");let f=(d,y)=>d.concat(y),w=async(d,y,h)=>await Promise.all(d.map(async p=>(y.blocks.push({block:await p.encode(),node:p}),this.cache.set(p),new u({key:p.key,address:await p.address},h))));if(c[0].constructor.name===r.entryList.entries[0].constructor.name)return await f(r.entryList.entries,c);{let d=c.shift();if(!d)throw new Error("unreachable no left entry");if(!d.address)throw new Error("unreachable existing leaf, no leftEntry.address");let y=await this.mergeFirstLeftEntries(d,r,n,i,s-1),h=c.shift();if(!h)return y;if(!h.address)throw new Error("unreachable existing leaf, no esf.address");let p=await this.getNodeFirstFromBlocks(i.blocks,await h.address);if(p.entryList.entries[0].address){if(y[0].address)return y.concat(p.entryList.entries);{let g=await Re.from({...n,entries:y.sort(({key:k},{key:S})=>o.compare(k,S)),NodeClass:a,distance:s}),m=await w(g,i,o),b=await Re.from({...n,entries:[...p.entryList.entries,...m,...c].sort(({key:k},{key:S})=>o.compare(k,S)),NodeClass:l,distance:s});return await w(b,i,o)}}else{let g=await f(y,p.entryList.entries),m=await Re.from({...n,entries:g.sort(({key:k},{key:S})=>o.compare(k,S)),NodeClass:a,distance:s}),b=await w(m,i,o);return await f(b,c)}}}async bulk(t,r={},n=!0){let{BranchClass:i}=r;r={codec:this.codec,hasher:this.hasher,getNode:this.getNode,compare:this.compare,cache:this.cache,...r},r.sorted||(t=zg(t,r),r.sorted=!0);let s={chunker:this.chunker,opts:r},o=await this.transaction(t,r);for(;o.nodes.length>1;){let a=o.nodes[0].distance+1,l=await Promise.all(o.nodes.map(async c=>{let f=await c.encode();return o.blocks.push({block:f,node:c}),this.cache.set(c),new r.BranchEntryClass(c,r)})),u=await Re.from({...s,entries:l,NodeClass:i,distance:a});await Promise.all(u.map(async c=>{let f=await c.encode();this.cache.set(c),o.blocks.push({block:f,node:c})})),o.nodes=u}return o.root=o.nodes[0],n&&o.root&&await Hg(this,o,t,s),o.blocks=o.blocks.map(({block:a})=>a),o}static async from({entries:t,chunker:r,NodeClass:n,distance:i,opts:s}){if(!t.every(l=>l.constructor.name===t[0].constructor.name))throw new Error("all entries must be of the same type");let o=[],a=[];for(let l of t)a.push(l),await r(l,i)&&(o.push(new pn({entries:a,closed:!0})),a=[]);return a.length&&o.push(new pn({entries:a,closed:!1})),o.map(l=>new n({entryList:l,chunker:r,distance:i,...s}))}},Yl=class extends Mt{constructor({codec:e,hasher:t,block:r,...n}){super(n),this.codec=e,this.hasher=t,r?(this.block=r,this.address=r.cid):(this.block=this.encode(),this.address=this.block.then(i=>i.cid))}async get(e){let{result:t,cids:r}=await this.getEntry(e);return{result:t.key,cids:r}}async encode(){if(this.block)return this.block;let e=await this.encodeNode(),t={codec:this.codec,hasher:this.hasher,value:e};return this.block=await Pt(t),this.block}},Zl=class extends Yl{async encodeNode(){let{entries:e}=this.entryList,t=async n=>{if(!n.address)throw new Error("entry.address required");return[n.key,await n.address]},r=await Promise.all(e.map(t));return{branch:[this.distance,r],closed:this.closed}}get isBranch(){return!0}},eu=class extends Yl{async encodeNode(){return{leaf:await Promise.all(this.entryList.entries.map(async e=>await e.encodeNode())),closed:this.closed}}get isLeaf(){return!0}},tu=async function*(e){let{LeafClass:t,LeafEntryClass:r,BranchClass:n,BranchEntryClass:i,list:s,chunker:o,compare:a,...l}=e;s=s.map(f=>new r(f,l)),l.compare=a;let u=await Mt.from({entries:s,chunker:o,NodeClass:t,distance:0,opts:l});yield*u;let c=1;for(;u.length>1;){let f=async d=>new i({key:d.key,address:await d.address},l),w=await Promise.all(u.map(f));u=await Mt.from({entries:w,chunker:o,NodeClass:n,distance:c,opts:l}),yield*u,c++}},Di=({bytes:e},{bytes:t})=>Ug(e,t),ru=class extends Ds{constructor(e){super({address:e,key:e}),this.cid=e}encodeNode(){return this.cid}identity(){let e=this.cid.multihash.bytes;return Ts(e)}},nu=class extends Ds{async identity(){let{multihash:{bytes:e}}=await this.address;return Ts(e)}},iu=class extends Zl{},su=class extends eu{},ou=(e,t,r,n,i)=>{let s=a=>{let{value:l}=a,u={chunker:r,cache:t,block:a,getNode:o,codec:n,hasher:i,compare:Di},c,f;if(l.leaf)c=l.leaf.map(y=>new ru(y)),f=su;else if(l.branch){let[y,h]=l.branch;u.distance=y,c=h.map(([p,g])=>new nu({key:p,address:g})),f=iu}else throw new Error("Unknown block data, does not match schema");let w=new pn({entries:c,closed:l.closed}),d=new f({entryList:w,...u});return t.set(d),d},o=a=>t.has(a)?t.get(a):e(a).then(l=>s(l));return o},qg=({get:e,cache:t,chunker:r,list:n,codec:i,hasher:s,sorted:o})=>{o||(n=n.sort(Di));let a=ou(e,t,r,i,s);return tu({list:n,codec:i,hasher:s,chunker:r,getNode:a,sorted:o,compare:Di,cache:t,LeafClass:su,LeafEntryClass:ru,BranchClass:iu,BranchEntryClass:nu})},Vg=({cid:e,get:t,cache:r,chunker:n,codec:i,hasher:s,...o})=>ou(t,r,n,i,s,o)(e),Wg=async function*({get:e,cids:t,hasher:r,key:n,cache:i,chunker:s,root:o}){let a=new Set,l;for(let w of t){let d=await e(w);if(!d)throw new Error("missing cid: "+w.toString());let y=await Bs({...d,key:n}),h=await Pt({...y,codec:Ct,hasher:r});yield h,a.add(h.cid.toString()),d.cid.equals(o)&&(l=h.cid)}if(!l)throw new Error("cids does not include root");let u=[...a].map(w=>ee.parse(w)),c;for await(let w of qg({list:u,get:e,cache:i,chunker:s,hasher:r,codec:ce})){let d=await w.block;yield d,c=d}if(!c)throw new Error("missing last block");let f=[l,c.cid];yield await Pt({value:f,codec:ce,hasher:r})},Gg=async function*({root:e,get:t,key:r,cache:n,chunker:i,hasher:s}){let o=async p=>t(p).then(async g=>g?await nr({...g,codec:ce,hasher:s}):void 0),a=async p=>t(p).then(async g=>g?await nr({...g,codec:Ct,hasher:s}):void 0),l=await o(e);if(!l)throw new Error("missing root");if(!l.bytes)throw new Error("missing bytes");let{value:[u,c]}=l,f=await t(u);if(!f)throw new Error("missing root block");let w=await Vg({cid:c,get:o,cache:n,chunker:i,codec:Ct,hasher:s}),{result:d}=await w.getAllEntries(),y=async p=>{if(!p)throw new Error("missing block");p.value||(p=await nr({...p,codec:Ct,hasher:s}));let{bytes:g,cid:m}=await Fs({...p,key:r}).catch(b=>{throw b});return await Wl({cid:m,bytes:g,hasher:s,codec:Ct})},h=[];for(let{cid:p}of d)f.cid.equals(p)||h.push(a(p).then(y));yield*h,yield y(f)},Mn={has:()=>!1,get:()=>{throw new Error("Cannot ask for entries from nocache")},set:()=>{}},au=Cs(30);function lu(e){let t=e.length,r=new Uint8Array(t/2);for(let n=0;n<t;n+=2)r[n/2]=parseInt(e.substring(n,n+2),16);return r}async function Kg(e,t,r){let n=lu(e),i=n.buffer.slice(0,n.byteLength),s=new ot,o=[];for(let{cid:l}of r.entries())o.push(l);let a=null;for await(let l of Wg({cids:o,get:r.get.bind(r),key:i,hasher:Te,chunker:au,cache:Mn,root:t}))await s.put(l.cid,l.bytes),a=l;if(!a)throw new Error("no blocks encrypted");return await Kl([a.cid],s)}async function Jg(e,t){let r=(await t.getRoots())[0];return await Qg(r,t.get.bind(t),e)}async function Qg(e,t,r){let n=lu(r),i=n.buffer.slice(0,n.byteLength),s=new ot,o=null;for await(let a of Gg({root:e,get:t,key:i,hasher:Te,chunker:au,cache:Mn}))await s.put(a.cid,a.bytes),o=a;if(!o)throw new Error("no blocks decrypted");return{blocks:s,root:o.cid}}var Xg=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===v.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===v.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[v.uint.major](e,t){this.prefix(e);let r=String(t.value),n=[];for(let i=0;i<r.length;i++)n[i]=r.charCodeAt(i);e.push(n)}[v.negint.major](e,t){this[v.uint.major](e,t)}[v.bytes.major](e,t){throw new Error(`${it} unsupported type: Uint8Array`)}[v.string.major](e,t){this.prefix(e);let r=sl(JSON.stringify(t.value));e.push(r.length>32?Yi(r):r)}[v.array.major](e,t){this.prefix(e),this.inRecursive.push({type:v.array,elements:0}),e.push([91])}[v.map.major](e,t){this.prefix(e),this.inRecursive.push({type:v.map,elements:0}),e.push([123])}[v.tag.major](e,t){}[v.float.major](e,t){if(t.type.name==="break"){let s=this.inRecursive.pop();if(s){if(s.type===v.array)e.push([93]);else if(s.type===v.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${it} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}let r=String(t.value),n=[],i=!1;for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s),!i&&(n[s]===46||n[s]===101||n[s]===69)&&(i=!0);i||(n.push(46),n.push(48)),e.push(n)}};function Yg(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw new Error(`${it} complex map keys are not supported`);let r=e[0],n=t[0];if(r.type!==v.string||n.type!==v.string)throw new Error(`${it} non-string map keys are not supported`);if(r<n)return-1;if(r>n)return 1;throw new Error(`${it} unexpected duplicate map keys, this is not supported`)}var Zg={addBreakTokens:!0,mapSorter:Yg};function e1(e,t){return t=Object.assign({},Zg,t),wl(e,new Xg,t)}var uu=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${O} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${O} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this.pos,t=!1,r=!1,n=o=>{for(;!this.done();){let a=this.ch();if(o.includes(a))this.pos++;else break}};if(this.ch()===45&&(t=!0,this.pos++),this.ch()===48)if(this.pos++,this.ch()===46)this.pos++,r=!0;else return new _(v.uint,0,this.pos-e);if(n([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${O} unexpected token at position ${this.pos}`);if(!this.done()&&this.ch()===46){if(r)throw new Error(`${O} unexpected token at position ${this.pos}`);r=!0,this.pos++,n([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(r=!0,this.pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this.pos++,n([48,49,50,51,52,53,54,55,56,57]));let i=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),s=parseFloat(i);return r?new _(v.float,s,this.pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(s)?new _(s>=0?v.uint:v.negint,s,this.pos-e):new _(s>=0?v.uint:v.negint,BigInt(i),this.pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${O} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let i=this.pos,s=0;i<this.data.length&&s<65536;i++,s++){let o=this.data[i];if(o===92||o<32||o>=128)break;if(o===34){let a=String.fromCharCode.apply(null,this.data.subarray(this.pos,i));return this.pos=i+1,new _(v.string,a,s)}}let e=this.pos,t=[],r=()=>{if(this.pos+4>=this.data.length)throw new Error(`${O} unexpected end of unicode escape sequence at position ${this.pos}`);let i=0;for(let s=0;s<4;s++){let o=this.ch();if(o>=48&&o<=57)o-=48;else if(o>=97&&o<=102)o=o-97+10;else if(o>=65&&o<=70)o=o-65+10;else throw new Error(`${O} unexpected unicode escape character at position ${this.pos}`);i=i*16+o,this.pos++}return i},n=()=>{let i=this.ch(),s=null,o=i>239?4:i>223?3:i>191?2:1;if(this.pos+o>this.data.length)throw new Error(`${O} unexpected unicode sequence at position ${this.pos}`);let a,l,u,c;switch(o){case 1:i<128&&(s=i);break;case 2:a=this.data[this.pos+1],(a&192)===128&&(c=(i&31)<<6|a&63,c>127&&(s=c));break;case 3:a=this.data[this.pos+1],l=this.data[this.pos+2],(a&192)===128&&(l&192)===128&&(c=(i&15)<<12|(a&63)<<6|l&63,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:a=this.data[this.pos+1],l=this.data[this.pos+2],u=this.data[this.pos+3],(a&192)===128&&(l&192)===128&&(u&192)===128&&(c=(i&15)<<18|(a&63)<<12|(l&63)<<6|u&63,c>65535&&c<1114112&&(s=c))}s===null?(s=65533,o=1):s>65535&&(s-=65536,t.push(s>>>10&1023|55296),s=56320|s&1023),t.push(s),this.pos+=o};for(;!this.done();){let i=this.ch(),s;switch(i){case 92:if(this.pos++,this.done())throw new Error(`${O} unexpected string termination at position ${this.pos}`);switch(s=this.ch(),this.pos++,s){case 34:case 39:case 92:case 47:t.push(s);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw new Error(`${O} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new _(v.string,ol(t),this.pos-e);default:if(i<32)throw new Error(`${O} invalid control character at position ${this.pos}`);i<128?(t.push(i),this.pos++):n()}}throw new Error(`${O} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new _(v.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new _(v.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new _(v.null,null,4);case 102:return this.expect([102,97,108,115,101]),new _(v.false,!1,5);case 116:return this.expect([116,114,117,101]),new _(v.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${O} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this.pos++,this.skipWhitespace(),new _(v.break,void 0,1);if(this.ch()!==44)throw new Error(`${O} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this.pos++,this.skipWhitespace(),new _(v.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new _(v.break,void 0,1);if(this.ch()!==44)throw new Error(`${O} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this.pos++,this.skipWhitespace(),new _(v.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${O} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${O} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}};function t1(e,t){return t=Object.assign({tokenizer:new uu(e,t)},t),gl(e,t)}var cu=ye({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Dk=ye({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Nk=ye({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Lk=ye({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function r1(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=ee.asCID(e);if(!t)return null;let r=t.toString();return[new _(v.map,1/0,1),new _(v.string,"/",1),new _(v.string,r,r.length),new _(v.break,void 0,1)]}function yn(e){let t=cu.encode(e).slice(1);return[new _(v.map,1/0,1),new _(v.string,"/",1),new _(v.map,1/0,1),new _(v.string,"bytes",5),new _(v.string,t,t.length),new _(v.break,void 0,1),new _(v.break,void 0,1)]}function ke(e){return yn(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function n1(e){return yn(new Uint8Array(e))}function i1(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function s1(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var o1={typeEncoders:{Object:r1,Buffer:yn,Uint8Array:yn,Int8Array:ke,Uint16Array:ke,Int16Array:ke,Uint32Array:ke,Int32Array:ke,Float32Array:ke,Float64Array:ke,Uint8ClampedArray:ke,BigInt64Array:ke,BigUint64Array:ke,DataView:ke,ArrayBuffer:n1,undefined:i1,number:s1}},a1=class extends uu{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===v.map){let t=this._next();if(t.type===v.string&&t.value==="/"){let r=this._next();if(r.type===v.string){if(this._next().type!==v.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(r),new _(v.tag,42,0)}if(r.type===v.map){let n=this._next();if(n.type===v.string&&n.value==="bytes"){let i=this._next();if(i.type===v.string){for(let o=0;o<2;o++)if(this._next().type!==v.break)throw new Error("Invalid encoded Bytes form");let s=cu.decode(`m${i.value}`);return new _(v.bytes,s,i.value.length)}this.tokenBuffer.push(i)}this.tokenBuffer.push(n)}this.tokenBuffer.push(r)}this.tokenBuffer.push(t)}return e}},Ni={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Ni.tags[42]=ee.parse;var l1=e=>e1(e,o1),u1=e=>{let t=Object.assign(Ni,{tokenizer:new a1(e,Ni)});return t1(e,t)},hu=e=>c1.decode(l1(e)),c1=new TextDecoder,fu=e=>u1(h1.encode(e)),h1=new TextEncoder,f1=(e,t)=>t.some(r=>e instanceof r),oa,aa;function d1(){return oa||(oa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function p1(){return aa||(aa=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var du=new WeakMap,Li=new WeakMap,pu=new WeakMap,ui=new WeakMap,Ns=new WeakMap;function y1(e){let t=new Promise((r,n)=>{let i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",o)},s=()=>{r(Ke(e.result)),i()},o=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",o)});return t.then(r=>{r instanceof IDBCursor&&du.set(r,e)}).catch(()=>{}),Ns.set(t,e),t}function w1(e){if(Li.has(e))return;let t=new Promise((r,n)=>{let i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",o),e.removeEventListener("abort",o)},s=()=>{r(),i()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",o),e.addEventListener("abort",o)});Li.set(e,t)}var Ii={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return Li.get(e);if(t==="objectStoreNames")return e.objectStoreNames||pu.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Ke(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function g1(e){Ii=e(Ii)}function b1(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){let n=e.call(ci(this),t,...r);return pu.set(n,t.sort?t.sort():[t]),Ke(n)}:p1().includes(e)?function(...t){return e.apply(ci(this),t),Ke(du.get(this))}:function(...t){return Ke(e.apply(ci(this),t))}}function m1(e){return typeof e=="function"?b1(e):(e instanceof IDBTransaction&&w1(e),f1(e,d1())?new Proxy(e,Ii):e)}function Ke(e){if(e instanceof IDBRequest)return y1(e);if(ui.has(e))return ui.get(e);let t=m1(e);return t!==e&&(ui.set(e,t),Ns.set(t,e)),t}var ci=e=>Ns.get(e);function v1(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let o=indexedDB.open(e,t),a=Ke(o);return n&&o.addEventListener("upgradeneeded",l=>{n(Ke(o.result),l.oldVersion,l.newVersion,Ke(o.transaction),l)}),r&&o.addEventListener("blocked",l=>r(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}var k1=["get","getKey","getAll","getAllKeys","count"],E1=["put","add","delete","clear"],hi=new Map;function la(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(hi.get(t))return hi.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=E1.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||k1.includes(r)))return;let s=async function(o,...a){let l=this.transaction(o,i?"readwrite":"readonly"),u=l.store;return n&&(u=u.index(a.shift())),(await Promise.all([u[r](...a),i&&l.done]))[0]};return hi.set(t,s),s}g1(e=>({...e,get:(t,r,n)=>la(t,r)||e.get(t,r,n),has:(t,r)=>!!la(t,r)||e.has(t,r)}));var yu="0.13.4-dev",wu=yu.match(/^([^.]*\.[^.]*)/);if(!wu)throw new Error("invalid version: "+yu);var Ls=wu[0],x1=class{constructor(e){A(this,"STORAGE_VERSION",Ls),A(this,"name"),this.name=e}},gu=class extends x1{constructor(){super(...arguments),A(this,"tag","header-base")}makeHeader({car:e,key:t}){return hu({car:e,key:t})}parseHeader(e){return fu(e)}},bu=class{constructor(e){A(this,"tag","car-base"),A(this,"STORAGE_VERSION",Ls),A(this,"loader"),this.loader=e}},S1=class{constructor(e){A(this,"tag","rwal-base"),A(this,"STORAGE_VERSION",Ls),A(this,"loader"),A(this,"ready"),A(this,"walState",{operations:[],noLoaderOps:[],fileOperations:[]}),A(this,"processing"),this.loader=e,this.ready=(async()=>{let t=await this.load().catch(r=>(console.error("error loading wal",r),null));this.walState.operations=t?.operations||[],this.walState.fileOperations=t?.fileOperations||[]})()}async enqueue(e,t){await this.ready,t.noLoader?this.walState.noLoaderOps.push(e):this.walState.operations.push(e),await this.save(this.walState),t.noLoader||this._process()}async enqueueFile(e,t=!1){await this.ready,this.walState.fileOperations.push({cid:e,public:t})}async _process(){if(await this.ready,!this.loader.remoteCarStore)return;if(this.processing)return this.processing;let e=(async()=>{await this._int_process()})();this.processing=e;try{await e}finally{this.processing=void 0}(this.walState.operations.length||this.walState.fileOperations.length||this.walState.noLoaderOps.length)&&setTimeout(()=>void this._process(),0)}async _int_process(){if(!this.loader.remoteCarStore)return;let e=(async()=>{let t=[...this.walState.operations],r=[...this.walState.fileOperations],n=[],i=[...this.walState.noLoaderOps],s=il(5);if(t.length+r.length+i.length!==0){for(let o of i){let a=s(async()=>{let l=await this.loader.carStore.load(o.car).catch(()=>null);if(!l)throw new Error(`missing car ${o.car.toString()}`);await this.loader.remoteCarStore.save(l),this.walState.noLoaderOps=this.walState.noLoaderOps.filter(u=>u!==o)});n.push(a)}for(let o of t){let a=s(async()=>{let l=await this.loader.carStore.load(o.car).catch(()=>null);if(!l)throw new Error(`missing car ${o.car.toString()}`);await this.loader.remoteCarStore.save(l),this.walState.operations=this.walState.operations.filter(u=>u!==o)});n.push(a)}if(r.length){let o=this.loader;for(let{cid:a,public:l}of r){let u=s(async()=>{let c=await o.fileStore.load(a);await o.remoteFileStore?.save(c,{public:l}),this.walState.fileOperations=this.walState.fileOperations.filter(f=>f.cid!==a)});n.push(u)}}try{let o=(await Promise.allSettled(n)).filter(a=>a.status==="rejected");if(o.length)throw console.error("error uploading",o),o[0].reason;if(t.length){let a=t[t.length-1];await this.loader.remoteMetaStore?.save(a).catch(l=>{throw console.error("error saving remote meta",l),this.walState.operations.push(a),l})}}finally{await this.save(this.walState)}}})();this.loader.remoteMetaLoading=e,await e}},mu=class extends bu{constructor(){super(...arguments),A(this,"tag","car-browser-idb"),A(this,"idb",null)}async _withDB(e){if(!this.idb){let t=`fp.${this.STORAGE_VERSION}.${this.loader.keyId}.${this.loader.name}`;this.idb=await v1(t,1,{upgrade(r){r.createObjectStore("cars")}})}return await e(this.idb)}async load(e){return await this._withDB(async t=>{let r=await t.transaction(["cars"],"readonly").objectStore("cars").get(e.toString());if(!r)throw new Error(`missing idb block ${e.toString()}`);return{cid:e,bytes:r}})}async save(e){return await this._withDB(async t=>{let r=t.transaction(["cars"],"readwrite");return await r.objectStore("cars").put(e.bytes,e.cid.toString()),await r.done})}async remove(e){return await this._withDB(async t=>{let r=t.transaction(["cars"],"readwrite");return await r.objectStore("cars").delete(e.toString()),await r.done})}},A1=class extends S1{constructor(){super(...arguments),A(this,"tag","wal-browser-ls")}headerKey(e){return`fp.${this.STORAGE_VERSION}.wal.${this.loader.name}.${e}`}async load(e="main"){try{let t=localStorage.getItem(this.headerKey(e));return t?fu(t):null}catch{return null}}async save(e,t="main"){try{let r=hu(e);localStorage.setItem(this.headerKey(t),r)}catch{}}},_1=class extends gu{constructor(){super(...arguments),A(this,"tag","header-browser-ls")}headerKey(e){return`fp.${this.STORAGE_VERSION}.meta.${this.name}.${e}`}async load(e="main"){try{let t=localStorage.getItem(this.headerKey(e));return t?[this.parseHeader(t)]:null}catch{return null}}async save(e,t="main"){try{let r=this.headerKey(t),n=this.makeHeader(e);return localStorage.setItem(r,n),null}catch{return null}}};function vu(e,t){return e.some(r=>r.equals(t))}function ua(e,t=[]){let r=new Map;for(let n of e)vu(t,n)||r.set(n.toString(),n);return[...r.values()]}function F1(e){return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}var Is=class{constructor(e,t){A(this,"name"),A(this,"opts",{}),A(this,"remoteMetaLoading"),A(this,"remoteMetaStore"),A(this,"remoteCarStore"),A(this,"remoteWAL"),A(this,"metaStore"),A(this,"carStore"),A(this,"carLog",[]),A(this,"carReaders",new Map),A(this,"ready"),A(this,"key"),A(this,"keyId"),A(this,"getBlockCache",new Map),A(this,"committing"),this.name=e,this.opts=t||this.opts,this.metaStore=new _1(this.name),this.carStore=new mu(this),this.remoteWAL=new A1(this),this.ready=Promise.resolve().then(async()=>{if(!this.metaStore||!this.carStore||!this.remoteWAL)throw new Error("stores not initialized");let r=this.opts.meta?[this.opts.meta]:await this.metaStore.load("main");r&&await this.handleDbMetasFromStore(r)})}async snapToCar(e){await this.ready,typeof e=="string"&&(e=ee.parse(e));let t=await this.loadCarHeaderFromMeta({car:e,key:this.key||null});this.carLog=[e,...t.cars],await this.getMoreReaders(t.cars),await this._applyCarHeader(t,!0)}async handleDbMetasFromStore(e){for(let t of e)await this.mergeDbMetaIntoClock(t)}async mergeDbMetaIntoClock(e){if(e.key&&await this.setKey(e.key),vu(this.carLog,e.car))return;let t=await this.loadCarHeaderFromMeta(e);await this.getMoreReaders(t.cars),this.carLog=[...ua([e.car,...this.carLog,...t.cars],t.compact)],await this._applyCarHeader(t)}async ingestKeyFromMeta(e){let{key:t}=e;t&&await this.setKey(t)}async loadCarHeaderFromMeta({car:e}){let t=await this.loadCar(e);return await Cg(t)}async _getKey(){return this.key?this.key:(this.opts.public||(Ci()?await this.setKey(F1(Jl(32))):console.warn("missing crypto module, using public mode")),this.key)}async commit(e,t,r={noLoader:!1,compact:!1}){this.committing&&await this.committing,this.committing=this._commitInternal(e,t,r);let n=await this.committing;return this.committing=void 0,n}async _commitInternal(e,t,r={noLoader:!1,compact:!1}){await this.ready;let n=this.makeCarHeader(t,this.carLog,!!r.compact),i=[];if(n.files)i=n.files;else{let u=await Tg(n);await e.put(u.cid,u.bytes),i=[u.cid]}let s=r.public?null:await this._getKey(),{cid:o,bytes:a}=s?await Kg(s,i[0],e):await Kl(i,e);if(Iu(t))return await this.fileStore.save({cid:o,bytes:a}),await this.remoteWAL.enqueueFile(o,r.public),o;await this.carStore.save({cid:o,bytes:a});let l={car:o,key:s||null};if(await this.remoteWAL.enqueue(l,r),await this.metaStore.save(l),r.compact){let u=n;this.carLog=[...ua([o,...this.carLog],u.compact)],(async()=>{this.remoteMetaLoading&&await this.remoteMetaLoading;for(let c of u.compact)await this.carStore.remove(c)})()}else this.carLog.unshift(o);return o}async getBlock(e){await this.ready;let t=e.toString();if(this.getBlockCache.has(t))return this.getBlockCache.get(t);let r=await Promise.any(this.carLog.map(async n=>{let i=await this.loadCar(n);if(!i)throw new Error(`missing car reader ${n.toString()}`);let s=await i.get(e);if(s)return s;throw new Error(`block not in reader: ${e.toString()}`)})).catch(()=>{});return r&&this.getBlockCache.set(t,r),r}async loadCar(e){if(!this.carStore)throw new Error("car store not initialized");return await this.storesLoadCar(e,this.carStore,this.remoteCarStore)}async storesLoadCar(e,t,r,n){let i=e.toString();return this.carReaders.has(i)||this.carReaders.set(i,(async()=>{let s=null;try{s=await t.load(e)}catch{if(r){let l=await r.load(e);l&&(await t.save(l),s=l)}}if(!s)throw new Error(`missing car file ${i}`);let o=await Dl.fromBytes(s.bytes),a=n?Promise.resolve(o):this.ensureDecryptedReader(o);return this.carReaders.set(i,a),a})().catch(s=>{throw this.carReaders.delete(i),s})),this.carReaders.get(i)}async ensureDecryptedReader(e){let t=await this._getKey();if(!t)return e;let{blocks:r,root:n}=await Jg(t,e);return{getRoots:()=>[n],get:r.get.bind(r)}}async setKey(e){if(this.key&&this.key!==e)throw new Error("key mismatch");this.key=e;let t=Ci();if(!t)throw new Error("missing crypto module");let r=t.subtle,n=new TextEncoder().encode(e),i=await r.digest("SHA-256",n),s=Array.from(new Uint8Array(i));this.keyId=s.map(o=>o.toString(16).padStart(2,"0")).join("")}async getMoreReaders(e){let t=il(5),r=e.filter(n=>!this.carReaders.has(n.toString()));await Promise.all(r.map(n=>t(()=>this.loadCar(n))))}};A(Is,"defaultHeader");var hr=J(mf(),1),ku=class extends Ds{async identity(){let e=await this.codec.encode(await this.encodeNode()),t=await this.hasher.encode(e);return Ts(t)}},Un=class extends ku{constructor(e,t){super(e,t),this.value=e.value}encodeNode(){return[this.key,this.value]}},zn=class extends ku{constructor(e,t){if(!e.address)throw new Error("Cannot create MapBranchEntry without address");super(e,t)}async encodeNode(){return[this.key,await this.address]}},Eu=async(e,t)=>{let{result:r,cids:n}=await e.getEntry(t);return{result:r.value,cids:n}},xu=async(e,t)=>{let{result:r,cids:n}=await e.getEntries(t);return{result:r.map(i=>i.value),cids:n}},jn=class extends eu{get(e){return Eu(this,e)}getMany(e){return xu(this,e)}bulk(e,t={},r=!0){return super.bulk(e,{...Su,...t},r)}},$n=class extends Zl{get(e){return Eu(this,e)}getMany(e){return xu(this,e)}bulk(e,t={},r=!0){return super.bulk(e,{...Su,...t},r)}},Su={LeafClass:jn,LeafEntryClass:Un,BranchClass:$n,BranchEntryClass:zn},Au=(e,t,r,n,i,s,o)=>{let a=o.LeafClass||jn,l=o.LeafEntryClass||Un,u=o.BranchClass||$n,c=o.BranchEntryClass||zn,f=async d=>t.has(d)?t.get(d):e(d).then(y=>w(y)),w=C1({chunker:r,cache:t,getNode:f,codec:n,hasher:i,compare:s,LeafEntryClass:l,LeafClass:a,BranchEntryClass:c,BranchClass:u});return f},B1=({get:e,cache:t,chunker:r,list:n,codec:i,hasher:s,sorted:o,compare:a,...l})=>{o||(n=n.sort(({key:f},{key:w})=>a(f,w)));let u=Au(e,t,r,i,s,a,l),c={list:n,codec:i,hasher:s,chunker:r,getNode:u,sorted:o,compare:a,cache:t,LeafClass:l.LeafClass||jn,LeafEntryClass:l.LeafEntryClass||Un,BranchClass:l.BranchClass||$n,BranchEntryClass:l.BranchEntryClass||zn};return tu(c)},T1=({cid:e,get:t,cache:r,chunker:n,codec:i,hasher:s,compare:o,...a})=>Au(t,r,n,i,s,o,a)(e);function C1({chunker:e,cache:t,getNode:r,codec:n,hasher:i,compare:s,LeafEntryClass:o,LeafClass:a,BranchEntryClass:l,BranchClass:u}){let c={codec:n,hasher:i};return f=>{let{value:w}=f,d={chunker:e,cache:t,block:f,getNode:r,codec:n,hasher:i,compare:s},y,h;if(w.leaf)y=w.leaf.map(([m,b])=>new o({key:m,value:b},c)),h=a;else if(w.branch){let[m,b]=w.branch;d.distance=m,y=b.map(([k,S])=>new l({key:k,address:S},c)),h=u}else throw new Error("Unknown block data, does not match schema");let p=new pn({entries:y,closed:w.closed}),g=new h({entryList:p,...d});return t.set(g),g}}var D1=(e,t)=>{let[r,n]=e,[i,s]=t,o=Ar(r,i);return o!==0?o:N1(n,s)},N1=(e,t)=>{if(Number.isNaN(e))return-1;if(Number.isNaN(t))throw new Error("ref may not be Infinity or NaN");return Number.isFinite(e)?Ar(e,t):1},_u=async(e,t)=>{let r=[t,NaN],n=[t,1/0],{result:i,cids:s}=await e.getRangeEntries(r,n);return{result:i.map(o=>{let[a,l]=o.key;return{id:l,key:a,row:o.value}}),cids:s}},Fu=async(e,t,r)=>{t=[t,NaN],r=[r,1/0];let{result:n,cids:i}=await e.getRangeEntries(t,r);return{result:n.map(s=>{let[o,a]=s.key;return{id:a,key:o,row:s.value}}),cids:i}},L1=class extends jn{get(e){return _u(this,e)}range(e,t){return Fu(this,e,t)}bulk(e,t={},r=!0){return super.bulk(e,{...Os,...t},r)}},I1=class extends $n{get(e){return _u(this,e)}range(e,t){return Fu(this,e,t)}bulk(e,t={},r=!0){return super.bulk(e,{...Os,...t},r)}},O1=L1,P1=I1,Os={LeafClass:O1,BranchClass:P1,LeafEntryClass:Un,BranchEntryClass:zn},Bu={...Os,compare:D1},M1=e=>(e={...Bu,...e},B1(e)),Tu=e=>(e={...Bu,...e},T1(e)),Mr=class{constructor(){A(this,"cid",null),A(this,"root",null)}},U1=(e,t)=>{if(Number.isNaN(e))return-1;if(Number.isNaN(t))throw new Error("ref may not be Infinity or NaN");return e===1/0?1:Ar(e,t)},z1=(e,t)=>{let[r,n]=e,[i,s]=t,o=Ar(r,i);return o!==0?o:U1(n,s)},ca={cache:Mn,chunker:Cs(30),codec:ce,hasher:Te,compare:z1},ha={cache:Mn,chunker:Cs(30),codec:ce,hasher:Te,compare:Ar};function j1(e,t){let r=[];return e.forEach(({key:n,value:i,del:s})=>{if(s||!i)return;let o=!1,a=t({_id:n,...i},(l,u)=>{o=!0,!(typeof l>"u")&&r.push({key:[hr.default.encode(l),n],value:u||null})});!o&&a&&r.push({key:[hr.default.encode(a),n],value:null})}),r}function Oi(e){return async t=>{let r=await e.get(t);if(!r)throw new Error(`Missing block ${t.toString()}`);let{cid:n,bytes:i}=r;return Wl({cid:n,bytes:i,hasher:Te,codec:ce})}}async function fa(e,t,r,n){if(!r.length)return t;if(!t.root)if(t.cid)t.root=await Tu({cid:t.cid,get:Oi(e),...n});else{let o=null,a=null;for await(let l of await M1({get:Oi(e),list:r,...n})){let u=await l.block;await e.put(u.cid,u.bytes),o=u,a=l}if(!a||!o)throw new Error("failed to create index");return{root:a,cid:o.cid}}let{root:i,blocks:s}=await t.root.bulk(r);if(i){for await(let o of s)await e.put(o.cid,o.bytes);return{root:i,cid:(await i.block).cid}}else return{root:null,cid:null}}async function da(e,t,r){return await Tu({cid:t,get:Oi(e),...r})}async function St(e,t,r){return r.descending&&(t.result=t.result.reverse()),r.limit&&(t.result=t.result.slice(0,r.limit)),r.includeDocs&&(t.result=await Promise.all(t.result.map(async n=>{let i=await e.get(n.id),s=i?{_id:n.id,...i.doc}:null;return{...n,doc:s}}))),{rows:t.result.map(n=>(n.key=hr.default.decode(n.key),n.row&&!n.value&&(n.value=n.row,delete n.row),n))}}function pa(e){return e.map(t=>hr.default.encode(t))}function ya(e){return hr.default.encode(e)}function Pi({_crdt:e},t,r,n){if(r&&n)throw new Error("cannot provide both mapFn and meta");if(r&&r.constructor.name!=="Function")throw new Error("mapFn must be a function");if(e.indexers.has(t))e.indexers.get(t).applyMapFn(t,r,n);else{let i=new $1(e,t,r,n);e.indexers.set(t,i)}return e.indexers.get(t)}var $1=class{constructor(e,t,r,n){if(A(this,"blocks"),A(this,"crdt"),A(this,"name",null),A(this,"mapFn",null),A(this,"mapFnString",""),A(this,"byKey",new Mr),A(this,"byId",new Mr),A(this,"indexHead"),A(this,"includeDocsDefault",!1),A(this,"initError",null),A(this,"ready"),this.blocks=e.indexBlocks,this.crdt=e,this.applyMapFn(t,r,n),!(this.mapFnString||this.initError))throw new Error("missing mapFnString");this.ready=this.blocks.ready.then(()=>{})}applyMapFn(e,t,r){if(t&&r)throw new Error("cannot provide both mapFn and meta");if(this.name&&this.name!==e)throw new Error("cannot change name");this.name=e;try{if(r){if(this.indexHead&&this.indexHead.map(i=>i.toString()).join()!==r.head.map(i=>i.toString()).join())throw new Error("cannot apply meta to existing index");this.mapFnString?this.mapFnString!==r.map?console.log("cannot apply different mapFn meta: old mapFnString",this.mapFnString,"new mapFnString",r.map):(this.byId.cid=r.byId,this.byKey.cid=r.byKey,this.indexHead=r.head):(this.mapFnString=r.map,this.byId.cid=r.byId,this.byKey.cid=r.byKey,this.indexHead=r.head)}else if(this.mapFn){if(t&&this.mapFn.toString()!==t.toString())throw new Error("cannot apply different mapFn app2")}else{if(t||(t=R1(e)),this.mapFnString){if(this.mapFnString!==t.toString())throw new Error("cannot apply different mapFn app")}else this.mapFnString=t.toString();this.mapFn=t}let n=/=>\s*(.*)/.test(this.mapFnString);this.includeDocsDefault=n}catch(n){this.initError=n}}async query(e={}){if(await this._updateIndex(),await this._hydrateIndex(),!this.byKey.root)return await St(this.crdt,{result:[]},e);if(this.includeDocsDefault&&e.includeDocs===void 0&&(e.includeDocs=!0),e.range){let{result:n,...i}=await this.byKey.root.range(...pa(e.range));return await St(this.crdt,{result:n,...i},e)}if(e.key){let n=ya(e.key);return await St(this.crdt,await this.byKey.root.get(n),e)}if(Array.isArray(e.keys))return{rows:(await Promise.all(e.keys.map(async n=>{let i=ya(n);return(await St(this.crdt,await this.byKey.root.get(i),e)).rows}))).flat()};if(e.prefix){Array.isArray(e.prefix)||(e.prefix=[e.prefix]);let n=[...e.prefix,NaN],i=[...e.prefix,1/0],s=pa([n,i]);return await St(this.crdt,await this.byKey.root.range(...s),e)}let{result:t,...r}=await this.byKey.root.getAllEntries();return await St(this.crdt,{result:t.map(({key:[n,i],value:s})=>({key:n,id:i,value:s})),...r},e)}_resetIndex(){this.byId=new Mr,this.byKey=new Mr,this.indexHead=void 0}async _hydrateIndex(){this.byId.root&&this.byKey.root||!this.byId.cid||!this.byKey.cid||(this.byId.root=await da(this.blocks,this.byId.cid,ha),this.byKey.root=await da(this.blocks,this.byKey.cid,ca))}async _updateIndex(){if(await this.ready,this.initError)throw this.initError;if(!this.mapFn)throw new Error("No map function defined");let e,t;if(!this.indexHead||this.indexHead.length===0?{result:e,head:t}=await this.crdt.allDocs():{result:e,head:t}=await this.crdt.changes(this.indexHead),e.length===0)return this.indexHead=t,{byId:this.byId,byKey:this.byKey};let r=[],n=[];if(this.byId.root){let a=e.map(({key:u})=>u),{result:l}=await this.byId.root.getMany(a);r=l.map(u=>({key:u,del:!0})),n=l.map(u=>({key:u[1],del:!0}))}let i=j1(e,this.mapFn),s=i.map(({key:a})=>({key:a[1],value:a})),o=new Map;for(let[a,l]of this.crdt.indexers)l.indexHead&&o.set(a,{byId:l.byId.cid,byKey:l.byKey.cid,head:l.indexHead,map:l.mapFnString,name:l.name});return await this.blocks.transaction(async a=>(this.byId=await fa(a,this.byId,n.concat(s),ha),this.byKey=await fa(a,this.byKey,r.concat(i),ca),this.indexHead=t,{byId:this.byId.cid,byKey:this.byKey.cid,head:t,map:this.mapFnString,name:this.name}),o)}};function R1(e){return t=>{if(t[e])return t[e]}}var Cu=class Du extends Is{constructor(t,r,n){super(t,n),A(this,"crdt"),A(this,"defaultHeader",Du.defaultHeader),this.crdt=r}async _applyCarHeader(t){for(let[r,n]of Object.entries(t.indexes))Pi({_crdt:this.crdt},r,void 0,n)}makeCarHeader({indexes:t},r,n=!1){return n?{indexes:t,cars:[],compact:r}:{indexes:t,cars:r,compact:[]}}};A(Cu,"defaultHeader",{cars:[],compact:[],indexes:new Map});var H1=Cu,Nu=class Lu extends Is{constructor(t,r,n){super(t,n),A(this,"defaultHeader",Lu.defaultHeader),A(this,"clock"),A(this,"remoteFileStore"),A(this,"fileStore"),this.fileStore=new mu(this),this.clock=r}async loadFileCar(t,r=!1){return await this.storesLoadCar(t,this.fileStore,this.remoteFileStore,r)}async _applyCarHeader(t,r=!1){r?await this.clock.applyHead(null,t.head,this.clock.head):await this.clock.applyHead(null,t.head,[])}makeCarHeader(t,r,n=!1){if(Iu(t)){let i=[];for(let[,s]of Object.entries(t.files))i.push(s.cid);return{files:i}}else{let{head:i}=t;return n?{head:i,cars:[],compact:r}:{head:i,cars:r,compact:[]}}}};A(Nu,"defaultHeader",{cars:[],compact:[],head:[]});var q1=Nu;function Iu(e){return e&&e.files!==void 0}var Rn=class extends ot{constructor(e){super(),A(this,"parent"),this.parent=e}async get(e){return this.parent.get(e)}async superGet(e){return super.get(e)}},Ou=class{constructor(e,t,r){if(A(this,"ready"),A(this,"name",null),A(this,"loader",null),A(this,"opts",{}),A(this,"transactions",new Set),this.opts=r||this.opts,e){if(this.name=e,!t)throw new Error("missing loader");this.loader=t,this.ready=this.loader.ready}else this.ready=Promise.resolve()}async put(){throw new Error("use a transaction to put")}async get(e){if(!e)throw new Error("required cid");for(let t of this.transactions){let r=await t.superGet(e);if(r)return r}if(this.loader)return await this.loader.getBlock(e)}async commitCompaction(e,t){return this.transactions.clear(),this.transactions.add(e),await this.loader?.commit(e,{head:t},{compact:!0})}async*entries(){let e=new Set;for(let t of this.transactions)for await(let r of t.entries())e.has(r.cid.toString())||(e.add(r.cid.toString()),yield r)}async executeTransaction(e,t){let r=new Rn(this);this.transactions.add(r);let n=await e(r),{car:i,done:s}=await t(r,n);return i?{...s,car:i}:s}},V1=class extends Ou{constructor(e,t,r){e?super(e,new H1(e,t,r),r):super(null)}async transaction(e,t){return this.executeTransaction(e,async(r,n)=>(t.set(n.name,n),{car:await this.loader?.commit(r,{indexes:t}),done:n}))}},W1=class extends Ou{constructor(e,t,r){e?super(e,new q1(e,t,r),r):super(null)}async transaction(e,t,r={noLoader:!1}){return this.executeTransaction(e,async(n,i)=>({car:await this.loader?.commit(n,i,r),done:i}))}},G1=class{constructor(e){A(this,"blocks"),A(this,"loader",null),A(this,"cids",new Set),this.blocks=e,this.loader=e.loader}async get(e){return this.cids.add(e),await this.blocks.get(e)}},Pu=({name:e,code:t,encode:r})=>new K1(e,t,r),K1=class{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?rn(this.code,t):t.then(r=>rn(this.code,r))}else throw Error("Unknown type, must be binary type")}};function Ur({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*J1(e,t){if(t!=null&&typeof t=="object")if(Array.isArray(t))for(let[r,n]of t.entries()){let i=[...e,r],s=ie.asCID(n);s?yield[i.join("/"),s]:typeof n=="object"&&(yield*Mi(n,i))}else{let r=ie.asCID(t);r?yield[e.join("/"),r]:yield*Mi(t,e)}}function*Mi(e,t){if(e==null||e instanceof Uint8Array)return;let r=ie.asCID(e);r&&(yield[t.join("/"),r]);for(let[n,i]of Object.entries(e)){let s=[...t,n];yield*J1(s,i)}}function*Q1(e,t){if(Array.isArray(t))for(let[r,n]of t.entries()){let i=[...e,r];yield i.join("/"),typeof n=="object"&&!ie.asCID(n)&&(yield*Ui(n,i))}else yield*Ui(t,e)}function*Ui(e,t){if(!(e==null||typeof e!="object"))for(let[r,n]of Object.entries(e)){let i=[...t,r];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!ie.asCID(n)&&(yield*Q1(i,n))}}function X1(e,t){let r=e;for(let[n,i]of t.entries()){if(r=r[i],r==null)throw new Error(`Object has no property at ${t.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);let s=ie.asCID(r);if(s)return{value:s,remaining:t.slice(n+1).join("/")}}return{value:r}}var Gt=class{constructor({cid:e,bytes:t,value:r}){if(!e||!t||typeof r>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:Ur(),bytes:Ur(),value:Ur(),asBlock:Ur()})}links(){return Mi(this.value,[])}tree(){return Ui(this.value,[])}get(e="/"){return X1(this.value,e.split("/").filter(Boolean))}};async function Mu({value:e,codec:t,hasher:r}){if(typeof e>"u")throw new Error('Missing required argument "value"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");let n=t.encode(e),i=await r.digest(n),s=ie.create(1,t.code,i);return new Gt({value:e,bytes:n,cid:s})}async function Uu({bytes:e,codec:t,hasher:r}){if(!e)throw new Error('Missing required argument "bytes"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");let n=t.decode(e),i=await r.digest(e),s=ie.create(1,t.code,i);return new Gt({value:n,bytes:e,cid:s})}var zu={};Z(zu,{sha256:()=>Kt,sha512:()=>Y1});var ju=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Kt=Pu({name:"sha2-256",code:18,encode:ju("SHA-256")}),Y1=Pu({name:"sha2-512",code:19,encode:ju("SHA-512")});async function zi(e,t,r){let n=new Jt(e),i=new Map(t.map(o=>[o.toString(),o]));if(i.has(r.toString()))return t;let s=!1;for(let o of t)await ga(n,r,o)&&(i.delete(o.toString()),i.set(r.toString(),r),s=!0);if(s)return[...i.values()];for(let o of t)if(await ga(n,o,r))return t;return t.concat(r)}var wa=class extends Gt{constructor({cid:e,value:t,bytes:r,prefix:n}){super({cid:e,value:t,bytes:r}),this.prefix=n}static create(e,t){return Z1({data:e,parents:t??[]})}},Jt=class{constructor(e){this._blocks=e}async get(e){let t=await this._blocks.get(e);if(!t)throw new Error(`missing block: ${e}`);return eb(t.bytes)}};async function Z1(e){let{cid:t,bytes:r}=await Mu({value:e,codec:ce,hasher:Kt});return new Gt({cid:t,value:e,bytes:r})}async function eb(e){let{cid:t,value:r}=await Uu({bytes:e,codec:ce,hasher:Kt});return new Gt({cid:t,value:r,bytes:e})}async function ga(e,t,r){if(t.toString()===r.toString())return!0;let[{value:n},{value:i}]=await Promise.all([e.get(t),e.get(r)]),s=[...n.parents],o=new Set;for(;s.length;){let a=s.shift();if(!a)break;if(a.toString()===r.toString())return!0;if(i.parents.some(u=>a.toString()===u.toString())||o.has(a.toString()))continue;o.add(a.toString());let{value:l}=await e.get(a);s.push(...l.parents)}return!1}async function*$u(e,t,r={}){let n=r.renderNodeLabel??(l=>tb(l.cid)),i=new Jt(e);yield"digraph clock {",yield'  node [shape=point fontname="Courier"]; head;';let s=await Promise.all(t.map(l=>i.get(l))),o=[],a=new Set;for(let l of s){a.add(l.cid.toString()),yield`  node [shape=oval fontname="Courier"]; ${l.cid} [label="${n(l)}"];`,yield`  head -> ${l.cid};`;for(let u of l.value.parents)yield`  ${l.cid} -> ${u};`;o.push(...l.value.parents)}for(;o.length;){let l=o.shift();if(!l)break;if(a.has(l.toString()))continue;a.add(l.toString());let u=await i.get(l);yield`  node [shape=oval]; ${l} [label="${n(u)}" fontname="Courier"];`;for(let c of u.value.parents)yield`  ${l} -> ${c};`;o.push(...u.value.parents)}yield"}"}var tb=e=>`${String(e).slice(0,4)}..${String(e).slice(-4)}`,Ps=class extends Gt{constructor({cid:e,value:t,bytes:r,prefix:n}){super({cid:e,value:t,bytes:r}),this.prefix=n}static create(){return Pe([])}};async function Pe(e,t){let{cid:r,bytes:n}=await Mu({value:e,codec:ce,hasher:Kt});return new Ps({cid:r,value:e,bytes:n,prefix:t??""})}async function rb(e,t){let{cid:r,value:n}=await Uu({bytes:e,codec:ce,hasher:Kt});if(!Array.isArray(n))throw new Error(`invalid shard: ${r}`);return new Ps({cid:r,value:n,bytes:e,prefix:t??""})}var Hn=class{constructor(e){this._blocks=e}async get(e,t=""){let r=await this._blocks.get(e);if(!r)throw new Error(`missing block: ${e}`);return rb(r.bytes,t)}};function ba(e,t){if(!e.length)return[t];let r=[];for(let[n,[i,s]]of e.entries()){if(t[0]===i){if(Array.isArray(t[1]))Array.isArray(s)&&s[1]!=null&&t[1][1]==null?r.push([i,[t[1][0],s[1]]]):r.push(t);else{let o=Array.isArray(s)?[i,[s[0],t[1]]]:t;r.push(o)}for(let o=n+1;o<e.length;o++)r.push(e[o]);return r}if(n===0&&t[0]<i){r.push(t);for(let o=n;o<e.length;o++)r.push(e[o]);return r}if(n>0&&t[0]>e[n-1][0]&&t[0]<i){r.push(t);for(let o=n;o<e.length;o++)r.push(e[o]);return r}r.push([i,s])}return r.push(t),r}function nb(e,t){let r=e.findIndex(([s])=>t===s);if(r===-1)throw new Error(`key not found in shard: ${t}`);let n=r,i;for(;;){if(i=e[n][0].slice(0,-1),i.length)for(;;){let s=e.filter(o=>o[0].startsWith(i));if(s.length>1)return{prefix:i,matches:s};if(i=i.slice(0,-1),!i.length)break}if(n++,n>=e.length&&(n=0),n===r)return}}var zr=64,ib=512*1024;async function Wr(e,t,r,n,i={}){let s=new Hn(e),o=await s.get(t),a=await qn(s,o,r),l=a[a.length-1],u=r.slice(l.prefix.length),c=[u,n],f=[];if(u.length>zr){let y=Array.from(Array(Math.ceil(u.length/zr)),(p,g)=>{let m=g*zr;return{prefix:l.prefix+u.slice(0,m),skey:u.slice(m,m+zr)}}),h=await Pe([[y[y.length-1].skey,n]],y[y.length-1].prefix);f.push(h);for(let p=y.length-2;p>0;p--)h=await Pe([[y[p].skey,[h.cid]]],y[p].prefix),f.push(h);c=[y[0].skey,[h.cid]]}let w=ba(l.value,c),d=await Pe(w,l.prefix);if(d.bytes.length>(i.maxShardSize??ib)){let y=nb(w,c[0]);if(!y)throw new Error("shard limit reached");let{prefix:h,matches:p}=y,g=await Pe(p.filter(([k])=>k!==h).map(([k,S])=>[k.slice(h.length),S]),l.prefix+h);f.push(g);let m,b=p.find(([k])=>k===h);if(b){if(Array.isArray(b[1]))throw new Error(`expected "${h}" to be a shard value but found a shard link`);m=[g.cid,b[1]]}else m=[g.cid];w=w.filter(k=>p.every(S=>k[0]!==S[0])),w=ba(w,[h,m]),d=await Pe(w,l.prefix)}f.push(d);for(let y=a.length-2;y>=0;y--){let h=a[y],p=d.prefix.slice(h.prefix.length),g=h.value.map(m=>{let[b,k]=m;if(b!==p)return m;if(!Array.isArray(k))throw new Error(`"${p}" is not a shard link in: ${h.cid}`);return k[1]==null?[b,[d.cid]]:[b,[d.cid,k[1]]]});d=await Pe(g,h.prefix),f.push(d)}return{root:f[f.length-1].cid,additions:f,removals:a}}async function sb(e,t,r){let n=new Hn(e),i=await n.get(t),s=await qn(n,i,r),o=s[s.length-1],a=r.slice(o.prefix.length),l=o.value.find(([u])=>u===a);if(l)return Array.isArray(l[1])?l[1][1]:l[1]}async function Ru(e,t,r){let n=new Hn(e),i=await n.get(t),s=await qn(n,i,r),o=s[s.length-1],a=r.slice(o.prefix.length),l=o.value.findIndex(([y])=>y===a);if(l===-1)return{root:t,additions:[],removals:[]};let u=o.value[l];if(Array.isArray(u[1])&&u[1][1]==null)return{root:t,additions:[],removals:[]};let c=[],f=[...s],w=[...o.value];if(Array.isArray(u[1]))w[l]=[u[0],[u[1][0]]];else for(w.splice(l,1);!w.length;){let y=s[s.length-1],h=s[s.length-2];if(!h)break;s.pop(),w=h.value.filter(p=>Array.isArray(p[1])?p[1][0].toString()!==y.cid.toString():!0)}let d=await Pe(w,s[s.length-1].prefix);c.push(d);for(let y=s.length-2;y>=0;y--){let h=s[y],p=d.prefix.slice(h.prefix.length),g=h.value.map(m=>{let[b,k]=m;if(b!==p)return m;if(!Array.isArray(k))throw new Error(`"${p}" is not a shard link in: ${h.cid}`);return k[1]==null?[b,[d.cid]]:[b,[d.cid,k[1]]]});d=await Pe(g,h.prefix),c.push(d)}return{root:c[c.length-1].cid,additions:c,removals:f}}async function*ob(e,t,r={}){let{prefix:n}=r,i=new Hn(e),s=await i.get(t);yield*async function*o(a){for(let l of a.value){let u=a.prefix+l[0];if(Array.isArray(l[1])){if(l[1][1]&&(!n||n&&u.startsWith(n))&&(yield[u,l[1][1]]),n&&(n.length<=u.length&&!u.startsWith(n)||n.length>u.length&&!n.startsWith(u)))continue;yield*o(await i.get(l[1][0],u))}else{if(n&&!u.startsWith(n))continue;yield[u,l[1]]}}}(s)}async function qn(e,t,r){for(let[n,i]of t.value){if(r===n)return[t];if(r.startsWith(n)&&Array.isArray(i)){let s=await qn(e,await e.get(i[0],t.prefix+n),r.slice(n.length));return[t,...s]}}return[t]}async function ab(e,t,r,n,i){let s=new ot;if(e=new Bn(s,e),!t.length){let g=await Ps.create();s.putSync(g.cid,g.bytes);let m=await Wr(e,g.cid,r,n,i),b={type:"put",root:m.root,key:r,value:n},k=await wa.create(b,t);return t=await zi(e,t,k.cid),{root:m.root,additions:[g,...m.additions],removals:m.removals,head:t,event:k}}let o=new Jt(e),a=await Ms(o,t);if(!a)throw new Error("failed to find common ancestor event");let l=await o.get(a),{root:u}=l.value.data,c=await qu(o,t,a),f=new Map,w=new Map;for(let{value:g}of c){if(!["put","del"].includes(g.data.type))throw new Error(`unknown event type: ${g.data.type}`);let m=g.data.type==="put"?await Wr(e,u,g.data.key,g.data.value):await Ru(e,u,g.data.key);u=m.root;for(let b of m.additions)s.putSync(b.cid,b.bytes),f.set(b.cid.toString(),b);for(let b of m.removals)w.set(b.cid.toString(),b)}let d=await Wr(e,u,r,n,i);for(let g of d.additions)s.putSync(g.cid,g.bytes),f.set(g.cid.toString(),g);for(let g of d.removals)w.set(g.cid.toString(),g);let y={type:"put",root:d.root,key:r,value:n},h=await wa.create(y,t);s.putSync(h.cid,h.bytes),t=await zi(e,t,h.cid);let p=d.root.toString();for(let g of w.keys())f.has(g)&&g!==p&&(f.delete(g),w.delete(g));return{root:d.root,additions:[...f.values()],removals:[...w.values()],head:t,event:h}}async function Vn(e,t){if(!t.length)throw new Error("cannot determine root of headless clock");let r=new ot;e=new Bn(r,e);let n=new Jt(e);if(t.length===1){let f=await n.get(t[0]),{root:w}=f.value.data;return{root:w,additions:[],removals:[]}}let i=await Ms(n,t);if(!i)throw new Error("failed to find common ancestor event");let s=await n.get(i),{root:o}=s.value.data,a=await qu(n,t,i),l=new Map,u=new Map;for(let{value:f}of a){if(!["put","del"].includes(f.data.type))throw new Error(`unknown event type: ${f.data.type}`);let w=f.data.type==="put"?await Wr(e,o,f.data.key,f.data.value):await Ru(e,o,f.data.key);o=w.root;for(let d of w.additions)r.putSync(d.cid,d.bytes),l.set(d.cid.toString(),d);for(let d of w.removals)u.set(d.cid.toString(),d)}let c=o.toString();for(let f of u.keys())l.has(f)&&f!==c&&(l.delete(f),u.delete(f));return{root:o,additions:[...l.values()],removals:[...u.values()]}}async function lb(e,t,r){if(!t.length)return;let n=await Vn(e,t);return n.additions.length&&(e=new Bn(new ot(n.additions),e)),sb(e,n.root,r)}async function*Hu(e,t,r){if(!t.length)return;let n=await Vn(e,t);n.additions.length&&(e=new Bn(new ot(n.additions),e)),yield*ob(e,n.root,r)}async function Ms(e,t){if(!t.length)return;let r=t.map(n=>[n]);for(;;){let n=!1;for(let i of r){let s=await ub(e,i[i.length-1]);if(!s)continue;n=!0,i.push(s);let o=cb(r);if(o)return o}if(!n)return}}async function ub(e,t){let{value:r}=await e.get(t);return r.parents.length?r.parents.length===1?r.parents[0]:Ms(e,r.parents):t}function cb(e){e=e.map(t=>[...t]);for(let t of e)for(let r of t){let n=!0;for(let i of e)if(t!==i&&(n=i.some(s=>String(s)===String(r)),!n))break;if(n)return r}}async function qu(e,t,r){if(t.length===1&&String(t[0])===String(r))return[];let n=new Map,i=await Promise.all(t.map(o=>Vu(e,o,r)));for(let o of i)for(let{event:a,depth:l}of o){let u=n.get(a.cid.toString());u?u.weight+=l:n.set(a.cid.toString(),{event:a,weight:l})}let s=new Map;for(let{event:o,weight:a}of n.values()){let l=s.get(a);l?l.push(o):s.set(a,[o])}return Array.from(s).sort((o,a)=>a[0]-o[0]).flatMap(([,o])=>o.sort((a,l)=>String(a.cid)<String(l.cid)?-1:1))}async function Vu(e,t,r,n=0){let i=await e.get(t),s=[{event:i,depth:n}],{parents:o}=i.value;if(o.length===1&&String(o[0])===String(r))return s;let a=await Promise.all(o.map(l=>Vu(e,l,r,n+1)));return s.concat(...a)}var Wu={};Z(Wu,{DEFAULT_DIRECTORY_MODE:()=>Yu,DEFAULT_FILE_MODE:()=>Xu,NodeType:()=>$,code:()=>Rs,createAdvancedFile:()=>Tb,createComplexFile:()=>Db,createDirectoryShard:()=>Nb,createEmptyFile:()=>Fb,createFileChunk:()=>Bb,createFileShard:()=>Cb,createFlatDirectory:()=>Hs,createRaw:()=>ec,createShardedDirectory:()=>rc,createSimpleFile:()=>tc,createSymlink:()=>ac,cumulativeContentByteLength:()=>Me,cumulativeDagByteLength:()=>Js,decode:()=>Ob,decodeMetadata:()=>bt,encode:()=>Ib,encodeAdvancedFile:()=>qs,encodeComplexFile:()=>Vs,encodeDirectory:()=>Ws,encodeDirectoryMetadata:()=>Qs,encodeFile:()=>ic,encodeFileChunk:()=>sc,encodeFileShard:()=>Lb,encodeHAMTShard:()=>oc,encodeLink:()=>Wn,encodeMetadata:()=>Br,encodeMode:()=>cc,encodeRaw:()=>nc,encodeSimpleFile:()=>Gn,encodeSymlink:()=>lc,filesize:()=>zb,matchFile:()=>Ub,name:()=>Zu});var hb=new TextDecoder;function Us(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");let i=e[t++];if(r+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[r,t]}function wn(e,t){let r;[r,t]=Us(e,t);let n=t+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function Gu(e,t){let r;return[r,t]=Us(e,t),[r&7,r>>3,t]}function fb(e){let t={},r=e.length,n=0;for(;n<r;){let i,s;if([i,s,n]=Gu(e,n),s===1){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(t.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=wn(e,n)}else if(s===2){if(t.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=wn(e,n),t.Name=hb.decode(o)}else if(s===3){if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[t.Tsize,n]=Us(e,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return t}function db(e){let t=e.length,r=0,n,i=!1,s;for(;r<t;){let a,l;if([a,l,r]=Gu(e,r),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(l===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,r]=wn(e,r),n&&(i=!0)}else if(l===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let u;[u,r]=wn(e,r),n.push(fb(u))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${l}`)}if(r>t)throw new Error("protobuf: (PBNode) unexpected end of data");let o={};return s&&(o.Data=s),o.Links=n||[],o}var Ku=new TextEncoder,ma=2**32,pb=2**31;function yb(e,t){let r=t.length;if(typeof e.Tsize=="number"){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");r=ir(t,r,e.Tsize)-1,t[r]=24}if(typeof e.Name=="string"){let n=Ku.encode(e.Name);r-=n.length,t.set(n,r),r=ir(t,r,n.length)-1,t[r]=18}return e.Hash&&(r-=e.Hash.length,t.set(e.Hash,r),r=ir(t,r,e.Hash.length)-1,t[r]=10),t.length-r}function wb(e){let t=bb(e),r=new Uint8Array(t),n=t;if(e.Data&&(n-=e.Data.length,r.set(e.Data,n),n=ir(r,n,e.Data.length)-1,r[n]=10),e.Links)for(let i=e.Links.length-1;i>=0;i--){let s=yb(e.Links[i],r.subarray(0,n));n-=s,n=ir(r,n,s)-1,r[n]=18}return r}function gb(e){let t=0;if(e.Hash){let r=e.Hash.length;t+=1+r+It(r)}if(typeof e.Name=="string"){let r=Ku.encode(e.Name).length;t+=1+r+It(r)}return typeof e.Tsize=="number"&&(t+=1+It(e.Tsize)),t}function bb(e){let t=0;if(e.Data){let r=e.Data.length;t+=1+r+It(r)}if(e.Links)for(let r of e.Links){let n=gb(r);t+=1+n+It(n)}return t}function ir(e,t,r){t-=It(r);let n=t;for(;r>=pb;)e[t++]=r&127|128,r/=128;for(;r>=128;)e[t++]=r&127|128,r>>>=7;return e[t]=r,n}function It(e){return e%2===0&&e++,Math.floor((mb(e)+6)/7)}function mb(e){let t=0;return e>=ma&&(e=Math.floor(e/ma),t=32),e>=65536&&(e>>>=16,t+=16),e>=256&&(e>>>=8,t+=8),t+vb[e]}var vb=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],kb=["Data","Links"],Eb=["Hash","Name","Tsize"],ji=new TextEncoder;function Ju(e,t){if(e===t)return 0;let r=e.Name?ji.encode(e.Name):[],n=t.Name?ji.encode(t.Name):[],i=r.length,s=n.length;for(let o=0,a=Math.min(i,s);o<a;++o)if(r[o]!==n[o]){i=r[o],s=n[o];break}return i<s?-1:s<i?1:0}function va(e,t){return!Object.keys(e).some(r=>!t.includes(r))}function xb(e){if(typeof e.asCID=="object"){let r=ie.asCID(e);if(!r)throw new TypeError("Invalid DAG-PB form");return{Hash:r}}if(typeof e!="object"||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");let t={};if(e.Hash){let r=ie.asCID(e.Hash);try{r||(typeof e.Hash=="string"?r=ie.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=ie.decode(e.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}r&&(t.Hash=r)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return typeof e.Name=="string"&&(t.Name=e.Name),typeof e.Tsize=="number"&&(t.Tsize=e.Tsize),t}function Sb(e){if((e instanceof Uint8Array||typeof e=="string")&&(e={Data:e}),typeof e!="object"||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");let t={};if(e.Data!==void 0)if(typeof e.Data=="string")t.Data=ji.encode(e.Data);else if(e.Data instanceof Uint8Array)t.Data=e.Data;else throw new TypeError("Invalid DAG-PB form");if(e.Links!==void 0)if(Array.isArray(e.Links))t.Links=e.Links.map(xb),t.Links.sort(Ju);else throw new TypeError("Invalid DAG-PB form");else t.Links=[];return t}function Ab(e){if(!e||typeof e!="object"||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw new TypeError("Invalid DAG-PB form");if(!va(e,kb))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(e.Data!==void 0&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<e.Links.length;t++){let r=e.Links[t];if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!va(r,Eb))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(r.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(r.Hash==null||!r.Hash["/"]||r.Hash["/"]!==r.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(r.Name!==void 0&&typeof r.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(r.Tsize!==void 0){if(typeof r.Tsize!="number"||r.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(r.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&Ju(r,e.Links[t-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}var zs=112;function _b(e){Ab(e);let t={};return e.Links&&(t.Links=e.Links.map(r=>{let n={};return r.Hash&&(n.Hash=r.Hash.bytes),r.Name!==void 0&&(n.Name=r.Name),r.Tsize!==void 0&&(n.Tsize=r.Tsize),n})),e.Data&&(t.Data=e.Data),wb(t)}function _r(e){let t=db(e),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map(n=>{let i={};try{i.Hash=ie.decode(n.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(i.Name=n.Name),n.Tsize!==void 0&&(i.Tsize=n.Tsize),i})),r}var Xe=J(Nf(),1),Ut=Xe.default.Reader,js=Xe.default.Writer,P=Xe.default.util,te=Xe.default.roots.unixfs||(Xe.default.roots.unixfs={}),gn=te.Data=(()=>{function e(t){if(this.blocksizes=[],t)for(var r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.Type=0,e.prototype.Data=P.newBuffer([]),e.prototype.filesize=P.Long?P.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=P.emptyArray,e.prototype.hashType=P.Long?P.Long.fromBits(0,0,!0):0,e.prototype.fanout=P.Long?P.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(t,r){if(r||(r=js.create()),r.uint32(8).int32(t.Type),t.Data!=null&&Object.hasOwnProperty.call(t,"Data")&&r.uint32(18).bytes(t.Data),t.filesize!=null&&Object.hasOwnProperty.call(t,"filesize")&&r.uint32(24).uint64(t.filesize),t.blocksizes!=null&&t.blocksizes.length)for(var n=0;n<t.blocksizes.length;++n)r.uint32(32).uint64(t.blocksizes[n]);return t.hashType!=null&&Object.hasOwnProperty.call(t,"hashType")&&r.uint32(40).uint64(t.hashType),t.fanout!=null&&Object.hasOwnProperty.call(t,"fanout")&&r.uint32(48).uint64(t.fanout),t.mode!=null&&Object.hasOwnProperty.call(t,"mode")&&r.uint32(56).uint32(t.mode),t.mtime!=null&&Object.hasOwnProperty.call(t,"mtime")&&te.UnixTime.encode(t.mtime,r.uint32(66).fork()).ldelim(),r},e.decode=function(t,r){t instanceof Ut||(t=Ut.create(t));for(var n=r===void 0?t.len:t.pos+r,i=new te.Data;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.Type=t.int32();break;case 2:i.Data=t.bytes();break;case 3:i.filesize=t.uint64();break;case 4:if(i.blocksizes&&i.blocksizes.length||(i.blocksizes=[]),(s&7)===2)for(var o=t.uint32()+t.pos;t.pos<o;)i.blocksizes.push(t.uint64());else i.blocksizes.push(t.uint64());break;case 5:i.hashType=t.uint64();break;case 6:i.fanout=t.uint64();break;case 7:i.mode=t.uint32();break;case 8:i.mtime=te.UnixTime.decode(t,t.uint32());break;default:t.skipType(s&7);break}}if(!i.hasOwnProperty("Type"))throw P.ProtocolError("missing required 'Type'",{instance:i});return i},e.fromObject=function(t){if(t instanceof te.Data)return t;var r=new te.Data;switch(t.Type){case"Raw":case 0:r.Type=0;break;case"Directory":case 1:r.Type=1;break;case"File":case 2:r.Type=2;break;case"Metadata":case 3:r.Type=3;break;case"Symlink":case 4:r.Type=4;break;case"HAMTShard":case 5:r.Type=5;break}if(t.Data!=null&&(typeof t.Data=="string"?P.base64.decode(t.Data,r.Data=P.newBuffer(P.base64.length(t.Data)),0):t.Data.length&&(r.Data=t.Data)),t.filesize!=null&&(P.Long?(r.filesize=P.Long.fromValue(t.filesize)).unsigned=!0:typeof t.filesize=="string"?r.filesize=parseInt(t.filesize,10):typeof t.filesize=="number"?r.filesize=t.filesize:typeof t.filesize=="object"&&(r.filesize=new P.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0))),t.blocksizes){if(!Array.isArray(t.blocksizes))throw TypeError(".Data.blocksizes: array expected");r.blocksizes=[];for(var n=0;n<t.blocksizes.length;++n)P.Long?(r.blocksizes[n]=P.Long.fromValue(t.blocksizes[n])).unsigned=!0:typeof t.blocksizes[n]=="string"?r.blocksizes[n]=parseInt(t.blocksizes[n],10):typeof t.blocksizes[n]=="number"?r.blocksizes[n]=t.blocksizes[n]:typeof t.blocksizes[n]=="object"&&(r.blocksizes[n]=new P.LongBits(t.blocksizes[n].low>>>0,t.blocksizes[n].high>>>0).toNumber(!0))}if(t.hashType!=null&&(P.Long?(r.hashType=P.Long.fromValue(t.hashType)).unsigned=!0:typeof t.hashType=="string"?r.hashType=parseInt(t.hashType,10):typeof t.hashType=="number"?r.hashType=t.hashType:typeof t.hashType=="object"&&(r.hashType=new P.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0))),t.fanout!=null&&(P.Long?(r.fanout=P.Long.fromValue(t.fanout)).unsigned=!0:typeof t.fanout=="string"?r.fanout=parseInt(t.fanout,10):typeof t.fanout=="number"?r.fanout=t.fanout:typeof t.fanout=="object"&&(r.fanout=new P.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0))),t.mode!=null&&(r.mode=t.mode>>>0),t.mtime!=null){if(typeof t.mtime!="object")throw TypeError(".Data.mtime: object expected");r.mtime=te.UnixTime.fromObject(t.mtime)}return r},e.toObject=function(t,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.blocksizes=[]),r.defaults){if(n.Type=r.enums===String?"Raw":0,r.bytes===String?n.Data="":(n.Data=[],r.bytes!==Array&&(n.Data=P.newBuffer(n.Data))),P.Long){var i=new P.Long(0,0,!0);n.filesize=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else n.filesize=r.longs===String?"0":0;if(P.Long){var i=new P.Long(0,0,!0);n.hashType=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else n.hashType=r.longs===String?"0":0;if(P.Long){var i=new P.Long(0,0,!0);n.fanout=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else n.fanout=r.longs===String?"0":0;n.mode=0,n.mtime=null}if(t.Type!=null&&t.hasOwnProperty("Type")&&(n.Type=r.enums===String?te.Data.DataType[t.Type]:t.Type),t.Data!=null&&t.hasOwnProperty("Data")&&(n.Data=r.bytes===String?P.base64.encode(t.Data,0,t.Data.length):r.bytes===Array?Array.prototype.slice.call(t.Data):t.Data),t.filesize!=null&&t.hasOwnProperty("filesize")&&(typeof t.filesize=="number"?n.filesize=r.longs===String?String(t.filesize):t.filesize:n.filesize=r.longs===String?P.Long.prototype.toString.call(t.filesize):r.longs===Number?new P.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0):t.filesize),t.blocksizes&&t.blocksizes.length){n.blocksizes=[];for(var s=0;s<t.blocksizes.length;++s)typeof t.blocksizes[s]=="number"?n.blocksizes[s]=r.longs===String?String(t.blocksizes[s]):t.blocksizes[s]:n.blocksizes[s]=r.longs===String?P.Long.prototype.toString.call(t.blocksizes[s]):r.longs===Number?new P.LongBits(t.blocksizes[s].low>>>0,t.blocksizes[s].high>>>0).toNumber(!0):t.blocksizes[s]}return t.hashType!=null&&t.hasOwnProperty("hashType")&&(typeof t.hashType=="number"?n.hashType=r.longs===String?String(t.hashType):t.hashType:n.hashType=r.longs===String?P.Long.prototype.toString.call(t.hashType):r.longs===Number?new P.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0):t.hashType),t.fanout!=null&&t.hasOwnProperty("fanout")&&(typeof t.fanout=="number"?n.fanout=r.longs===String?String(t.fanout):t.fanout:n.fanout=r.longs===String?P.Long.prototype.toString.call(t.fanout):r.longs===Number?new P.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0):t.fanout),t.mode!=null&&t.hasOwnProperty("mode")&&(n.mode=t.mode),t.mtime!=null&&t.hasOwnProperty("mtime")&&(n.mtime=te.UnixTime.toObject(t.mtime,r)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Xe.default.util.toJSONOptions)},e.DataType=function(){let t={},r=Object.create(t);return r[t[0]="Raw"]=0,r[t[1]="Directory"]=1,r[t[2]="File"]=2,r[t[3]="Metadata"]=3,r[t[4]="Symlink"]=4,r[t[5]="HAMTShard"]=5,r}(),e})(),Ik=te.UnixTime=(()=>{function e(t){if(t)for(var r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.Seconds=P.Long?P.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(t,r){return r||(r=js.create()),r.uint32(8).int64(t.Seconds),t.FractionalNanoseconds!=null&&Object.hasOwnProperty.call(t,"FractionalNanoseconds")&&r.uint32(21).fixed32(t.FractionalNanoseconds),r},e.decode=function(t,r){t instanceof Ut||(t=Ut.create(t));for(var n=r===void 0?t.len:t.pos+r,i=new te.UnixTime;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.Seconds=t.int64();break;case 2:i.FractionalNanoseconds=t.fixed32();break;default:t.skipType(s&7);break}}if(!i.hasOwnProperty("Seconds"))throw P.ProtocolError("missing required 'Seconds'",{instance:i});return i},e.fromObject=function(t){if(t instanceof te.UnixTime)return t;var r=new te.UnixTime;return t.Seconds!=null&&(P.Long?(r.Seconds=P.Long.fromValue(t.Seconds)).unsigned=!1:typeof t.Seconds=="string"?r.Seconds=parseInt(t.Seconds,10):typeof t.Seconds=="number"?r.Seconds=t.Seconds:typeof t.Seconds=="object"&&(r.Seconds=new P.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber())),t.FractionalNanoseconds!=null&&(r.FractionalNanoseconds=t.FractionalNanoseconds>>>0),r},e.toObject=function(t,r){r||(r={});var n={};if(r.defaults){if(P.Long){var i=new P.Long(0,0,!1);n.Seconds=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else n.Seconds=r.longs===String?"0":0;n.FractionalNanoseconds=0}return t.Seconds!=null&&t.hasOwnProperty("Seconds")&&(typeof t.Seconds=="number"?n.Seconds=r.longs===String?String(t.Seconds):t.Seconds:n.Seconds=r.longs===String?P.Long.prototype.toString.call(t.Seconds):r.longs===Number?new P.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber():t.Seconds),t.FractionalNanoseconds!=null&&t.hasOwnProperty("FractionalNanoseconds")&&(n.FractionalNanoseconds=t.FractionalNanoseconds),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Xe.default.util.toJSONOptions)},e})(),Ok=te.Metadata=(()=>{function e(t){if(t)for(var r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.MimeType="",e.encode=function(t,r){return r||(r=js.create()),t.MimeType!=null&&Object.hasOwnProperty.call(t,"MimeType")&&r.uint32(10).string(t.MimeType),r},e.decode=function(t,r){t instanceof Ut||(t=Ut.create(t));for(var n=r===void 0?t.len:t.pos+r,i=new te.Metadata;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:i.MimeType=t.string();break;default:t.skipType(s&7);break}}return i},e.fromObject=function(t){if(t instanceof te.Metadata)return t;var r=new te.Metadata;return t.MimeType!=null&&(r.MimeType=String(t.MimeType)),r},e.toObject=function(t,r){r||(r={});var n={};return r.defaults&&(n.MimeType=""),t.MimeType!=null&&t.hasOwnProperty("MimeType")&&(n.MimeType=t.MimeType),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Xe.default.util.toJSONOptions)},e})(),$=gn.DataType,Qu=Object.freeze([]),$s=new Uint8Array(0),pe=Object.freeze({}),Xu=parseInt("0644",8),Yu=parseInt("0755",8),Rs=zs,Zu="UnixFS",tt=(e,t)=>(Object(globalThis).debug&&console.log({data:e,links:t}),_b(Sb({Data:gn.encode(e).finish(),Links:t}))),ec=e=>({type:$.Raw,content:e}),Fb=e=>tc($s,e),tc=(e,t)=>({type:$.File,layout:"simple",content:e,metadata:bt(t)}),Bb=e=>({type:$.File,layout:"simple",content:e}),Tb=(e,t)=>({type:$.File,layout:"advanced",parts:e,metadata:bt(t)}),Cb=e=>({type:$.File,layout:"advanced",parts:e}),Db=(e,t,r)=>({type:$.File,layout:"complex",content:e,parts:t,metadata:bt(r)}),Hs=(e,t)=>({type:$.Directory,metadata:bt(t),entries:e}),rc=(e,t,r,n,i=pe)=>({type:$.HAMTShard,bitfield:t,fanout:Gs(r),hashType:Ks(n),entries:e,metadata:bt(i)}),Nb=(e,t,r,n)=>({type:$.HAMTShard,bitfield:t,fanout:Gs(r),hashType:Ks(n),entries:e}),nc=e=>tt({Type:$.Raw,Data:e.byteLength>0?e:void 0,filesize:e.byteLength,blocksizes:Qu},[]),ic=(e,t=!1)=>{let r=t?pe:Object(e).metadata;switch(e.layout){case"simple":return Gn(e.content,r);case"advanced":return qs(e.parts,r);case"complex":return Vs(e.content,e.parts,r);default:throw new TypeError(`File with unknown layout "${Object(e).layout}" was passed`)}},sc=e=>Gn(e,pe),Lb=e=>tt({Type:$.File,blocksizes:e.map(Fr),filesize:Me(e)},e.map(Wn)),qs=(e,t=pe)=>tt({Type:$.File,blocksizes:e.map(Fr),filesize:Me(e),...Br(t)},e.map(Wn)),Wn=e=>({Name:"",Tsize:e.dagByteLength,Hash:e.cid}),Gn=(e,t=pe)=>tt({Type:$.File,Data:e.byteLength>0?e:void 0,filesize:e.byteLength,blocksizes:[],...Br(t)},[]),Vs=(e,t,r=pe)=>tt({Type:$.File,Data:e,filesize:e.byteLength+Me(t),blocksizes:t.map(Fr)},t.map(Wn)),Ws=e=>tt({Type:e.type,...Qs(e.metadata||pe)},e.entries.map(uc)),oc=({bitfield:e,fanout:t,hashType:r,entries:n,metadata:i=pe})=>tt({Type:$.HAMTShard,Data:e.byteLength>0?e:void 0,fanout:Gs(t),hashType:Ks(r),...Qs(i)},n.map(uc)),Gs=e=>{if(Math.log2(e)%1===0)return e;throw new TypeError(`Expected hamt size to be a power of two instead got ${e}`)},Ks=e=>{if(Number.isInteger(e))return e;throw new TypeError(`Expected an integer value instead got ${e}`)},ac=(e,t=pe)=>({type:$.Symlink,content:e,metadata:bt(t)}),lc=(e,t=!1)=>{let r=t?pe:Object(e).metadata;return tt({Type:$.Symlink,Data:e.content,...Br(r||pe)},[])},Ib=(e,t=!0)=>{switch(e.type){case $.Raw:return nc(e.content);case $.File:return ic(e);case $.Directory:return Ws(e);case $.HAMTShard:return oc(e);case $.Symlink:return lc(e);default:throw new Error(`Unknown node type ${Object(e).type}`)}},Ob=e=>{let t=_r(e),r=gn.decode(t.Data),{Type:n,Data:i,mtime:s,mode:o,blocksizes:a,...l}=gn.toObject(r,{defaults:!1,arrays:!0,longs:Number,objects:!1}),u={...o&&{mode:o},...Pb(s)},c=t.Links;switch(r.Type){case $.Raw:return ec(i);case $.File:return c.length===0?new fc(i,u):i.byteLength===0?new dc(ka(l.blocksizes,c),u):new pc(i,ka(l.blocksizes,c),u);case $.Directory:return Hs(Ea(c),u);case $.HAMTShard:return rc(Ea(c),i||$s,l.fanout,l.hashType,u);case $.Symlink:return ac(i,u);default:throw new TypeError(`Unsupported node type ${r.Type}`)}},Pb=e=>e==null?void 0:{mtime:{secs:e.Seconds,nsecs:e.FractionalNanoseconds||0}},ka=(e,t)=>{let r=[],n=e.length,i=0;for(;i<n;)r.push({cid:t[i].Hash,dagByteLength:t[i].Tsize||0,contentByteLength:e[i]});return r},Ea=e=>e.map(t=>({cid:t.Hash,name:t.Name||"",dagByteLength:t.Tsize||0})),Me=e=>e.reduce((t,r)=>t+r.contentByteLength,0),Js=(e,t)=>t.reduce((r,n)=>r+n.dagByteLength,e.byteLength),Fr=e=>e.contentByteLength,uc=({name:e,dagByteLength:t,cid:r})=>({Name:e,Tsize:t,Hash:r}),Qs=e=>Br(e,Yu),Br=({mode:e,mtime:t},r=Xu)=>({mode:e!=null?cc(e,r):void 0,mtime:t!=null?Mb(t):void 0}),bt=e=>e==null?pe:{...e.mode==null?void 0:{mode:hc(e.mode)},...e.mtime==null?void 0:{mtime:e.mtime}},Mb=e=>e==null?void 0:e.nsecs!==0?{Seconds:e.secs,FractionalNanoseconds:e.nsecs}:{Seconds:e.secs},cc=(e,t)=>{let r=e==null?void 0:hc(e);return r===t||r==null?void 0:r},hc=e=>e&4095|e&4294963200,Ub=({content:e=$s,parts:t=Qu,metadata:r=pe,...n})=>t.length===0?new fc(e,r):e.byteLength===0?new dc(t,r):new pc(e,t,r),fc=class{constructor(e,t){this.content=e,this.metadata=t,this.layout="simple",this.type=$.File}get filesize(){return this.content.byteLength}encode(){return Gn(this.content,this.metadata)}},dc=class{constructor(e,t){this.parts=e,this.metadata=t}get layout(){return"advanced"}get type(){return $.File}get fileSize(){return Me(this.parts)}get blockSizes(){return this.parts.map(Fr)}encode(){return qs(this.parts,this.metadata)}},pc=class{constructor(e,t,r){this.content=e,this.parts=t,this.metadata=r}get layout(){return"complex"}get type(){return $.File}get fileSize(){return this.content.byteLength+Me(this.parts)}get blockSizes(){return this.parts.map(Fr)}encode(){return Vs(this.content,this.parts,this.metadata)}},zb=e=>{switch(e.type){case $.Raw:case $.Symlink:return e.content.byteLength;case $.File:switch(e.layout){case"simple":return e.content.byteLength;case"advanced":return Me(e.parts);case"complex":return e.content.byteLength+Me(e.parts)}default:return 0}},jb=function*(e){let t=yield*e;yield*Zs(t)};function*Xs(){return yield Kn}var fr=function*(){yield Jn},Ys=function*(e){let t=yield*Xs();if(Rb(e)){let r=!1,n;if(e.then(i=>{r=!1,n=i,Ye(t)},i=>{r=!0,n=i,Ye(t)}),yield*fr(),r)throw n;return n}else return Gb($b(t)),yield*fr(),e};function*$b(e){Ye(e)}var Rb=e=>e!=null&&typeof e.then=="function",Zs=function*(e){yield e},eo=function*(e){let t=[];for(let r of Object.entries(e)){let[n,i]=r;i!==pr&&t.push(yield*Xn(qb(i,n)))}yield*no(t)},to=e=>e.length>0?Hb(e.map(jb)):pr;function*Hb(e){let t=[];for(let r of e)t.push(yield*Xn(r));yield*no(t)}var qb=(e,t)=>e===pr?pr:e instanceof fi?new fi([...e.tags,t],e.source):new fi([t],e),fi=class{constructor(e,t){this.tags=e,this.source=t,this.controller}[Symbol.iterator](){return this.controller||(this.controller=this.source[Symbol.iterator]()),this}box(e){if(e.done)return e;switch(e.value){case Jn:case Kn:return e;default:{let t=e,{value:r}=t;for(let n of this.tags)r=Vb(n,r);return t.value=r,t}}}next(e){return this.box(this.controller.next(e))}throw(e){return this.box(this.controller.throw(e))}return(e){return this.box(this.controller.return(e))}get[Symbol.toStringTag](){return"TaggedEffect"}},bn=()=>pr,Vb=(e,t)=>({type:e,[e]:t}),Kn=Symbol("current"),Jn=Symbol("suspend"),st=class yc{static of(t){return t.group||Tt}static enqueue(t,r){t.group=r,r.stack.active.push(t)}constructor(t,r=[],n=new Set,i=new Qn(r,n)){this.driver=t,this.parent=yc.of(t),this.stack=i,this.id=++bc}},Wb=class{constructor(){this.status=dr,this.stack=new Qn,this.id=0}},Qn=class{constructor(e=[],t=new Set){this.active=e,this.idle=t}static size({active:e,idle:t}){return e.length+t.size}},Gb=e=>Ye(e[Symbol.iterator]()),Ye=e=>{let t=st.of(e);for(t.stack.active.push(e),t.stack.idle.delete(e);t.parent;){let{idle:r,active:n}=t.parent.stack;if(r.has(t.driver))r.delete(t.driver),n.push(t.driver);else break;t=t.parent}if(Tt.status===dr)for(Tt.status=mc;;)try{for(let r of ro(Tt));Tt.status=dr;break}catch{Tt.stack.active.shift()}},Kb=e=>Ye(e),ro=function*(e){let{active:t}=e.stack,r=t[0];for(e.stack.idle.delete(r);r;){let n=vc;e:for(;!n.done&&r===t[0];){let i=n.value;switch(i){case Jn:e.stack.idle.add(r);break e;case Kn:n=r.next(r);break;default:n=r.next(yield i);break}}t.shift(),r=t[0],e.stack.idle.delete(r)}},Xn=(e,t)=>new Yb(e,t),Jb=(e,t)=>wc(e,{ok:!0,value:t}),$i=(e,t)=>wc(e,{ok:!1,error:t});function*wc(e,t){try{let r=e,n=t.ok?r.return(t.value):r.throw(t.error);if(!n.done)if(n.value===Jn){let{idle:i}=st.of(r).stack;i.add(r)}else Ye(r)}catch{}}function*no(e){if(e.length===0)return;let t=yield*Xs(),r=new st(t),n=null;for(let i of e){let{result:s}=i;if(s){!s.ok&&!n&&(n=s);continue}Qb(i,r)}try{if(n)throw n.error;for(;yield*ro(r),Qn.size(r.stack)>0;)yield*fr()}catch(i){for(let s of r.stack.active)yield*$i(s,i);for(let s of r.stack.idle)yield*$i(s,i),Ye(s);throw i}}var Qb=(e,t)=>{let r=st.of(e);if(r!==t){let{active:n,idle:i}=r.stack,s=t.stack;if(e.group=t,i.has(e))i.delete(e),s.idle.add(e);else{let o=n.indexOf(e);o>=0&&(n.splice(o,1),s.active.push(e))}}};function*gc(e){e.status===dr&&(yield*e),e.result||(yield*no([e]));let t=e.result;if(t.ok)return t.value;throw t.error}var Xb=class{constructor(e){this.handler=e,this.result}get promise(){let{result:e}=this,t=e==null?new Promise((r,n)=>{this.handler.onsuccess=r,this.handler.onfailure=n}):e.ok?Promise.resolve(e.value):Promise.reject(e.error);return Object.defineProperty(this,"promise",{value:t}),t}then(e,t){return this.activate().promise.then(e,t)}catch(e){return this.activate().promise.catch(e)}finally(e){return this.activate().promise.finally(e)}activate(){return this}},Yb=class extends Xb{constructor(e,t=em,r={},n=vc){super(r),this.id=++bc,this.name=t.name||"",this.task=e,this.state=n,this.status=dr,this.result,this.handler=r,this.controller}*resume(){Kb(this)}join(){return gc(this)}abort(e){return $i(this,e)}exit(e){return Jb(this,e)}get[Symbol.toStringTag](){return"Fork"}*[Symbol.iterator](){return this.activate()}activate(){return this.controller=this.task[Symbol.iterator](),this.status=mc,Ye(this),this}panic(e){this.result={ok:!1,error:e},this.status=xa;let{handler:t}=this;throw t.onfailure&&t.onfailure(e),e}step(e){if(this.state=e,e.done){this.result={ok:!0,value:e.value},this.status=xa;let{handler:t}=this;t.onsuccess&&t.onsuccess(e.value)}return e}next(e){try{return this.step(this.controller.next(e))}catch(t){return this.panic(t)}}return(e){try{return this.step(this.controller.return(e))}catch(t){return this.panic(t)}}throw(e){try{return this.step(this.controller.throw(e))}catch(t){return this.panic(t)}}},Zb=function*(e,t){let r=yield*Xs(),n=new st(r);for(st.enqueue(e[Symbol.iterator](),n);;){for(let i of ro(n))st.enqueue(t(i)[Symbol.iterator](),n);if(Qn.size(n.stack)>0)yield*fr();else break}},bc=0,dr="idle",mc="active",xa="finished",vc={done:!1,value:Kn},em={},pr=function*(){}(),Tt=new Wb;function kc(){}Object.defineProperties(kc,{prototype:{value:new Proxy(Object.prototype,{get(e,t,r){return typeof t=="symbol"?Reflect.get(e,t,r):r.get(t)}})}});var Ec=()=>new io,Sa=(e,t=0,r=e.byteLength)=>{let n=[],i=t<0?e.byteLength-t:t,s=r<0?e.byteLength-r:r;if(i===0&&s>=e.byteLength)return e;if(i>s||i>e.byteLength||s<=0)return Ec();let o=0,a=0;for(let l of e.segments){let u=a+l.byteLength;if(o===0){if(s<=u){let c=l.subarray(i-a,s-a);n.push(c),o=c.byteLength;break}else if(i<u){let c=i===a?l:l.subarray(i-a);n.push(c),o=c.byteLength}}else if(s<=u){let c=s===u?l:l.subarray(0,s-a);n.push(c),o+=c.byteLength;break}else n.push(l),o+=l.byteLength;a=u}return new io(n,e.byteOffset+i,o)},tm=(e,t)=>t.byteLength>0?(e.segments.push(t),new io(e.segments,e.byteOffset,e.byteLength+t.byteLength)):e,rm=(e,t)=>{if(t<e.byteLength){let r=0;for(let n of e.segments){if(t<r+n.byteLength)return n[t-r];r+=n.byteLength}}},nm=(e,t,r)=>{let n=r;for(let i of e.segments)t.set(i,n),n+=i.byteLength;return t};function*im(e){for(let t of e.segments)yield*t}var io=class extends kc{constructor(e=[],t=0,r=0){super(),this.segments=e,this.byteLength=r,this.length=r,this.byteOffset=t}[Symbol.iterator](){return im(this)}slice(e,t){return Sa(this,e,t)}subarray(e,t){return Sa(this,e,t)}push(e){return tm(this,e)}get(e){return rm(this,e)}copyTo(e,t){return nm(this,e,t)}},so=e=>{throw new Error(e)},sm=(e,t,...r)=>so(String.raw(e,JSON.stringify(t),...r)),om=new Uint8Array(0),am=[],lm=e=>({config:e,buffer:Ec()}),um=(e,t)=>t.byteLength>0?xc(e.config,e.buffer.push(t),!1):{...e,chunks:am},cm=e=>xc(e.config,e.buffer,!0),xc=(e,t,r)=>{let n=e.chunker,i=[],s=0;for(let o of n.cut(n.context,t,r))if(o>0){let a=t.subarray(s,s+o);i.push(a),s+=o}return{config:e,chunks:i,buffer:t.subarray(s)}},hm=()=>({mutable:!0,needs:{},nodes:{},links:{},linked:Hi}),Sc=(e,t)=>{let r=Ot(t,{});for(let n of e){let{ready:i,has:s,wants:o}=Ac(n.children,r.links);o.length===0?r=Ot(r,{links:Ri(void 0,s),linked:[{id:n.id,links:i}]}):r=Ot(r,{needs:Ri(n.id,o),nodes:{[n.id]:{children:n.children,count:o.length}}})}return r},fm=(e,t,r)=>{let n=r.needs[e],i=r.nodes[n];if(i!=null)if(i.count===1){let{ready:s,has:o}=Ac(i.children,{...r.links,[e]:t});return Ot(r,{needs:{[e]:void 0},links:Ri(void 0,o),nodes:{[n]:void 0},linked:[{id:n,links:s}]})}else return Ot(r,{needs:{[e]:void 0},links:{[e]:t},nodes:{[n]:{...i,count:i.count-1}}});else return Ot(r,{links:{[e]:t}})},Ot=(e,{needs:t,nodes:r,links:n,linked:i})=>{let s=e.mutable?e:{...e},o=e.mutable?pm:void 0;return t&&(s.needs=di(e.needs,t,o)),r&&(s.nodes=di(e.nodes,r,o)),n&&(s.links=di(e.links,n,o)),s.linked=i?dm(e.linked||Hi,i,Hi):e.linked||[],s},Ri=(e,t)=>{let r={};for(let n of t)r[n]=e;return r},di=(e,t,r=e)=>{let n=e===r?{...e}:e;for(let i of Object.entries(t)){let[s,o]=i;o==null?delete n[s]:n[s]=o}return n},dm=(e,t,r=e)=>{if(e===r)return[...e,...t];for(let n of t)e.push(n);return e},Ac=(e,t)=>{let r=[],n=[],i=[];for(let s of e){let o=t[s];o?(r.push(s),i.push(o)):n.push(s)}return{has:r,wants:n,ready:i}},Hi=Object.freeze([]),pm=Object.freeze({}),ym=(e,t)=>{switch(e.type){case"write":return gm(t,e.bytes);case"link":return bm(t,e.link);case"block":return{state:t,effect:bn()};case"close":return mm(t);case"end":return{state:t,effect:bn()};default:return sm`File Writer got unknown message ${e}`}},wm=(e,t,r)=>({status:"open",metadata:t,config:r,writer:e,chunker:lm({chunker:r.chunker}),layout:r.fileLayout.open(),nodeQueue:hm()}),gm=(e,t)=>{if(e.status==="open"){let{chunks:r,...n}=um(e.chunker,t),{nodes:i,leaves:s,layout:o}=e.config.fileLayout.write(e.layout,r),{linked:a,...l}=Sc(i,e.nodeQueue),u=[..._c(s,e.config),...oo(a,e.config)];return{state:{...e,chunker:n,layout:o,nodeQueue:l},effect:eo({link:to(u)})}}else return so("Unable to perform write on closed file")},bm=(e,{id:t,link:r,block:n})=>{let{linked:i,...s}=fm(t,r,e.nodeQueue),o=oo(i,e.config),a=e.status==="closed"&&t===e.rootID?{...e,status:"linked",link:r,nodeQueue:s}:{...e,nodeQueue:s},l=e.status==="closed"&&t===e.rootID&&e.end?e.end.resume():bn();return{state:a,effect:eo({link:to(o),block:Em(e.writer,n),end:l})}},mm=e=>{if(e.status==="open"){let{chunks:t}=cm(e.chunker),{layout:r,...n}=e.config.fileLayout.write(e.layout,t),{root:i,...s}=e.config.fileLayout.close(r,e.metadata),[o,a]=Sm(i)?[[...n.nodes,...s.nodes],[...n.leaves,...s.leaves,i]]:[[...n.nodes,...s.nodes,i],[...n.leaves,...s.leaves]],{linked:l,...u}=Sc(o,e.nodeQueue),c=[..._c(a,e.config),...oo(l,e.config)],f=Xn(fr());return{state:{...e,chunker:null,layout:null,rootID:i.id,status:"closed",end:f,nodeQueue:u},effect:eo({link:to(c),end:gc(f)})}}else return{state:e,effect:bn()}},_c=(e,t)=>e.map(r=>vm(t,r,t.fileChunkEncoder)),vm=function*({hasher:e,linker:t},{id:r,content:n},i){let s=i.encode(n?xm(n):om),o=yield*Ys(e.digest(s)),a=t.createLink(i.code,o),l={cid:a,bytes:s},u={cid:a,contentByteLength:n?n.byteLength:0,dagByteLength:s.byteLength};return{id:r,block:l,link:u}},oo=(e,t)=>e.map(r=>km(t,r)),km=function*(e,{id:t,links:r},n){let i=e.fileEncoder.encode({type:$.File,layout:"advanced",parts:r,metadata:n}),s=yield*Ys(Promise.resolve(e.hasher.digest(i))),o=e.linker.createLink(e.fileEncoder.code,s),a={bytes:i,cid:o},l={cid:o,contentByteLength:Me(r),dagByteLength:Js(i,r)};return{id:t,block:a,link:l}},Em=function*(e,t){(e.desiredSize||0)<=0&&(yield*Ys(e.ready)),e.write(t)},xm=e=>e instanceof Uint8Array?e:e.copyTo(new Uint8Array(e.byteLength),0),Sm=e=>e.children==null,Fc={};Z(Fc,{context:()=>Am,cut:()=>Cc,name:()=>Bc,type:()=>_m,withMaxChunkSize:()=>Tc});var Bc="fixed",Am={maxChunkSize:262144},_m="Stateless",Tc=e=>({type:"Stateless",context:{maxChunkSize:e},name:Bc,cut:Cc}),Cc=({maxChunkSize:e},{byteLength:t},r)=>{let n=t/e|0,i=new Array(n).fill(e),s=r?t-n*e:0;return s>0&&i.push(s),i},qi=class{constructor(e,t,r){this.id=e,this.children=t,this.metadata=r}},Dc=e=>({open:()=>Bm({width:e}),write:Tm,close:Cm}),Fm={width:174},Bm=({width:e}=Fm)=>({width:e,head:null,leafIndex:[],nodeIndex:[],lastID:0}),Tm=(e,t)=>{if(t.length===0)return{layout:e,nodes:he,leaves:he};{let{lastID:r}=e,[n,i]=e.head?[null,(t.unshift(e.head),t)]:t.length===1&&e.leafIndex.length===0?[t[0],he]:[null,t];if(i.length===0)return{layout:{...e,head:n},nodes:he,leaves:he};{let s=[...e.leafIndex],o=[];for(let a of i){let l={id:++r,content:a};o.push(l),s.push(l.id)}return s.length>=e.width?Nc({...e,leafIndex:s,head:n,lastID:r},o):{layout:{...e,head:n,leafIndex:s,lastID:r},leaves:o,nodes:he}}}},Nc=(e,t=he,r=[],n=!1)=>{let{lastID:i}=e,s=e.nodeIndex.map(u=>[...u]),o=[...e.leafIndex],{width:a}=e;for(;o.length>=a||o.length>0&&n;){Aa(s,1);let u=new qi(++i,o.splice(0,a));s[0].push(u.id),r.push(u)}let l=0;for(;l<s.length;){let u=s[l];for(l++;u.length>=a||u.length>0&&n&&l<s.length;){let c=new qi(++i,u.splice(0,a));Aa(s,l+1),s[l].push(c.id),r.push(c)}}return{layout:{...e,lastID:i,leafIndex:o,nodeIndex:s},leaves:t,nodes:r}},Cm=(e,t)=>{let r=e;if(e.head)return{root:{id:1,content:e.head,metadata:t},leaves:he,nodes:he};if(e.leafIndex.length===0)return{root:{id:1,metadata:t},leaves:he,nodes:he};{let{nodes:n,layout:i}=Nc(r,he,[],!0),{nodeIndex:s}=i,o=s.length-1,a=s[o];if(a.length===1){let l=n[n.length-1];return n.length=n.length-1,{root:l,nodes:n,leaves:he}}else return{root:new qi(i.lastID+1,a,t),nodes:n,leaves:he}}},Aa=(e,t)=>{for(;e.length<t;)e.push([]);return e},he=[],Yn=()=>({chunker:Fc,fileChunkEncoder:_a,smallFileEncoder:_a,fileEncoder:Wu,fileLayout:Dc(174),hasher:Kt,linker:{createLink:ie.createV1}}),ao=e=>({...Yn(),...e}),_a={code:Rs,name:Zu,encode:sc},Lc=({writer:e,metadata:t={},settings:r=Yn()})=>new Lm(wm(e,t,ao(r))),Dm=async(e,t)=>(await Ic(e,Zs({type:"write",bytes:t})),e),Nm=async(e,{releaseLock:t=!1,closeWriter:r=!1}={})=>{await Ic(e,Zs({type:"close"}));let{state:n}=e;if(n.status==="linked")return r?await e.state.writer.close():t&&e.state.writer.releaseLock(),n.link;so(`Expected writer to be in 'linked' state after close, but it is in "${n.status}" instead`)},Ic=(e,t)=>Xn(Zb(t,r=>{let{state:n,effect:i}=ym(r,e.state);return e.state=n,i})),Lm=class{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.config}write(e){return Dm(this,e)}close(e){return Nm(this,e)}},Im=Yn,Om=({writer:e,settings:t=Im(),metadata:r={}})=>new Pc({writer:e,metadata:r,settings:t,entries:new Map,closed:!1}),Pm=(e,t,r,{overwrite:n=!1}={})=>{let i=lo(e.state);if(t.includes("/"))throw new Error(`Directory entry name "${t}" contains forbidden "/" character`);if(!n&&i.entries.has(t))throw new Error(`Directory already contains entry with name "${t}"`);return i.entries.set(t,r),e},Mm=(e,t)=>(lo(e.state).entries.delete(t),e),lo=e=>{if(e.closed)throw new Error("Can not change written directory, but you can .fork() and make changes to it");return e},Um=async(e,{closeWriter:t=!1,releaseLock:r=!1}={})=>{let{writer:n,settings:i,metadata:s}=lo(e.state);e.state.closed=!0;let o=[...Oc(e)],a=Hs(o,s),l=Ws(a),u=await i.hasher.digest(l),c=i.linker.createLink(Rs,u);return(n.desiredSize||0)<=0&&await n.ready,n.write({cid:c,bytes:l}),t?await n.close():r&&n.releaseLock(),{cid:c,dagByteLength:Js(l,o)}},Oc=function*({state:e}){for(let[t,{dagByteLength:r,cid:n}]of e.entries)yield{name:t,dagByteLength:r,cid:n}},zm=({state:e},{writer:t=e.writer,metadata:r=e.metadata,settings:n=e.settings}={})=>new Pc({writer:t,metadata:r,settings:n,entries:new Map(e.entries.entries()),closed:!1}),Pc=class{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.settings}links(){return Oc(this)}set(e,t,r){return Pm(this,e,t,r)}remove(e){return Mm(this,e)}fork(e){return zm(this,e)}close(e){return Um(this,e)}entries(){return this.state.entries.entries()}has(e){return this.state.entries.has(e)}get size(){return this.state.entries.size}},Mc={};Z(Mc,{API:()=>Uc,and:()=>Wm,bitCount:()=>uo,empty:()=>zc,from:()=>jm,fromBytes:()=>Jm,get:()=>Vm,or:()=>Gm,popcount:()=>jc,set:()=>$c,size:()=>$m,toBytes:()=>Km,unset:()=>qm});var Uc={},zc=(e=32)=>{if(e!==32)throw new Error(`Uint32 BitField does not support size: ${e}`);return 0},jm=(e,t)=>{let r=zc(t);for(let n of e)r=$c(r,n);return r},$m=e=>32,Rm=(e,t)=>e>>>t&31,Hm=(e,t)=>1<<Rm(e,t),jc=(e,t=31)=>uo(e&Hm(t,0)-1),$c=(e,t)=>e|1<<t,qm=(e,t)=>e&(255^1<<t),Vm=(e,t)=>(e>>t&1)!==0,uo=e=>{let t=e-(e>>1&1431655765),r=(t&858993459)+(t>>2&858993459);return(r+(r>>4)&252645135)*16843009>>24},Wm=(e,t)=>e&t,Gm=(e,t)=>e|t,Km=e=>Uint8Array.of(e>>24&255,e>>16&255,e>>8&255,e&255),Jm=e=>{if(e.length!==4)throw new Error(`Expected 4 bytes instead got ${e.length}`);return(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]},Qm=J(Za(),1),Xm=new TextEncoder,Ym=Qm.default.x64.hash126,Zm=({bitWidth:e=5,hash:t=Ym})=>{if(e>4*8)throw new RangeError(`Can not use bitWidth ${e} which exceeds the hashSize 4`);if(4*8>32)throw new RangeError("Can not use hashSize 4 as it can not be encoded in Uint32");let r=4294967295>>>32-e;return{at:(n,i)=>n>>>i*e&r,from:n=>t(Xm.encode(n)),size:Math.ceil(4*8/e)}},mn=class{constructor(e,t,r,n,i){this.edit=e,this.config=i,this.datamap=t,this.nodemap=r,this.children=n}get nodeArity(){return this.config.BitField.popcount(this.nodemap)}get dataArity(){return this.config.BitField.popcount(this.datamap)}empty(){return Zn(this.config)}lookup(e,t,r,n){return Hc(this,e,t,r,n)}associate(e,t,r,n,i,s){return fo(this,e,t,r,n,i,s)}dissociate(e,t,r,n,i){return Wc(this,e,t,r,n,i)}fork(e=null){return Tr(this,e)}entries(){return Gc(this)}keys(){return Kc(this)}values(){return Jc(this)}},Rc=class{constructor(e,t,r,n){this.edit=e,this.count=t,this.children=r,this.config=n}get nodeArity(){return 0}get dataArity(){return this.count}lookup(e,t,r,n){return e0(this,r,n)}associate(e,t,r,n,i,s){return t0(this,e,r,n,i,s)}dissociate(e,t,r,n,i){return r0(this,e,r,n,i)}fork(e=null){return n0(this,e)}entries(){return Gc(this)}keys(){return Kc(this)}values(){return Jc(this)}},e0=(e,t,r)=>{let{children:n,count:i}=e,s=co(n,i,t);return n[s]===t?n[s+1]:r},t0=(e,t,r,n,i,s)=>{let{children:o,count:a}=e,l=co(o,a,n);if(o[l]!==n){let u=e.fork(t);return s.value=!0,u.count+=1,u.children.splice(l,r,i),u}else if(o[l+1]!==i){let u=e.fork(t);return u.children[l+1]=i,u}else return e},r0=(e,t,r,n,i)=>{let{children:s,count:o,config:a}=e,l=co(s,o,n);if(s[l]!==n)return e;if(i.value=!0,o===2){let u=l===0?2:0;return fo(Zn(a),t,0,r,s[u],s[u+1],i)}else{let u=e.fork(t);return u.children.splice(l,2),u.count-=1,u}},n0=(e,t=null)=>Zc(e.edit,t)?e:new Rc(t,e.count,e.children.slice(),e.config),co=(e,t,r)=>{let n=0;for(;n<t&&e[n]>r;)n+=2;return n},Zn=(e,t=null)=>new mn(t,e.BitField.empty(Math.pow(2,e.bitWidth)),e.BitField.empty(Math.pow(2,e.bitWidth)),[],e),ho=(e,t,r)=>Hc(e,0,e.config.Path.from(t),t,r),Hc=(e,t,r,n,i)=>{let{datamap:s,nodemap:o,config:a}=e,{Path:l,BitField:u}=a,c=l.at(r,t);if(u.get(s,c)){let f=u.popcount(s,c);return po(e,f)===n?Vi(e,f):i}else return u.get(o,c)?yo(e,c).lookup(t+1,r,n,i):i},qc=(e,t,r,n,i)=>fo(e,t,0,e.config.Path.from(r),r,n,i),fo=(e,t,r,n,i,s,o)=>{let{datamap:a,nodemap:l,config:u}=e,{Path:c,BitField:f}=u,w=c.at(n,r);if(f.get(a,w)){let d=f.popcount(a,w),y=po(e,d);if(i===y)return Vi(e,d)===s?e:i0(e,t,d,s);{let h=Xc(u,t,r+1,c.from(y),y,Vi(e,d),n,i,s);return o.value=!0,o0(e,t,w,h)}}else if(f.get(l,w)){let d=yo(e,w),y=d.associate(t,r+1,n,i,s,o);return d===y?e:Qc(e,t,w,y)}else{let d=f.popcount(a,w);o.value=!0;let y=e.fork(t);return y.datamap=f.set(a,w),y.children.splice(Cr(d),0,i,s),y}},Vc=(e,t,r,n)=>Wc(e,t,0,e.config.Path.from(r),r,n),Wc=(e,t,r,n,i,s)=>{let{datamap:o,nodemap:a,config:l}=e,{BitField:u,Path:c}=l,f=c.at(n,r);if(u.get(o,f)){let w=u.popcount(o,f);if(i===po(e,w)){s.value=!0;let d=Tr(e,t);return d.datamap=u.unset(e.datamap,f),d.children.splice(Cr(w),2),d}else return e}else if(u.get(a,f)){let w=yo(e,f),d=w.dissociate(t,r+1,n,i,s);return a0(d)?l0(e)?d:s0(e,t,f,d):w===d?e:Qc(e,t,f,d)}else return e},Gc=function*({children:e}){let t=0,r=e.length;for(;t<r;){let n=e[t];if(typeof n=="string"){t+=1;let i=e[t];yield[n,i],t+=1}else break}for(;t<r;)yield*e[t].entries(),t+=1},Tr=(e,t)=>Zc(e.edit,t)?e:new mn(t,e.datamap,e.nodemap,e.children.slice(),e.config),Kc=function*({children:e}){let t=0,r=e.length;for(;t<r;){let n=e[t];if(typeof n=="string")yield n,t+=2;else break}for(;t<r;)yield*e[t].keys(),t+=1},Jc=function*({children:e}){let t=0,r=e.length;for(;t<r&&typeof e[t]=="string";)t+=1,yield e[t],t+=1;for(;t<r;)yield*e[t].values(),t+=1},i0=(e,t,r,n)=>{let i=e.fork(t);return i.children[Yc(r)]=n,i},s0=(e,t,r,n)=>{let{datamap:i,nodemap:s,config:o}=e,{BitField:a}=o,l=Tr(e,t);return l.children.splice(ei(e,r),1),l.children.splice(Cr(a.popcount(i,r)),0,n.children[0],n.children[1]),l.datamap=a.set(i,r),l.nodemap=a.unset(s,r),l},Qc=(e,t,r,n)=>{let i=Tr(e,t);return i.children[ei(e,r)]=n,i},o0=(e,t,r,n)=>{let{nodemap:i,datamap:s,config:o}=e,{BitField:a}=o,l=a.popcount(s,r),u=Cr(l),c=ei(e,r),f=Tr(e,t);return f.datamap=a.unset(s,r),f.children.splice(u,2),f.nodemap=a.set(i,r),f.children.splice(c-1,0,n),f},Xc=(e,t,r,n,i,s,o,a,l)=>{let{BitField:u,Path:c}=e;if(c.size<r)return new Rc(t,2,[i,s,a,l],e);{let f=c.at(n,r),w=c.at(o,r);return f===w?new mn(t,u.empty(Math.pow(2,e.bitWidth)),u.from([f],Math.pow(2,e.bitWidth)),[Xc(e,t,r+1,n,i,s,o,a,l)],e):new mn(t,u.from([f,w],Math.pow(2,e.bitWidth)),u.empty(Math.pow(2,e.bitWidth)),f<w?[i,s,a,l]:[a,l,i,s],e)}},po=({children:e},t)=>e[Cr(t)],Cr=e=>e*2,Vi=({children:e},t)=>e[Yc(t)],Yc=e=>e*2+1,yo=(e,t)=>e.children[ei(e,t)],ei=({children:e,nodemap:t,config:r},n)=>e.length-1-r.BitField.popcount(t,n),Zc=(e,t)=>e!=null&&e===t,a0=e=>e.nodeArity===0&&e.dataArity===1,l0=({config:{BitField:e},datamap:t,nodemap:r})=>e.popcount(t)===0&&e.popcount(r)===1,wo=J(Za(),1);function u0(e){let t=new Array(4);for(let r=0;r<4;r++)t[r]=e&255,e=e>>8;return new Uint8Array(t)}var Pk=Sr({name:"murmur3-32",code:35,encode:e=>u0(wo.default.x86.hash32(e))}),c0=Sr({name:"murmur3-128",code:34,encode:e=>Nn.fromHex(wo.default.x64.hash128(e))}),eh=Sr({name:"murmur3-x64-64",code:34,encode:e=>Nn.fromHex(wo.default.x64.hash128(e)).subarray(0,8)}),h0=new TextEncoder,f0=e=>eh.encode(e),d0=({bitWidth:e=8,hash:t=f0}={})=>{let r=t(new Uint8Array).byteLength;return{from:n=>t(h0.encode(n)),at:(n,i)=>{let s=i*e;if(s>r)throw new RangeError("Out of bounds");return th(n,s,e)},size:Math.ceil(r*8/e)}},th=(e,t,r)=>{let n=t/8|0,i=t%8,s=r,o=0;for(;s>0&&n<e.byteLength;){let a=e[n],l=8-i,u=l<s?l:s,c=8-i-u,f=(255>>i&a)>>c;o=(o<<u)+f,s-=u,n++,i=0}return o},rh={};Z(rh,{API:()=>Uc,and:()=>x0,empty:()=>nh,from:()=>p0,fromBytes:()=>v0,get:()=>b0,or:()=>E0,popcount:()=>k0,set:()=>w0,size:()=>y0,toBytes:()=>m0,unset:()=>g0});var nh=(e=256)=>{if(e%8!==0)throw new Error("Must be multiple of 8");return new Uint8Array(e/8)},p0=(e,t)=>{let r=nh(t);for(let n of e){let{byte:i,byteOffset:s,bitOffset:o}=Dr(r,n);r[s]=i|1<<o}return r},y0=e=>e.byteLength*8,Dr=(e,t)=>{let r=e.byteLength-1-(t/8|0),n=t%8;return{byte:e[r],byteOffset:r,bitOffset:n}},ih=(e,t,r)=>{if(e[t]!==r){let n=e.slice(0);return n[t]=r,n}return e},w0=(e,t)=>{let{byte:r,byteOffset:n,bitOffset:i}=Dr(e,t);return ih(e,n,r|1<<i)},g0=(e,t)=>{let{byte:r,byteOffset:n,bitOffset:i}=Dr(e,t);return ih(e,n,r&(255^1<<i))},b0=(e,t)=>{var{byte:r,bitOffset:n}=Dr(e,t);return(r>>n&1)!==0},m0=e=>e,v0=e=>e,k0=(e,t=e.byteLength*8)=>{let{byteOffset:r,bitOffset:n,byte:i}=Dr(e,t),s=jc(i,n),o=e.byteLength-1;for(;o>r;){let a=e[o];s+=uo(a),o--}return s},E0=(e,t)=>{let r=e.slice(),n=0;for(;n<e.length;)r[n]|=t[n],n++;return r},x0=(e,t)=>{let r=e.slice(),n=0;for(;n<e.length;)r[n]&=t[n],n++;return r},Fa=new RangeError("Not Found"),S0=({bitWidth:e=5,BitField:t=e===5?Mc:rh,Path:r=e===5?Zm({bitWidth:e}):d0({bitWidth:e})}={})=>({bitWidth:e,BitField:t,Path:r}),sh=(e,t)=>ho(e.root,t,Fa)!==Fa,A0=(e,t,r=void 0)=>ho(e.root,t,r),_0=e=>{let t={},r=S0(e);return new oh(t,0,Zn(r,t),r)},F0=class Zt{constructor(t=0,r,n){this.count=t,this.root=r,this.config=n}get size(){return this.count}clone(){return new Zt(this.count,this.root,this.config)}empty(){return new Zt(0,Zn(this.config,null),this.config)}has(t){return sh(this,t)}get(t){return ho(this.root,t,void 0)}set(t,r){let n={value:!1},i=qc(this.root,null,t,r,n);return i===this.root?this:new Zt(n.value?this.count+1:this.count,i,this.config)}delete(t){let r=Vc(this.root,null,t,{value:!1});return r===this.root?this:new Zt(this.count-1,r,this.config)}get bitField(){return this.config.BitField.or(this.root.datamap,this.root.nodemap)}[Symbol.iterator](){return this.entries()}entries(){return this.root.entries()}keys(){return this.root.keys()}values(){return this.root.values()}createBuilder(){return new oh({},this.count,this.root,this.config)}},oh=class{constructor(e,t,r,n){this.edit=e,this.count=t,this.root=r,this.config=n}get size(){if(this.edit)return this.count;throw new Error(".size was accessed on the finalized builder")}set(e,t){if(this.edit){let r={value:!1},n=qc(this.root,this.edit,e,t,r);return this.root!==n&&(this.root=n),r.value&&(this.count+=1),this}else throw new Error(".set was called on the finalized builder")}delete(e){if(this.edit){if(this.count===0)return this;let t={value:!1},r=Vc(this.root,this.edit,e,t);return r!==this.root&&(this.root=r),t.value&&(this.count-=1),this}else throw new Error(".delete was called on the finalized builder")}build(){if(this.edit)return this.edit=null,new F0(this.count,this.root,this.config);throw new Error(".build was called on the finalized builder")}},B0=new TextEncoder,T0=e=>eh.encode(e),C0=({bitWidth:e=8,hash:t=T0})=>{let r=t(new Uint8Array).byteLength,n={bitWidth:e,hash:t,hashSize:r};return{at:(i,s)=>D0(i,s,n),from:i=>B0.encode(i),size:1/0}},D0=(e,t=0,{bitWidth:r=8,hash:n,hashSize:i})=>{let s=i*8,o=0,a=r,l=r*t;for(;a>0;){let u=l/s>>0,c=n(u===0?e:N0(e,u)),f=s<=l?l%s:l,w=s-f,d=w<a?w:a;o=(o<<d)+th(c,f,d),a-=d,l+=d}return o},N0=(e,t)=>{let r=new Uint8Array(e.byteLength+1).fill(t,e.byteLength);return r.set(e),r},Ba=8,L0={bitWidth:Ba,Path:C0({bitWidth:Ba})},Ta=(e=L0)=>_0(e),Mk=class extends Map{constructor(e=Ta()){super(),this.builder=e}clear(){this.builder=Ta()}delete(e){let{root:t}=this.builder;return this.builder.delete(e),this.builder.root!==t}forEach(e,t=this){for(let[r,n]of this.builder.root.entries())e.call(t,n,r,this)}get(e){return A0(this.builder,e)}has(e){return sh(this.builder,e)}set(e,t){return this.builder.set(e,t),this}get size(){return this.builder.size}[Symbol.iterator](){return this.builder.root.entries()}entries(){return this.builder.root.entries()}keys(){return this.builder.root.keys()}values(){return this.builder.root.values()}},I0=({writable:e,settings:t=Yn()})=>new P0({writer:e.getWriter(),settings:t}),O0=async(e,{releaseLock:t=!0,closeWriter:r=!0}={})=>(r?await e.writer.close():t&&e.writer.releaseLock(),e),P0=class{constructor({writer:e,settings:t}){this.writer=e,this.settings=ao(t)}createFileWriter({settings:e=this.settings,metadata:t}={}){return Lc({writer:this.writer,settings:e,metadata:t})}createDirectoryWriter({settings:e=this.settings,metadata:t}={}){return Om({writer:this.writer,settings:e,metadata:t})}close(e){return O0(this,e)}},M0=1048576,U0=M0*100,z0=(e=U0)=>({highWaterMark:e,size:t=>t.bytes.length}),go=J(Ue(),1);function j0(e){return e[Symbol.asyncIterator]!=null}function $0(e){if(j0(e))return(async()=>{let r;for await(let n of e)r=n;return r})();let t;for(let r of e)t=r;return t}var R0=$0,H0=J(Ue(),1),ah=0,q0="identity",lh=ft,V0=e=>un(ah,lh(e)),W0={code:ah,name:q0,encode:lh,digest:V0},G0=J(Ue(),1),K0=async(e,t,r,n,i,s,o,a)=>{let l=await o.get(e,a),u=cs(l),c=u,f=r;for(;n.length>0;){let w=n[0];if(w in c){n.shift(),f=`${f}/${w}`;let d=ee.asCID(c[w]);if(d!=null)return{entry:{type:"object",name:t,path:r,cid:e,node:l,depth:s,size:BigInt(l.length),content:async function*(){yield u}},next:{cid:d,name:w,path:f,toResolve:n}};c=c[w]}else throw(0,G0.default)(new Error(`No property named ${w} found in cbor node ${e}`),"ERR_NO_PROP")}return{entry:{type:"object",name:t,path:r,cid:e,node:l,depth:s,size:BigInt(l.length),content:async function*(){yield u}}}},J0=K0,Q0=J(Ue(),1),Ze=class extends Event{constructor(e,t){super(e),this.detail=t}};function X0(e,t,r,n){let i=BigInt(e.length),s=BigInt(t+i);return r>=s||n<t?new Uint8Array(0):(n>=t&&n<s&&(e=e.subarray(0,Number(n-t))),r>=t&&r<s&&(e=e.subarray(Number(r-t))),e)}var vn=X0,jr=J(Ue(),1),Y0=(e,t=0,r=e)=>{let n=BigInt(e),i=BigInt(t??0),s=BigInt(r);if(s!==n&&(s=i+s),s>n&&(s=n),i<0n)throw(0,jr.default)(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(i>n)throw(0,jr.default)(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(s<0n)throw(0,jr.default)(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(s>n)throw(0,jr.default)(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:i,end:s}},bo=Y0,Z0=e=>{async function*t(r={}){let{start:n,end:i}=bo(e.length,r.offset,r.length),s=vn(e,0n,n,i);r.onProgress?.(new Ze("unixfs:exporter:progress:identity",{bytesRead:BigInt(s.byteLength),totalBytes:i-n,fileSize:BigInt(e.byteLength)})),yield s}return t},ev=async(e,t,r,n,i,s,o,a)=>{if(n.length>0)throw(0,Q0.default)(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");let l=kl(e.multihash.bytes);return{entry:{type:"identity",name:t,path:r,cid:e,content:Z0(l.digest),depth:s,size:BigInt(l.digest.length),node:l.digest}}},tv=ev,rv=J(Ue(),1),nv=e=>{async function*t(r={}){let{start:n,end:i}=bo(e.length,r.offset,r.length),s=vn(e,0n,n,i);r.onProgress?.(new Ze("unixfs:exporter:progress:raw",{bytesRead:BigInt(s.byteLength),totalBytes:i-n,fileSize:BigInt(e.byteLength)})),yield s}return t},iv=async(e,t,r,n,i,s,o,a)=>{if(n.length>0)throw(0,rv.default)(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");let l=await o.get(e,a);return{entry:{type:"raw",name:t,path:r,cid:e,content:nv(l),depth:s,size:BigInt(l.length),node:l}}},sv=iv,$r=J(Ue(),1),Ca=J(Ue(),1),uh=J(Qi(),1),ov=J(Ya(),1),av=J(et(),1),ch=J(Ji(),1),lv=J(Xa(),1);function uv(){av.default._configure(),uh.default._configure(ov.default),ch.default._configure(lv.default)}uv();var hh=["uint64","int64","sint64","fixed64","sfixed64"];function cv(e){for(let t of hh){if(e[t]==null)continue;let r=e[t];e[t]=function(){return BigInt(r.call(this).toString())}}return e}function hv(e){return cv(new uh.default(e))}function fv(e){for(let t of hh){if(e[t]==null)continue;let r=e[t];e[t]=function(n){return r.call(this,n.toString())}}return e}function dv(){return fv(ch.default.create())}function mo(e,t){let r=hv(e instanceof Uint8Array?e:e.subarray());return t.decode(r)}function vo(e,t){let r=dv();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var kn;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(kn||(kn={}));function fh(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function pv(e){function t(i){if(e[i.toString()]==null)throw new Error("Invalid enum value");return e[i]}let r=function(i,s){let o=t(i);s.int32(o)},n=function(i){let s=i.int32();return t(s)};return fh("enum",kn.VARINT,r,n)}function ko(e,t){return fh("message",kn.LENGTH_DELIMITED,e,t)}var Fe;(function(e){let t;(function(i){i.Raw="Raw",i.Directory="Directory",i.File="File",i.Metadata="Metadata",i.Symlink="Symlink",i.HAMTShard="HAMTShard"})(t=e.DataType||(e.DataType={}));let r;(function(i){i[i.Raw=0]="Raw",i[i.Directory=1]="Directory",i[i.File=2]="File",i[i.Metadata=3]="Metadata",i[i.Symlink=4]="Symlink",i[i.HAMTShard=5]="HAMTShard"})(r||(r={})),function(i){i.codec=()=>pv(r)}(t=e.DataType||(e.DataType={}));let n;e.codec=()=>(n==null&&(n=ko((i,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),i.Type!=null&&(s.uint32(8),e.DataType.codec().encode(i.Type,s)),i.Data!=null&&(s.uint32(18),s.bytes(i.Data)),i.filesize!=null&&(s.uint32(24),s.uint64(i.filesize)),i.blocksizes!=null)for(let a of i.blocksizes)s.uint32(32),s.uint64(a);i.hashType!=null&&(s.uint32(40),s.uint64(i.hashType)),i.fanout!=null&&(s.uint32(48),s.uint64(i.fanout)),i.mode!=null&&(s.uint32(56),s.uint32(i.mode)),i.mtime!=null&&(s.uint32(66),En.codec().encode(i.mtime,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s)=>{let o={blocksizes:[]},a=s==null?i.len:i.pos+s;for(;i.pos<a;){let l=i.uint32();switch(l>>>3){case 1:o.Type=e.DataType.codec().decode(i);break;case 2:o.Data=i.bytes();break;case 3:o.filesize=i.uint64();break;case 4:o.blocksizes.push(i.uint64());break;case 5:o.hashType=i.uint64();break;case 6:o.fanout=i.uint64();break;case 7:o.mode=i.uint32();break;case 8:o.mtime=En.codec().decode(i,i.uint32());break;default:i.skipType(l&7);break}}return o})),n),e.encode=i=>vo(i,e.codec()),e.decode=i=>mo(i,e.codec())})(Fe||(Fe={}));var En;(function(e){let t;e.codec=()=>(t==null&&(t=ko((r,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),r.Seconds!=null&&(n.uint32(8),n.int64(r.Seconds)),r.FractionalNanoseconds!=null&&(n.uint32(21),n.fixed32(r.FractionalNanoseconds)),i.lengthDelimited!==!1&&n.ldelim()},(r,n)=>{let i={},s=n==null?r.len:r.pos+n;for(;r.pos<s;){let o=r.uint32();switch(o>>>3){case 1:i.Seconds=r.int64();break;case 2:i.FractionalNanoseconds=r.fixed32();break;default:r.skipType(o&7);break}}return i})),t),e.encode=r=>vo(r,e.codec()),e.decode=r=>mo(r,e.codec())})(En||(En={}));var Da;(function(e){let t;e.codec=()=>(t==null&&(t=ko((r,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),r.MimeType!=null&&(n.uint32(10),n.string(r.MimeType)),i.lengthDelimited!==!1&&n.ldelim()},(r,n)=>{let i={},s=n==null?r.len:r.pos+n;for(;r.pos<s;){let o=r.uint32();switch(o>>>3){case 1:i.MimeType=r.string();break;default:r.skipType(o&7);break}}return i})),t),e.encode=r=>vo(r,e.codec()),e.decode=r=>mo(r,e.codec())})(Da||(Da={}));var Na={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},yv=["directory","hamt-sharded-directory"],La=parseInt("0644",8),Ia=parseInt("0755",8),dh=class ph{constructor(t={type:"file"}){A(this,"type"),A(this,"data"),A(this,"blockSizes"),A(this,"hashType"),A(this,"fanout"),A(this,"mtime"),A(this,"_mode"),A(this,"_originalMode");let{type:r,data:n,blockSizes:i,hashType:s,fanout:o,mtime:a,mode:l}=t;if(r!=null&&!Object.values(Na).includes(r))throw(0,Ca.default)(new Error("Type: "+r+" is not valid"),"ERR_INVALID_TYPE");this.type=r??"file",this.data=n,this.hashType=s,this.fanout=o,this.blockSizes=i??[],this._originalMode=0,this.mode=l,this.mtime=a}static unmarshal(t){let r=Fe.decode(t),n=new ph({type:Na[r.Type!=null?r.Type.toString():"File"],data:r.Data,blockSizes:r.blocksizes,mode:r.mode,mtime:r.mtime!=null?{secs:r.mtime.Seconds??0n,nsecs:r.mtime.FractionalNanoseconds}:void 0});return n._originalMode=r.mode??0,n}set mode(t){t==null?this._mode=this.isDirectory()?Ia:La:this._mode=t&4095}get mode(){return this._mode}isDirectory(){return yv.includes(this.type)}addBlockSize(t){this.blockSizes.push(t)}removeBlockSize(t){this.blockSizes.splice(t,1)}fileSize(){if(this.isDirectory())return 0n;let t=0n;return this.blockSizes.forEach(r=>{t+=r}),this.data!=null&&(t+=BigInt(this.data.length)),t}marshal(){let t;switch(this.type){case"raw":t=Fe.DataType.Raw;break;case"directory":t=Fe.DataType.Directory;break;case"file":t=Fe.DataType.File;break;case"metadata":t=Fe.DataType.Metadata;break;case"symlink":t=Fe.DataType.Symlink;break;case"hamt-sharded-directory":t=Fe.DataType.HAMTShard;break;default:throw(0,Ca.default)(new Error(`Type: ${t} is not valid`),"ERR_INVALID_TYPE")}let r=this.data;(this.data==null||this.data.length===0)&&(r=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(this.mode??0),n===La&&!this.isDirectory()&&(n=void 0),n===Ia&&this.isDirectory()&&(n=void 0));let i;return this.mtime!=null&&(i={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),Fe.encode({Type:t,Data:r,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:i})}},wv=J(If(),1),yh={};Z(yh,{identity:()=>gv});var gv=Fn({prefix:"\0",name:"identity",encode:e=>ld(e),decode:e=>ad(e)}),wh={};Z(wh,{base2:()=>bv});var bv=se({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),gh={};Z(gh,{base8:()=>mv});var mv=se({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),bh={};Z(bh,{base10:()=>vv});var vv=gr({prefix:"9",name:"base10",alphabet:"0123456789"}),mh={};Z(mh,{base16:()=>kv,base16upper:()=>Ev});var kv=se({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ev=se({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),vh={};Z(vh,{base36:()=>xv,base36upper:()=>Sv});var xv=gr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Sv=gr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),kh={};Z(kh,{base64:()=>Av,base64pad:()=>_v,base64url:()=>Fv,base64urlpad:()=>Bv});var Av=se({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),_v=se({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Fv=se({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Bv=se({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Eh={};Z(Eh,{base256emoji:()=>Lv});var xh=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Tv=xh.reduce((e,t,r)=>(e[r]=t,e),[]),Cv=xh.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);function Dv(e){return e.reduce((t,r)=>(t+=Tv[r],t),"")}function Nv(e){let t=[];for(let r of e){let n=Cv[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}var Lv=Fn({prefix:"\u{1F680}",name:"base256emoji",encode:Dv,decode:Nv}),Sh={};Z(Sh,{identity:()=>Pv});var Ah=0,Iv="identity",_h=_n,Ov=e=>rn(Ah,_h(e)),Pv={code:Ah,name:Iv,encode:_h,digest:Ov},Uk=new TextEncoder,zk=new TextDecoder,Oa={...yh,...wh,...gh,...bh,...mh,...nl,...vh,...tl,...kh,...Eh},jk={...zu,...Sh};function Eo(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Fh(e=0){return globalThis.Buffer?.allocUnsafe!=null?Eo(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Bh(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var Pa=Bh("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),pi=Bh("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=Fh(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Mv={utf8:Pa,"utf-8":Pa,hex:Oa.base16,latin1:pi,ascii:pi,binary:pi,...Oa},Uv=Mv;function zv(e,t="utf8"){let r=Uv[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Eo(globalThis.Buffer.from(e,"utf-8")):r.decoder.decode(`${r.prefix}${e}`)}var xo=class He{constructor(t,r,n=0){this._options=t,this._popCount=0,this._parent=r,this._posAtParent=n,this._children=new wv.default,this.key=null}async put(t,r){let n=await this._findNewBucketAndPos(t);await n.bucket._putAt(n,t,r)}async get(t){let r=await this._findChild(t);if(r!=null)return r.value}async del(t){let r=await this._findPlace(t),n=r.bucket._at(r.pos);n!=null&&n.key===t&&r.bucket._delAt(r.pos)}leafCount(){return this._children.compactArray().reduce((t,r)=>r instanceof He?t+r.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let t=this._children.compactArray();for(let r of t)r instanceof He?yield*r.eachLeafSeries():yield r}serialize(t,r){let n=[];return r(this._children.reduce((i,s,o)=>(s!=null&&(s instanceof He?i.push(s.serialize(t,r)):i.push(t(s,o))),i),n))}async asyncTransform(t,r){return await Th(this,t,r)}toJSON(){return this.serialize($v,Rv)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(t){let r=await this._findPlace(t),n=r.bucket._at(r.pos);if(!(n instanceof He)&&n!=null&&n.key===t)return n}async _findPlace(t){let r=this._options.hash(typeof t=="string"?zv(t):t),n=await r.take(this._options.bits),i=this._children.get(n);return i instanceof He?await i._findPlace(r):{bucket:this,pos:n,hash:r,existingChild:i}}async _findNewBucketAndPos(t){let r=await this._findPlace(t);if(r.existingChild!=null&&r.existingChild.key!==t){let n=new He(this._options,r.bucket,r.pos);r.bucket._putObjectAt(r.pos,n);let i=await n._findPlace(r.existingChild.hash);return i.bucket._putAt(i,r.existingChild.key,r.existingChild.value),await n._findNewBucketAndPos(r.hash)}return r}_putAt(t,r,n){this._putObjectAt(t.pos,{key:r,value:n,hash:t.hash})}_putObjectAt(t,r){this._children.get(t)==null&&this._popCount++,this._children.set(t,r)}_delAt(t){if(t===-1)throw new Error("Invalid position");this._children.get(t)!=null&&this._popCount--,this._children.unset(t),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){let t=this._children.find(jv);if(t!=null&&!(t instanceof He)){let r=t.hash;r.untake(this._options.bits);let n={pos:this._posAtParent,hash:r,bucket:this._parent};this._parent._putAt(n,t.key,t.value)}}else this._parent._delAt(this._posAtParent)}_at(t){return this._children.get(t)}};function jv(e){return!!e}function $v(e,t){return e.key}function Rv(e){return e}async function Th(e,t,r){let n=[];for(let i of e._children.compactArray())if(i instanceof xo)await Th(i,t,r);else{let s=await t(i);n.push({bitField:e._children.bitField(),children:s})}return await r(n)}var Hv=[255,254,252,248,240,224,192,128],qv=[1,3,7,15,31,63,127,255],Vv=class{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){let n=this._value[this._currentBytePos],i=this._currentBitPos+1,s=Math.min(i,t),o=Wv(n,i-s,s);r=(r<<s)+o,t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function Wv(e,t,r){let n=Gv(t,r);return(e&n)>>>t}function Gv(e,t){return Hv[e]&qv[Math.min(t+e-1,7)]}function Kv(e,t){t==null&&(t=e.reduce((i,s)=>i+s.length,0));let r=Fh(t),n=0;for(let i of e)r.set(i,n),n+=i.length;return Eo(r)}function Jv(e){function t(r){return r instanceof Ma?r:new Ma(r,e)}return t}var Ma=class{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){let n=this._buffers[this._currentBufferIndex],i=Math.min(n.availableBits(),t),s=n.take(i);r=(r<<i)+s,t-=i,this._availableBits-=i,n.availableBits()===0&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){let r=this._buffers[this._currentBufferIndex],n=Math.min(r.totalBits()-r.availableBits(),t);r.untake(n),t-=n,this._availableBits+=n,this._currentBufferIndex>0&&r.totalBits()===r.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?Kv([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),r=new Vv(t);this._buffers.push(r),this._availableBits+=r.availableBits()}};function Qv(e){if(e==null||e.hashFn==null)throw new Error("please define an options.hashFn");let t={bits:e.bits??8,hash:Jv(e.hashFn)};return new xo(t)}var Xv=async function(e){return(await c0.encode(e)).slice(0,8).reverse()},Yv=async(e,t,r)=>{await Promise.all(e.map(async n=>{if(n.Name==null)throw new Error("Unexpected Link without a Name");if(n.Name.length===2){let i=parseInt(n.Name,16);t._putObjectAt(i,new xo({hash:r._options.hash,bits:r._options.bits},t,i));return}await r.put(n.Name.substring(2),!0)}))},Ua=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),Zv=e=>{let t=e.bucket,r=[];for(;t._parent!=null;)r.push(t),t=t._parent;return r.push(t),r.reverse()},Ch=async(e,t,r,n,i)=>{if(n==null){let c=Qv({hashFn:Xv});n={rootBucket:c,hamtDepth:1,lastBucket:c}}await Yv(e.Links,n.lastBucket,n.rootBucket);let s=await n.rootBucket._findNewBucketAndPos(t),o=Ua(s.pos),a=Zv(s);a.length>n.hamtDepth&&(n.lastBucket=a[n.hamtDepth],o=Ua(n.lastBucket._posAtParent));let l=e.Links.find(c=>{if(c.Name==null)return!1;let f=c.Name.substring(0,2),w=c.Name.substring(2);return!(f!==o||w!==""&&w!==t)});if(l==null)return;if(l.Name!=null&&l.Name.substring(2)===t)return l.Hash;n.hamtDepth++;let u=await r.get(l.Hash,i);return e=_r(u),Ch(e,t,r,n,i)},e2=Ch;function t2(e){let[t,r]=e[Symbol.asyncIterator]!=null?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>t.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:t.next(),[r](){return this}}}var Dh=t2;function r2(e){return e[Symbol.asyncIterator]!=null}function n2(e,t){if(r2(e))return async function*(){for await(let a of e)await t(a)&&(yield a)}();let r=Dh(e),{value:n,done:i}=r.next();if(i===!0)return function*(){}();let s=t(n);if(typeof s.then=="function")return async function*(){await s&&(yield n);for await(let a of r)await t(a)&&(yield a)}();let o=t;return function*(){s===!0&&(yield n);for(let a of r)o(a)&&(yield a)}()}var i2=n2;function s2(e){return e[Symbol.asyncIterator]!=null}function o2(e,t){if(s2(e))return async function*(){for await(let a of e)yield t(a)}();let r=Dh(e),{value:n,done:i}=r.next();if(i===!0)return function*(){}();let s=t(n);if(typeof s.then=="function")return async function*(){yield await s;for await(let a of r)yield t(a)}();let o=t;return function*(){yield s;for(let a of r)yield o(a)}()}var So=o2;function Dt(){let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}var Rr=globalThis.CustomEvent??Event;async function*Ao(e,t={}){let r=t.concurrency??1/0;r<1&&(r=1/0);let n=t.ordered==null?!1:t.ordered,i=new EventTarget,s=[],o=Dt(),a=Dt(),l=!1,u,c=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(let y of e){if(s.length===r&&(o=Dt(),await o.promise),c)break;let h={done:!1};s.push(h),y().then(p=>{h.done=!0,h.ok=!0,h.value=p,i.dispatchEvent(new Rr("task-complete"))},p=>{h.done=!0,h.err=p,i.dispatchEvent(new Rr("task-complete"))})}l=!0,i.dispatchEvent(new Rr("task-complete"))}catch(y){u=y,i.dispatchEvent(new Rr("task-complete"))}});function f(){return n?s[0]?.done:!!s.find(y=>y.done)}function*w(){for(;s.length>0&&s[0].done;){let y=s[0];if(s.shift(),y.ok)yield y.value;else throw c=!0,o.resolve(),y.err;o.resolve()}}function*d(){for(;f();)for(let y=0;y<s.length;y++)if(s[y].done){let h=s[y];if(s.splice(y,1),y--,h.ok)yield h.value;else throw c=!0,o.resolve(),h.err;o.resolve()}}for(;;){if(f()||(a=Dt(),await a.promise),u!=null)throw u;if(n?yield*w():yield*d(),l&&s.length===0)break}}var za=class{constructor(e){if(A(this,"buffer"),A(this,"mask"),A(this,"top"),A(this,"btm"),A(this,"next"),!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},yi=class{constructor(e={}){A(this,"size"),A(this,"hwm"),A(this,"head"),A(this,"tail"),this.hwm=e.splitLimit??16,this.head=new za(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new za(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}},a2=class extends Error{constructor(e,t){super(e??"The operation was aborted"),A(this,"type"),A(this,"code"),this.type="aborted",this.code=t??"ABORT_ERR"}};function _o(e={}){return l2(t=>{let r=t.shift();if(r==null)return{done:!0};if(r.error!=null)throw r.error;return{done:r.done===!0,value:r.value}},e)}function l2(e,t){t=t??{};let r=t.onEnd,n=new yi,i,s,o,a=Dt(),l=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((p,g)=>{s=m=>{s=null,n.push(m);try{p(e(n))}catch(b){g(b)}return i}}):e(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Dt()})}},u=p=>s!=null?s(p):(n.push(p),i),c=p=>(n=new yi,s!=null?s({error:p}):(n.push({error:p}),i)),f=p=>{if(o)return i;if(t?.objectMode!==!0&&p?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return u({done:!1,value:p})},w=p=>o?i:(o=!0,p!=null?c(p):u({done:!0})),d=()=>(n=new yi,w(),{done:!0}),y=p=>(w(p),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:l,return:d,throw:y,push:f,end:w,get readableLength(){return n.size},onEmpty:async p=>{let g=p?.signal;if(g?.throwIfAborted(),n.isEmpty())return;let m,b;g!=null&&(m=new Promise((k,S)=>{b=()=>{S(new a2)},g.addEventListener("abort",b)}));try{await Promise.race([a.promise,m])}finally{b!=null&&g!=null&&g?.removeEventListener("abort",b)}}},r==null)return i;let h=i;return i={[Symbol.asyncIterator](){return this},next(){return h.next()},throw(p){return h.throw(p),r!=null&&(r(p),r=void 0),{done:!0}},return(){return h.return(),r!=null&&(r(),r=void 0),{done:!0}},push:f,end(p){return h.end(p),r!=null&&(r(p),r=void 0),i},get readableLength(){return h.readableLength}},i}function u2(e){return e[Symbol.asyncIterator]!=null}function c2(...e){let t=[];for(let r of e)u2(r)||t.push(r);return t.length===e.length?function*(){for(let r of t)yield*r}():async function*(){let r=_o({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(e.map(async n=>{for await(let i of n)r.push(i)})),r.end()}catch(n){r.end(n)}}),yield*r}()}var h2=c2;function Fo(e,...t){if(e==null)throw new Error("Empty pipeline");if(wi(e)){let n=e;e=()=>n.source}else if(Lh(e)||Nh(e)){let n=e;e=()=>n}let r=[e,...t];if(r.length>1&&wi(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let n=1;n<r.length-1;n++)wi(r[n])&&(r[n]=d2(r[n]));return f2(...r)}var f2=(...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t},Nh=e=>e?.[Symbol.asyncIterator]!=null,Lh=e=>e?.[Symbol.iterator]!=null,wi=e=>e==null?!1:e.sink!=null&&e.source!=null,d2=e=>t=>{let r=e.sink(t);if(r?.then!=null){let n=_o({objectMode:!0});r.then(()=>{n.end()},o=>{n.end(o)});let i,s=e.source;if(Nh(s))i=async function*(){yield*s,n.end()};else if(Lh(s))i=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return h2(n,i())}return e.source},p2=(e,t,r,n,i,s,o)=>{async function*a(l={}){let u=l.offset??0,c=l.length??t.Links.length,f=t.Links.slice(u,c);l.onProgress?.(new Ze("unixfs:exporter:walk:directory",{cid:e})),yield*Fo(f,w=>So(w,d=>async()=>{let y=d.Name??"",h=`${n}/${y}`;return(await i(d.Hash,y,h,[],s+1,o,l)).entry}),w=>Ao(w,{ordered:!0}),w=>i2(w,d=>d!=null))}return a},y2=p2,Nt=J(Ue(),1),w2=J(Of(),1),Ih=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},g2=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},ja=e=>globalThis.DOMException===void 0?new g2(e):new DOMException(e),$a=e=>{let t=e.reason===void 0?ja("This operation was aborted."):e.reason;return t instanceof Error?t:ja(t)};function b2(e,t,r,n){let i,s=new Promise((o,a)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t===Number.POSITIVE_INFINITY){o(e);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){let{signal:l}=n;l.aborted&&a($a(l)),l.addEventListener("abort",()=>{a($a(l))})}i=n.customTimers.setTimeout.call(void 0,()=>{if(typeof r=="function"){try{o(r())}catch(c){a(c)}return}let l=typeof r=="string"?r:`Promise timed out after ${t} milliseconds`,u=r instanceof Error?r:new Ih(l);typeof e.cancel=="function"&&e.cancel(),a(u)},t),(async()=>{try{o(await e)}catch(l){a(l)}finally{n.customTimers.clearTimeout.call(void 0,i)}})()});return s.clear=()=>{clearTimeout(i),i=void 0},s}function m2(e,t,r){let n=0,i=e.length;for(;i>0;){let s=Math.trunc(i/2),o=n+s;r(e[o],t)<=0?(n=++o,i-=s+1):i=s}return n}var rt=function(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)},Ie,v2=class{constructor(){Ie.set(this,[])}enqueue(e,t){t={priority:0,...t};let r={priority:t.priority,run:e};if(this.size&&rt(this,Ie,"f")[this.size-1].priority>=t.priority){rt(this,Ie,"f").push(r);return}let n=m2(rt(this,Ie,"f"),r,(i,s)=>s.priority-i.priority);rt(this,Ie,"f").splice(n,0,r)}dequeue(){return rt(this,Ie,"f").shift()?.run}filter(e){return rt(this,Ie,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return rt(this,Ie,"f").length}};Ie=new WeakMap;var G=function(e,t,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(e,r):i?i.value=r:t.set(e,r),r},L=function(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)},Y,sr,or,We,xn,ar,Gr,Ee,er,fe,Kr,de,lr,Ve,Jr,Ra,Ha,Oh,qa,Va,Qr,gi,bi,Sn,Ph,Xr,Mh=class extends Error{},k2=class extends w2.default{constructor(e){var t,r,n,i;if(super(),Y.add(this),sr.set(this,void 0),or.set(this,void 0),We.set(this,0),xn.set(this,void 0),ar.set(this,void 0),Gr.set(this,0),Ee.set(this,void 0),er.set(this,void 0),fe.set(this,void 0),Kr.set(this,void 0),de.set(this,0),lr.set(this,void 0),Ve.set(this,void 0),Jr.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:v2,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(n=e.interval)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);G(this,sr,e.carryoverConcurrencyCount,"f"),G(this,or,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),G(this,xn,e.intervalCap,"f"),G(this,ar,e.interval,"f"),G(this,fe,new e.queueClass,"f"),G(this,Kr,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,G(this,Jr,e.throwOnTimeout===!0,"f"),G(this,Ve,e.autoStart===!1,"f")}get concurrency(){return L(this,lr,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);G(this,lr,e,"f"),L(this,Y,"m",Sn).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:L(this,Jr,"f"),...t},new Promise((r,n)=>{L(this,fe,"f").enqueue(async()=>{var i,s,o;G(this,de,(s=L(this,de,"f"),s++,s),"f"),G(this,We,(o=L(this,We,"f"),o++,o),"f");try{if(!((i=t.signal)===null||i===void 0)&&i.aborted)throw new Mh("The task was aborted.");let a=e({signal:t.signal});t.timeout&&(a=b2(Promise.resolve(a),t.timeout)),t.signal&&(a=Promise.race([a,L(this,Y,"m",Ph).call(this,t.signal)]));let l=await a;r(l),this.emit("completed",l)}catch(a){if(a instanceof Ih&&!t.throwOnTimeout){r();return}n(a),this.emit("error",a)}finally{L(this,Y,"m",Oh).call(this)}},t),this.emit("add"),L(this,Y,"m",Qr).call(this)})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return L(this,Ve,"f")?(G(this,Ve,!1,"f"),L(this,Y,"m",Sn).call(this),this):this}pause(){G(this,Ve,!0,"f")}clear(){G(this,fe,new(L(this,Kr,"f")),"f")}async onEmpty(){L(this,fe,"f").size!==0&&await L(this,Y,"m",Xr).call(this,"empty")}async onSizeLessThan(e){L(this,fe,"f").size<e||await L(this,Y,"m",Xr).call(this,"next",()=>L(this,fe,"f").size<e)}async onIdle(){L(this,de,"f")===0&&L(this,fe,"f").size===0||await L(this,Y,"m",Xr).call(this,"idle")}get size(){return L(this,fe,"f").size}sizeBy(e){return L(this,fe,"f").filter(e).length}get pending(){return L(this,de,"f")}get isPaused(){return L(this,Ve,"f")}};sr=new WeakMap,or=new WeakMap,We=new WeakMap,xn=new WeakMap,ar=new WeakMap,Gr=new WeakMap,Ee=new WeakMap,er=new WeakMap,fe=new WeakMap,Kr=new WeakMap,de=new WeakMap,lr=new WeakMap,Ve=new WeakMap,Jr=new WeakMap,Y=new WeakSet,Ra=function(){return L(this,or,"f")||L(this,We,"f")<L(this,xn,"f")},Ha=function(){return L(this,de,"f")<L(this,lr,"f")},Oh=function(){var e;G(this,de,(e=L(this,de,"f"),e--,e),"f"),L(this,Y,"m",Qr).call(this),this.emit("next")},qa=function(){L(this,Y,"m",bi).call(this),L(this,Y,"m",gi).call(this),G(this,er,void 0,"f")},Va=function(){let e=Date.now();if(L(this,Ee,"f")===void 0){let t=L(this,Gr,"f")-e;if(t<0)G(this,We,L(this,sr,"f")?L(this,de,"f"):0,"f");else return L(this,er,"f")===void 0&&G(this,er,setTimeout(()=>{L(this,Y,"m",qa).call(this)},t),"f"),!0}return!1},Qr=function(){if(L(this,fe,"f").size===0)return L(this,Ee,"f")&&clearInterval(L(this,Ee,"f")),G(this,Ee,void 0,"f"),this.emit("empty"),L(this,de,"f")===0&&this.emit("idle"),!1;if(!L(this,Ve,"f")){let e=!L(this,Y,"a",Va);if(L(this,Y,"a",Ra)&&L(this,Y,"a",Ha)){let t=L(this,fe,"f").dequeue();return t?(this.emit("active"),t(),e&&L(this,Y,"m",gi).call(this),!0):!1}}return!1},gi=function(){L(this,or,"f")||L(this,Ee,"f")!==void 0||(G(this,Ee,setInterval(()=>{L(this,Y,"m",bi).call(this)},L(this,ar,"f")),"f"),G(this,Gr,Date.now()+L(this,ar,"f"),"f"))},bi=function(){L(this,We,"f")===0&&L(this,de,"f")===0&&L(this,Ee,"f")&&(clearInterval(L(this,Ee,"f")),G(this,Ee,void 0,"f")),G(this,We,L(this,sr,"f")?L(this,de,"f"):0,"f"),L(this,Y,"m",Sn).call(this)},Sn=function(){for(;L(this,Y,"m",Qr).call(this););},Ph=async function(e){return new Promise((t,r)=>{e.addEventListener("abort",()=>{r(new Mh("The task was aborted."))},{once:!0})})},Xr=async function(e,t){return new Promise(r=>{let n=()=>{t&&!t()||(this.off(e,n),r())};this.on(e,n)})};async function Uh(e,t,r,n,i,s,o){if(t instanceof Uint8Array){let u=vn(t,n,i,s);r.push(u);return}if(t.Data==null)throw(0,Nt.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let a;try{a=dh.unmarshal(t.Data)}catch(u){throw(0,Nt.default)(u,"ERR_NOT_UNIXFS")}if(a.data!=null){let u=a.data,c=vn(u,n,i,s);r.push(c),n+=BigInt(c.byteLength)}let l=[];if(t.Links.length!==a.blockSizes.length)throw(0,Nt.default)(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let u=0;u<t.Links.length;u++){let c=t.Links[u],f=n,w=f+a.blockSizes[u];if((i>=f&&i<w||s>=f&&s<=w||i<f&&s>w)&&l.push({link:c,blockStart:n}),n=w,n>s)break}await Fo(l,u=>So(u,c=>async()=>{let f=await e.get(c.link.Hash,o);return{...c,block:f}}),u=>Ao(u,{ordered:!0}),async u=>{for await(let{link:c,block:f,blockStart:w}of u){let d;switch(c.Hash.code){case zs:d=_r(f);break;case _s:d=f;break;default:r.end((0,Nt.default)(new Error(`Unsupported codec: ${c.Hash.code}`),"ERR_NOT_UNIXFS"));return}let y=new k2({concurrency:1});y.on("error",h=>{r.end(h)}),y.add(async()=>{o.onProgress?.(new Ze("unixfs:exporter:walk:file",{cid:c.Hash})),await Uh(e,d,r,w,i,s,o)}),await y.onIdle()}}),n>=s&&r.end()}var E2=(e,t,r,n,i,s,o)=>{async function*a(l={}){let u=r.fileSize();if(u===void 0)throw new Error("File was a directory");let{start:c,end:f}=bo(u,l.offset,l.length);if(f===0n)return;let w=0n,d=f-c,y=_o();l.onProgress?.(new Ze("unixfs:exporter:walk:file",{cid:e})),Uh(o,t,y,0n,c,f,l).catch(h=>{y.end(h)});for await(let h of y)if(h!=null){if(w+=BigInt(h.byteLength),w>d)throw y.end(),(0,Nt.default)(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");w===d&&y.end(),l.onProgress?.(new Ze("unixfs:exporter:progress:unixfs:file",{bytesRead:w,totalBytes:d,fileSize:u})),yield h}if(w<d)throw(0,Nt.default)(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")}return a},Wa=E2,x2=(e,t,r,n,i,s,o)=>{function a(l={}){return l.onProgress?.(new Ze("unixfs:exporter:walk:hamt-sharded-directory",{cid:e})),zh(t,n,i,s,o,l)}return a};async function*zh(e,t,r,n,i,s){let o=e.Links,a=Fo(o,l=>So(l,u=>async()=>{let c=u.Name!=null?u.Name.substring(2):null;if(c!=null&&c!==""){let f=await r(u.Hash,c,`${t}/${c}`,[],n+1,i,s);return{entries:f.entry==null?[]:[f.entry]}}else{let f=await i.get(u.Hash,s);return e=_r(f),s.onProgress?.(new Ze("unixfs:exporter:walk:hamt-sharded-directory",{cid:u.Hash})),{entries:zh(e,t,r,n,i,s)}}}),l=>Ao(l,{ordered:!0}));for await(let{entries:l}of a)yield*l}var S2=x2,A2=(e,t)=>e.Links.find(r=>r.Name===t)?.Hash,_2={raw:Wa,file:Wa,directory:y2,"hamt-sharded-directory":S2,metadata:(e,t,r,n,i,s,o)=>()=>[],symlink:(e,t,r,n,i,s,o)=>()=>[]},F2=async(e,t,r,n,i,s,o,a)=>{let l=await o.get(e,a),u=_r(l),c,f;if(t==null&&(t=e.toString()),u.Data==null)throw(0,$r.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{c=dh.unmarshal(u.Data)}catch(d){throw(0,$r.default)(d,"ERR_NOT_UNIXFS")}if(r==null&&(r=t),n.length>0){let d;if(c?.type==="hamt-sharded-directory"?d=await e2(u,n[0],o):d=A2(u,n[0]),d==null)throw(0,$r.default)(new Error("file does not exist"),"ERR_NOT_FOUND");let y=n.shift(),h=`${r}/${y}`;f={cid:d,toResolve:n,name:y??"",path:h}}let w=_2[c.type](e,u,c,r,i,s,o);if(w==null)throw(0,$r.default)(new Error("could not find content exporter"),"ERR_NOT_FOUND");return c.isDirectory()?{entry:{type:"directory",name:t,path:r,cid:e,content:w,unixfs:c,depth:s,node:u,size:c.fileSize()},next:f}:{entry:{type:"file",name:t,path:r,cid:e,content:w,unixfs:c,depth:s,node:u,size:c.fileSize()},next:f}},B2=F2,T2={[zs]:B2,[_s]:sv,[Fl]:J0,[W0.code]:tv},jh=async(e,t,r,n,i,s,o)=>{let a=T2[e.code];if(a==null)throw(0,H0.default)(new Error(`No resolver for code ${e.code}`),"ERR_NO_RESOLVER");return a(e,t,r,n,jh,i,s,o)},C2=jh,D2=(e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),N2=e=>{if(e instanceof Uint8Array)return{cid:ee.decode(e),toResolve:[]};let t=ee.asCID(e);if(t!=null)return{cid:t,toResolve:[]};if(typeof e=="string"){e.indexOf("/ipfs/")===0&&(e=e.substring(6));let r=D2(e);return{cid:ee.parse(r[0]),toResolve:r.slice(1)}}throw(0,go.default)(new Error(`Unknown path type ${e}`),"ERR_BAD_PATH")};async function*L2(e,t,r={}){let{cid:n,toResolve:i}=N2(e),s=n.toString(),o=s,a=i.length;for(;;){let l=await C2(n,s,o,i,a,t,r);if(l.entry==null&&l.next==null)throw(0,go.default)(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");if(l.entry!=null&&(yield l.entry),l.next==null)return;i=l.next.toResolve,n=l.next.cid,s=l.next.name,o=l.next.path}}async function I2(e,t,r={}){let n=await R0(L2(e,t,r));if(n==null)throw(0,go.default)(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");return n}var O2=z0(),P2=ao({fileChunkEncoder:dn,smallFileEncoder:dn,chunker:Tc(1024*1024),fileLayout:Dc(1024)});async function M2(e){let t=z2(e),r=await j2(t);return{cid:r.at(-1).cid,blocks:r}}async function U2(e,t,r){let n=await I2(t.toString(),e,{length:r.size}),i=[];for await(let s of n.content())i.push(s);return new File(i,n.name,{type:r.type,lastModified:0})}function z2(e){let{readable:t,writable:r}=new TransformStream({},O2),n=I0({writable:r,settings:P2}),i=new $2("",e);return(async()=>(await i.finalize(n),await n.close()))(),t}async function j2(e){let t=[];return await e.pipeTo(new WritableStream({write(r){t.push(r)}})),t}var Yr,$2=class{constructor(e,t){Lt(this,Yr,void 0),A(this,"name"),this.name=e,Ae(this,Yr,t)}async finalize(e){let t=Lc(e);return await ue(this,Yr).stream().pipeTo(new WritableStream({async write(r){await t.write(r)}})),await t.close()}};Yr=new WeakMap;async function R2(e,t,r,n){let i;for(let s of r){let o=await H2(e,s);i=await ab(e,t,s.key,o,n);let a=i.root.toString();i.additions.some(l=>l.cid.toString()===a)||await e.get(i.root)||(console.error(`missing root in additions: ${i.additions.length} ${a} keys: ${r.map(l=>l.key).toString()}`),i.head=t);for(let{cid:l,bytes:u}of[...i.additions,...i.removals,i.event])e.putSync(l,u);t=i.head}return{head:t}}async function H2(e,t){let r;t.del?r={del:!0}:(await q2(e,t.value),r={doc:t.value});let n=await Pt({value:r,hasher:Te,codec:ce});return e.putSync(n.cid,n.bytes),n.cid}async function q2(e,t){t._files&&await Ga(e,t._files),t._publicFiles&&await Ga(e,t._publicFiles,!0)}async function Ga(e,t,r=!1){let n=e.parent,i=new Rn(n);n.transactions.add(i);let s=[],o=0;for(let a in t)if(File===t[a].constructor){let l=t[a];o+=l.size;let{cid:u,blocks:c}=await M2(l);s.push(a);for(let f of c)i.putSync(f.cid,f.bytes);t[a]={cid:u,type:l.type,size:l.size}}if(o>1024*1024*1)throw new Error("Sync limit for files in a single update is 1MB");if(s.length){let a=await n.loader?.commit(i,{files:t},{public:r});if(a)for(let l of s)t[l]={car:a,...t[l]}}}async function V2(e,t,r){if(!t.length)throw new Error("Getting from an empty database");let n=await lb(e,t,r);if(!n)throw new Error(`Missing key ${r}`);return await Bo(e,n)}function $h(e,{doc:t}){t&&(t._files&&Ka(e,t._files),t._publicFiles&&Ka(e,t._publicFiles,!0))}function Ka(e,t,r=!1){for(let n in t){let i=t[n];if(i.cid&&(r&&(i.url=`https://${i.cid.toString()}.ipfs.w3s.link/`),i.car&&e.loader)){let s=e.loader;i.file=async()=>await U2({get:async o=>{let a=await(await s.loadFileCar(i.car,r)).get(o);if(!a)throw new Error(`Missing block ${o.toString()}`);return a.bytes}},i.cid,i)}t[n]=i}}async function Bo(e,t){let r=await e.get(t);if(!r)throw new Error(`Missing linked block ${t.toString()}`);let{value:n}=await nr({bytes:r.bytes,hasher:Te,codec:ce});return $h(e,n),n}var W2=class extends Jt{async get(e){try{return await super.get(e)}catch(t){return console.error("missing event",e.toString(),t),{value:null}}}};async function To(e,t,r,n){let i=n.dirty?new W2(e):new Jt(e);return{result:(await Wi(e,i,t,r,[],new Set,new Set,n.limit||1/0)).reverse(),head:t}}async function Wi(e,t,r,n,i=[],s,o,a){if(a<=0)return i;let l=r.map(u=>u.toString());for(let u of n)if(l.includes(u.toString()))return i;for(let u of r){if(o.has(u.toString()))continue;o.add(u.toString());let{value:c}=await t.get(u);if(!c)continue;let{key:f,value:w}=c.data;if(s.has(f))c.parents&&(i=await Wi(e,t,c.parents,n,i,s,o,a));else{s.add(f);let d=await Bo(e,w);i.push({key:f,value:d.doc,del:d.del}),a--,c.parents&&(i=await Wi(e,t,c.parents,n,i,s,o,a))}}return i}async function*G2(e,t){for await(let[r,n]of Hu(e,t)){let i=await Bo(e,n);yield{key:r,value:i.doc,del:i.del}}}async function*K2(e,t){for await(let r of $u(e,t))yield r}async function J2(e,t){let r=new G1(e),n=new Rn(e);for await(let[,s]of Hu(r,t))if(!await r.get(s))throw new Error("Missing block: "+s.toString());for await(let s of $u(r,t));let i=await Vn(r,t);for(let{cid:s,bytes:o}of[...i.additions,...i.removals])n.putSync(s,o);await To(r,t,[],{});for(let s of r.cids){let o=await e.get(s);if(!o)throw new Error("Missing block: "+s.toString());await n.put(s,o.bytes)}await e.commitCompaction(n,t)}var Q2=class{constructor(){A(this,"head",[]),A(this,"zoomers",new Set),A(this,"watchers",new Set),A(this,"blocks",null)}setHead(e){this.head=e}async applyHead(e,t,r,n=null){let i=this.head.sort((l,u)=>l.toString().localeCompare(u.toString()));if(t=t.sort((l,u)=>l.toString().localeCompare(u.toString())),i.toString()===t.toString()){this.watchers.forEach(l=>l(n||[]));return}let s=r.sort((l,u)=>l.toString().localeCompare(u.toString()));if(i.toString()===s.toString()){this.setHead(t),this.watchers.forEach(l=>l(n||[]));return}let o=async(l,u)=>{if(l instanceof Rn)return await u(l);if(!this.blocks)throw new Error("missing blocks");return await this.blocks.transaction(u,void 0,{noLoader:!0})},{head:a}=await o(e,async l=>{let u=this.head;for(let f of t)u=await zi(l,u,f);let c=await Vn(l,u);for(let{cid:f,bytes:w}of[...c.additions,...c.removals])l.putSync(f,w);return{head:u}});this.watchers.size&&!n&&(n=(await To(this.blocks,a,r,{})).result),this.setHead(a),this.zoomers.forEach(l=>l()),this.watchers.forEach(l=>l(n||[]))}onTick(e){this.watchers.add(e)}onZoom(e){this.zoomers.add(e)}},X2=class{constructor(e,t){A(this,"name"),A(this,"opts",{}),A(this,"ready"),A(this,"blocks"),A(this,"indexBlocks"),A(this,"indexers",new Map),A(this,"clock",new Q2),this.name=e||null,this.opts=t||this.opts,this.blocks=new W1(this.name,this.clock,this.opts),this.clock.blocks=this.blocks,this.indexBlocks=new V1(this.opts.persistIndexes&&this.name?this.name+".idx":null,this,this.opts),this.ready=Promise.all([this.blocks.ready,this.indexBlocks.ready]).then(()=>{}),this.clock.onZoom(()=>{for(let r of this.indexers.values())r._resetIndex()})}async bulk(e,t){return await this.ready,await this.blocks.transaction(async r=>{let n=[...this.clock.head],{head:i}=await R2(r,this.clock.head,e,t);return e=e.map(({key:s,value:o,del:a})=>($h(this.blocks,{doc:o}),{key:s,value:o,del:a})),await this.clock.applyHead(r,i,n,e),{head:i}})}async allDocs(){await this.ready;let e=[];for await(let t of G2(this.blocks,this.clock.head))e.push(t);return{result:e,head:this.clock.head}}async vis(){await this.ready;let e=[];for await(let t of K2(this.blocks,this.clock.head))e.push(t);return e.join(`
`)}async get(e){await this.ready;let t=await V2(this.blocks,this.clock.head,e);return t.del?null:t}async changes(e=[],t={}){return await this.ready,await To(this.blocks,this.clock.head,e,t)}async compact(){if(await this.ready,!(this.blocks.loader&&this.blocks.loader.carLog.length<2))return await J2(this.blocks,this.clock.head)}},tr=class{constructor(e,t){A(this,"name"),A(this,"opts",{}),A(this,"_listeners",new Set),A(this,"_crdt"),A(this,"_writeQueue"),this.name=e||null,this.opts=t||this.opts,this._crdt=new X2(e,this.opts),this._crdt.clock.onTick(r=>{this._notify(r)}),this._writeQueue=$f(async r=>await this._crdt.bulk(r))}async get(e){let t=await this._crdt.get(e).catch(n=>{throw n.message=`Not found: ${e} - `+n.message,n});if(!t)throw new Error(`Not found: ${e}`);let{doc:r}=t;return{_id:e,...r}}async put(e){let{_id:t,...r}=e,n=t||zf(),i=await this._writeQueue.push({key:n,value:r});return{id:n,clock:i?.head}}async del(e){let t=await this._writeQueue.push({key:e,del:!0});return{id:e,clock:t?.head}}async changes(e=[],t={}){let{result:r,head:n}=await this._crdt.changes(e,t);return{rows:r.map(({key:i,value:s,del:o})=>({key:i,value:o?{_id:i,_deleted:!0}:{_id:i,...s}})),clock:n}}subscribe(e){return this._listeners.add(e),()=>{this._listeners.delete(e)}}async query(e,t={}){return await(typeof e=="string"?Pi({_crdt:this._crdt},e):Pi({_crdt:this._crdt},Y2(e.toString()),e)).query(t)}async compact(){await this._crdt.compact()}async getDashboardURL(e=!0){let t="https://dashboard.fireproof.storage/";if(!this._crdt.blocks.loader?.remoteCarStore)return new URL("/howto",t);e&&await this.compact();let r=await this._crdt.blocks.loader?.metaStore?.load();if(!r)throw new Error("Can't sync empty database: save data first");if(r.length>1)throw new Error("Can't sync database with split heads: make an update first");let n=r[0],i={car:n.car.toString()};n.key&&(i.key=n.key.toString()),this.name&&(i.name=this.name);let s=new URL("/import#"+new URLSearchParams(i).toString(),t);return console.log("Import to dashboard: "+s.toString()),s}openDashboard(){this.getDashboardURL().then(e=>{e&&window.open(e.toString(),"_blank")})}async _notify(e){if(this._listeners.size){let t=e.map(({key:r,value:n})=>({_id:r,...n}));for(let r of this._listeners)await(async()=>await r(t))().catch(n=>{console.error("subscriber error",n)})}}};A(tr,"databases",new Map);function $k(e,t){return tr.databases.has(e)||tr.databases.set(e,new tr(e,t)),tr.databases.get(e)}function Y2(e){let t=/\(([^,()]+,\s*[^,()]+|\[[^\]]+\],\s*[^,()]+)\)/g,r=null;return Array.from(e.matchAll(t),n=>n[1].trim()).length===0&&(r=/=>\s*(.*)/.exec(e)),r?r[1]:e}var Ja=class extends bu{constructor(e,t,r="data"){super(e),_e(this,"tag","car-browser-s3"),_e(this,"connection"),_e(this,"type"),this.connection=t,this.type=r}prefix(){return`fp.${this.loader.name}.${this.STORAGE_VERSION}.${this.loader.keyId}`}async load(e){let t=await this.connection.dataDownload({type:this.type,name:this.prefix(),car:e.toString()});if(!t)throw new Error(`missing remote car ${e.toString()}`);return{cid:e,bytes:t}}async save(e,t){let r={type:this.type,name:this.prefix(),car:e.cid.toString(),size:e.bytes.length.toString()};return await this.connection.dataUpload(e.bytes,r,t)}async remove(e){throw new Error("not implemented")}},Z2=class extends gu{constructor(e,t){super(e),_e(this,"tag","header-browser-ls"),_e(this,"connection"),_e(this,"subscribers",new Map),this.connection=t}onLoad(e,t){let r=this.subscribers.get(e)||[];return r.push(t),this.subscribers.set(e,r),()=>{let n=this.subscribers.get(e)||[],i=n.indexOf(t);i>-1&&n.splice(i,1)}}prefix(){return`fp.${this.name}.${this.STORAGE_VERSION}`}async handleByteHeads(e,t="main"){let r=this.dbMetasForByteHeads(e),n=this.subscribers.get(t)||[];for(let i of n)await i(r);return r}async load(e="main"){let t=await this.connection.metaDownload({name:this.prefix(),branch:e});return t?this.handleByteHeads(t,e):null}async save(e,t="main"){let r=new TextEncoder().encode(this.makeHeader(e)),n=await this.connection.metaUpload(r,{name:this.prefix(),branch:t});if(!n)return null;let i=this.dbMetasForByteHeads(n),s=this.subscribers.get(t)||[];for(let o of s)await o(i);return i}dbMetasForByteHeads(e){return e.map(t=>{let r=new TextDecoder().decode(t);return this.parseHeader(r)})}};function ek(e){return e.fileStore!==void 0}var ti=class{constructor(){_e(this,"ready"),_e(this,"loaded"),_e(this,"loader"),this.ready=Promise.resolve(),this.loaded=Promise.resolve()}async refresh(){await this.loader.remoteMetaStore.load("main"),await this.loader.remoteWAL?._process()}connect(e){this.loader=e,this.connectStorage(e),this.connectMeta(e)}connectMeta(e){this.loader=e;let t=new Z2(e.name,this);t.onLoad("main",async r=>{r&&await e.handleDbMetasFromStore(r)}),e.remoteMetaStore=t,e.remoteMetaLoading=t.load("main").then(()=>{}),this.loaded=Promise.all([e.ready,e.remoteMetaLoading]).then(()=>{this.loader.remoteWAL?._process()})}connectStorage(e){this.loader=e;let t=new Ja(e,this);e.remoteCarStore=t,ek(e)&&(e.remoteFileStore=new Ja(e,this,"file"))}},At=sf(of(),1),Co=class extends ti{constructor(e,t){super(),_e(this,"uploadUrl"),_e(this,"downloadUrl"),this.uploadUrl=new URL(e),this.downloadUrl=new URL(t)}async dataUpload(e,t){yr(t);let r=new URL(`${this.uploadUrl.toString()}?${new URLSearchParams({cache:Math.random().toString(),...t}).toString()}`),n=await(0,At.default)(r);if(!n.ok)throw console.log("failed to get upload url for data",t,n),new Error("failed to get upload url for data "+new Date().toISOString()+" "+n.statusText);let{uploadURL:i}=await n.json(),s=await(0,At.default)(i,{method:"PUT",body:e});if(!s.ok)throw new Error("failed to upload data "+s.statusText)}async metaUpload(e,t){wr(t);let r=new URL(`${this.uploadUrl.toString()}?${new URLSearchParams({type:"meta",...t}).toString()}`),n=await(0,At.default)(r);if(!n.ok)throw console.log("failed to get upload url for meta",t,n),new Error("failed to get upload url for meta");let{uploadURL:i}=await n.json();if(!i)throw new Error("missing uploadURL");let s=await(0,At.default)(i,{method:"PUT",body:e});if(!s.ok)throw new Error("failed to upload data "+s.statusText);return null}async dataDownload(e){yr(e);let{type:t,name:r,car:n}=e,i=new URL(`${t}/${r}/${n}.car`,this.downloadUrl),s=await(0,At.default)(i);return s.ok?new Uint8Array(await s.arrayBuffer()):null}async metaDownload(e){wr(e);let{name:t,branch:r}=e,n=new URL(`meta/${t}/${r+".json?cache="+Math.floor(Math.random()*1e6)}`,this.downloadUrl),i=await(0,At.default)(n);return i.ok?[new Uint8Array(await i.arrayBuffer())]:null}},tk=class extends ti{constructor({metaUpload:e,metaDownload:t,dataUpload:r,dataDownload:n}){super(),this.metaUpload=e,this.metaDownload=t,this.dataUpload=r,this.dataDownload=n}},Rk={s3:({_crdt:{blocks:{loader:e}}},{upload:t,download:r})=>{let n=new Co(t,r);return n.connect(e),n},raw:({_crdt:{blocks:{loader:e}}},t)=>{let r=new tk(t);return r.connect(e),r}};function yr(e){let{type:t,name:r,car:n}=e;if(!r)throw new Error("name is required");if(!n)throw new Error("car is required");if(t!=="file"&&t!=="data")throw new Error("type must be file or data")}function wr(e){let{name:t,branch:r}=e;if(!t)throw new Error("name is required");if(!r)throw new Error("branch is required")}(!globalThis.EventTarget||!globalThis.Event)&&console.error(`
  PartySocket requires a global 'EventTarget' class to be available!
  You can use the 'event-target-shim' package to polyfill this. See https://www.npmjs.com/package/event-target-shim. 
  First, run:
  \`\`\`
  npm install event-target-shim
  \`\`\`
  Then, add this in your code:
  \`\`\`
  import {Event, EventTarget} from 'event-target-shim';
  if(!globalThis.Event) {
    globalThis.Event = Event;
  }
  if(!globalThis.EventTarget) {
    globalThis.EventTarget = EventTarget;
  }
  \`\`\`
  Please file an issue at https://github.com/partykit/partykit if you're still having trouble.
`);var rk=class extends Event{constructor(t,r){super("error",r);j(this,"message");j(this,"error");this.message=t.message,this.error=t}},nk=class extends Event{constructor(t=1e3,r="",n){super("close",n);j(this,"code");j(this,"reason");j(this,"wasClean",!0);this.code=t,this.reason=r}},Do={Event,ErrorEvent:rk,CloseEvent:nk};function ik(e,t){if(!e)throw new Error(t)}function sk(e){return new e.constructor(e.type,e)}function ok(e){return new Event(e.type,e)}var ak=typeof process<"u"&&typeof process.versions?.node<"u"&&typeof document>"u",ri=ak?ok:sk,mt={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},No=class vt extends EventTarget{constructor(r,n,i={}){super();j(this,"_ws");j(this,"_retryCount",-1);j(this,"_uptimeTimeout");j(this,"_connectTimeout");j(this,"_shouldReconnect",!0);j(this,"_connectLock",!1);j(this,"_binaryType","blob");j(this,"_closeCalled",!1);j(this,"_messageQueue",[]);j(this,"_url");j(this,"_protocols");j(this,"_options");j(this,"onclose",null);j(this,"onerror",null);j(this,"onmessage",null);j(this,"onopen",null);j(this,"_handleOpen",r=>{this._debug("open event");let{minUptime:n=mt.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),n),ik(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(i=>this._ws?.send(i)),this._messageQueue=[],this.onopen&&this.onopen(r),this.dispatchEvent(ri(r))});j(this,"_handleMessage",r=>{this._debug("message event"),this.onmessage&&this.onmessage(r),this.dispatchEvent(ri(r))});j(this,"_handleError",r=>{this._debug("error event",r.message),this._disconnect(void 0,r.message==="TIMEOUT"?"timeout":void 0),this.onerror&&this.onerror(r),this._debug("exec error listeners"),this.dispatchEvent(ri(r)),this._connect()});j(this,"_handleClose",r=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(r),this.dispatchEvent(ri(r))});this._url=r,this._protocols=n,this._options=i,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return vt.CONNECTING}get OPEN(){return vt.OPEN}get CLOSING(){return vt.CLOSING}get CLOSED(){return vt.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(r){this._binaryType=r,this._ws&&(this._ws.binaryType=r)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((n,i)=>(typeof i=="string"?n+=i.length:i instanceof Blob?n+=i.size:n+=i.byteLength,n),0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?vt.CLOSED:vt.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}close(r=1e3,n){if(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(r,n)}reconnect(r,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(r,n),this._connect())}send(r){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",r),this._ws.send(r);else{let{maxEnqueuedMessages:n=mt.maxEnqueuedMessages}=this._options;this._messageQueue.length<n&&(this._debug("enqueue",r),this._messageQueue.push(r))}}_debug(...r){this._options.debug&&console.log.apply(console,["RWS>",...r])}_getNextDelay(){let{reconnectionDelayGrowFactor:r=mt.reconnectionDelayGrowFactor,minReconnectionDelay:n=mt.minReconnectionDelay,maxReconnectionDelay:i=mt.maxReconnectionDelay}=this._options,s=0;return this._retryCount>0&&(s=n*Math.pow(r,this._retryCount-1),s>i&&(s=i)),this._debug("next delay",s),s}_wait(){return new Promise(r=>{setTimeout(r,this._getNextDelay())})}_getNextProtocols(r){if(!r)return Promise.resolve(null);if(typeof r=="string"||Array.isArray(r))return Promise.resolve(r);if(typeof r=="function"){let n=r();if(!n)return Promise.resolve(null);if(typeof n=="string"||Array.isArray(n))return Promise.resolve(n);if(n.then)return n}throw Error("Invalid protocols")}_getNextUrl(r){if(typeof r=="string")return Promise.resolve(r);if(typeof r=="function"){let n=r();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;let{maxRetries:r=mt.maxRetries,connectionTimeout:n=mt.connectionTimeout}=this._options;if(this._retryCount>=r){this._debug("max retries reached",this._retryCount,">=",r);return}this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>Promise.all([this._getNextUrl(this._url),this._getNextProtocols(this._protocols||null)])).then(([i,s])=>{if(this._closeCalled){this._connectLock=!1;return}let o=this._options.WebSocket||WebSocket;this._debug("connect",{url:i,protocols:s}),this._ws=s?new o(i,s):new o(i),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),n)}).catch(i=>{this._connectLock=!1,this._handleError(new Do.ErrorEvent(Error(i.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new Do.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(r=1e3,n){if(this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(r,n),this._handleClose(new Do.CloseEvent(r,n,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}};function lk(){if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();let e=new Date().getTime(),t=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let n=Math.random()*16;return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),(r==="x"?n:n&3|8).toString(16)})}var Lo=class extends No{constructor(t){let{host:r,room:n,party:i,protocol:s,query:o,protocols:a,...l}=t,u=t.id||lk(),c=r.replace(/^(http|https|ws|wss):\/\//,""),f=`${s||(c.startsWith("localhost:")||c.startsWith("127.0.0.1:")?"ws":"wss")}://${c}/${i?`parties/${i}`:"party"}/${n}`;o?f+=`?${new URLSearchParams({...o,_pk:u}).toString()}`:f+=`?_pk=${u}`;super(f,a,l);j(this,"_pk");j(this,"_pkurl");j(this,"name");j(this,"room");j(this,"host");this.partySocketOptions=t,this._pk=u,this._pkurl=f,this.name=i??"main",this.room=n,this.host=c}get id(){return this._pk}get url(){return this._pkurl}};var ni=class extends ti{constructor(r){super();j(this,"name");j(this,"host");j(this,"party");j(this,"messagePromise");j(this,"messageResolve");this.name=r.name,this.host=r.host,this.party=new Lo({host:r.host,room:`fireproof:${r.name}`}),this.ready=new Promise((n,i)=>{this.party.addEventListener("open",()=>{n()})}),this.messagePromise=new Promise((n,i)=>{this.messageResolve=n}),this.party.addEventListener("message",n=>{let i=n.data,s=new TextEncoder().encode(i),o=new Uint8Array(s);this.loader?.remoteMetaStore?.handleByteHeads([o]),this.messageResolve?.(o),this.messagePromise=new Promise((a,l)=>{this.messageResolve=a})})}async connectStorage(){throw new Error("not implemented")}async dataUpload(r,n){throw yr(n),new Error("not implemented")}async dataDownload(r){throw yr(r),new Error("not implemented");return null}async metaUpload(r,n){wr(n),await this.ready;let s=new TextEncoder().encode(String.fromCharCode(...new Uint8Array(r)));return this.party.send(s),null}async metaDownload(r){return wr(r),[await this.messagePromise]}};var Io=new Map,uk={partykit:(e,t)=>{let{name:r,_crdt:{blocks:{loader:n}}}=e;if(!r)throw new Error("database name is required");if(Io.has(r))return Io.get(r);let i={upload:"https://04rvvth2b4.execute-api.us-east-2.amazonaws.com/uploads",download:"https://sam-app-s3uploadbucket-e6rv1dj2kydh.s3.us-east-2.amazonaws.com"};new Co(i.upload,i.download).connectStorage(n),t||(console.warn("partyHost not provided, using localhost:1999"),t="http://localhost:1999");let o=new ni({name:r,host:t});return o.connectMeta(n),Io.set(r,o),o}};return Jh(ck);})();
/*! Bundled license information:

uuidv7/dist/index.js:
  (**
   * uuidv7: An experimental implementation of the proposed UUID Version 7
   *
   * @license Apache-2.0
   * @copyright 2021-2023 LiosK
   * @packageDocumentation
   *)
*/
/*! Bundled license information:

partysocket/dist/chunk-YV734IKE.mjs:
  (*!
   * Reconnecting WebSocket
   * by Pedro Ladaria <pedro.ladaria@gmail.com>
   * https://github.com/pladaria/reconnecting-websocket
   * License MIT
   *)
*/
//# sourceMappingURL=index.iife.js.map
